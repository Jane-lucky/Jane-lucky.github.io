---
title: build-images自动化脚本学习（一）
categories: 
- docker
tags:
- docker
---



# 镜像构建命令

脚本 版本 操作系统

```shell
sh build-image.sh 4.5.0 alpine
```

# 镜像构建脚本样例（rocketmq）

文件目录

```shell
[root@ecs-5e66 image-build]$ ll
total 28
-rw-r--r-- 1 root docker 1633 Sep 22 16:10 build-image-dashboard.sh
-rwxr-xr-x 1 root docker 1734 Sep 22 16:10 build-image.sh
-rw-r--r-- 1 root docker 3027 Sep 22 16:10 Dockerfile-alpine
-rw-r--r-- 1 root docker 3102 Sep 22 17:47 Dockerfile-centos
-rw-r--r-- 1 root docker 3861 Sep 22 16:10 Dockerfile-centos-dashboard
drwxr-xr-x 2 root docker 4096 Sep 22 16:10 scripts
-rwxr-xr-x 1 root docker 1726 Sep 22 16:10 update.sh
[root@ecs-5e66 image-build]$ cat build-image.sh
#检查版本
checkVersion() {
    echo "Version = $1"
        echo $1 |grep -E "^[0-9]+\.[0-9]+\.[0-9]+" > /dev/null
    if [ $? = 0 ]; then
        return 1
    fi

        echo "Version $1 illegal, it should be X.X.X format(e.g. 4.5.0), please check released versions in 'https://archive.apache.org/dist/rocketmq/'"
    exit -1
}

if [ $# -lt 2 ]; then
    echo -e "Usage: sh $0 Version BaseImage"
    exit -1
fi

#赋值命令行中的参数
ROCKETMQ_VERSION=$1
BASE_IMAGE=$2

checkVersion $ROCKETMQ_VERSION

# Build rocketmq 构建
case "${BASE_IMAGE}" in
    alpine)
        docker build --no-cache -f Dockerfile-alpine -t apache/rocketmq:${ROCKETMQ_VERSION}-alpine --build-arg version=${ROCKETMQ_VERSION} .
    ;;
    centos)
        docker build --no-cache -f Dockerfile-centos -t apache/rocketmq:${ROCKETMQ_VERSION} --build-arg version=${ROCKETMQ_VERSION} .
    ;;
    *)
        echo "${BASE_IMAGE} is not supported, supported base images: centos, alpine"
        exit -1
    ;;
esac

```