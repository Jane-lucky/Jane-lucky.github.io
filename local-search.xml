<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>redis 5.0.6 armé•œåƒæ„å»º</title>
    <link href="/2022/09/14/docker/redis%205.0.6%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/"/>
    <url>/2022/09/14/docker/redis%205.0.6%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºç¡€é•œåƒ-alpine"><a href="#åŸºç¡€é•œåƒ-alpine" class="headerlink" title="åŸºç¡€é•œåƒ alpine"></a>åŸºç¡€é•œåƒ alpine</h1><p>æºç è·å–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://github.com/docker-library/redis/raw/6ec0ad5628df2404509f776e9c70fbecf5364c10/5.0/alpine/Dockerfile<br>wget https://github.com/docker-library/redis/raw/6ec0ad5628df2404509f776e9c70fbecf5364c10/5.0/alpine/docker-entrypoint.sh<br>chmod +x docker-entrypoint.sh<br></code></pre></td></tr></table></figure><h1 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h1><h2 id="é—®é¢˜ä¸€"><a href="#é—®é¢˜ä¸€" class="headerlink" title="é—®é¢˜ä¸€"></a>é—®é¢˜ä¸€</h2><p>redis 5.0.Xç‰ˆæœ¬ä¸­ï¼Œå°½ç®¡å®˜æ–¹å·²ç»æä¾›äº†armç‰ˆæœ¬çš„redisé•œåƒï¼Œä½†æ˜¯åœ¨arm centos 7.6ç³»ç»Ÿä¸­ï¼Œä¼šå‡ºç°page sizeçš„é—®é¢˜ï¼Œå› æ­¤å»ºè®®é‡æ–°è·å–dockerfileæ„å»ºå¯¹åº”çš„é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@ecs-5e66 jdk]$ docker logs redist<br>&lt;jemalloc&gt;: Unsupported system page size<br>&lt;jemalloc&gt;: Unsupported system page size<br><br></code></pre></td></tr></table></figure><h2 id="é—®é¢˜äºŒ"><a href="#é—®é¢˜äºŒ" class="headerlink" title="é—®é¢˜äºŒ"></a>é—®é¢˜äºŒ</h2><p>åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç”±äºredisçš„Dockerfileåœ¨ä¸åœçš„æ›´æ–°ï¼ŒåŒ…æ‹¬å¯¹åº”çš„åŸºç¡€é•œåƒï¼Œå› æ­¤å»ºè®®åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨å¯¹åº”çš„Dockerfileæ„å»ºï¼Œè€Œä¸ä»…ä»…æ˜¯æ”¹å˜Dockerfileä¸­çš„ç‰ˆæœ¬ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºhttpdä¸´æ—¶æº</title>
    <link href="/2022/09/14/docker/%E6%90%AD%E5%BB%BAhttpd%E4%B8%B4%E6%97%B6%E6%BA%90/"/>
    <url>/2022/09/14/docker/%E6%90%AD%E5%BB%BAhttpd%E4%B8%B4%E6%97%B6%E6%BA%90/</url>
    
    <content type="html"><![CDATA[<h1 id="dockeræ­å»ºä¸´æ—¶æº"><a href="#dockeræ­å»ºä¸´æ—¶æº" class="headerlink" title="dockeræ­å»ºä¸´æ—¶æº"></a>dockeræ­å»ºä¸´æ—¶æº</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@ecs-5e66 jdk-src]$ docker run -itd --name httptest -v $PWD:/usr/local/apache2/htdocs/ httpd:alpine<br>6e4536e60d4971eb7cdeb11d22aeed64fa87d763c240373e3a82994de0358b74<br>[root@ecs-5e66 jdk-src]$ docker inspect httptest | grep Ip<br>            &quot;IpcMode&quot;: &quot;private&quot;,<br>[root@ecs-5e66 jdk-src]$ docker inspect httptest | grep IP<br>            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,<br>            &quot;LinkLocalIPv6PrefixLen&quot;: 0,<br>            &quot;SecondaryIPAddresses&quot;: null,<br>            &quot;SecondaryIPv6Addresses&quot;: null,<br>            &quot;GlobalIPv6Address&quot;: &quot;&quot;,<br>            &quot;GlobalIPv6PrefixLen&quot;: 0,<br>            &quot;IPAddress&quot;: &quot;172.17.0.41&quot;,<br>            &quot;IPPrefixLen&quot;: 16,<br>            &quot;IPv6Gateway&quot;: &quot;&quot;,<br>                    &quot;IPAMConfig&quot;: null,<br>                    &quot;IPAddress&quot;: &quot;172.17.0.41&quot;,<br>                    &quot;IPPrefixLen&quot;: 16,<br>                    &quot;IPv6Gateway&quot;: &quot;&quot;,<br>                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,<br>                    &quot;GlobalIPv6PrefixLen&quot;: 0,<br><br><br></code></pre></td></tr></table></figure><h1 id="è·å–æ–‡ä»¶"><a href="#è·å–æ–‡ä»¶" class="headerlink" title="è·å–æ–‡ä»¶"></a>è·å–æ–‡ä»¶</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[jiatong@ecs-5e66 jdk]$ wget 172.17.0.41:80/jdk-8u301-linux-aarch64.tar.gz<br>--2022-09-14 14:52:17--  http://172.17.0.41/jdk-8u301-linux-aarch64.tar.gz<br>Connecting to 172.17.0.41:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 74283479 (71M) [application/x-gzip]<br>Saving to: â€˜jdk-8u301-linux-aarch64.tar.gzâ€™<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">100%</span><span class="language-bash">[====================================================================================================================================================================&gt;] 74,283,479  --.-K/s   <span class="hljs-keyword">in</span> 0.09s</span><br><br>2022-09-14 14:52:17 (797 MB/s) - â€˜jdk-8u301-linux-aarch64.tar.gzâ€™ saved [74283479/74283479]<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>httpd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSA-è‡ªæ—‹é”</title>
    <link href="/2022/09/14/golang/CSA%20%E8%87%AA%E6%97%8B%E9%94%81/"/>
    <url>/2022/09/14/golang/CSA%20%E8%87%AA%E6%97%8B%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h1 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h1><p>æ¯”è¾ƒå’Œäº¤æ¢â€”â€”åŸå­æ“ä½œï¼šåœ¨å¤šçº¿ç¨‹æ²¡æœ‰é”çš„çŠ¶æ€ä¸‹ç¡®ä¿å¤šä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå€¼çš„æ›´æ–°ã€‚</p><h1 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h1><p>ä¸æ–­çš„åˆ¤æ–­æ¯”è¾ƒã€‚</p><p>æŒæœ‰çš„é”å’Œç­‰å¾…ç«äº‰çš„é”ä¸éœ€è¦ä½œå†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„è½¬æ¢ï¼Œåªéœ€è¦å¾ªç¯ç­‰å¾…æŒæœ‰é”çš„é‡Šæ”¾é”ã€‚é¿å…ä¸åŒçŠ¶æ€è½¬æ¢çš„æ¶ˆè€—ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CSA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>atomic.Value ç±»å‹</title>
    <link href="/2022/09/13/golang/Golang%E5%8C%85/atomic.Value%20%E7%B1%BB%E5%9E%8B/"/>
    <url>/2022/09/13/golang/Golang%E5%8C%85/atomic.Value%20%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>GolangåŒ…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>atomic</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8såœ¨kindä¸Šçš„ç®€å•ä½¿ç”¨</title>
    <link href="/2022/09/13/k8s/k8s%E5%9C%A8kind%E4%B8%8A%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <url>/2022/09/13/k8s/k8s%E5%9C%A8kind%E4%B8%8A%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>åœ¨åˆ›å»ºk8sé›†ç¾¤å¯å‚è€ƒ<a href>kindå®‰è£…éƒ¨ç½²k8sé›†ç¾¤</a></p><h1 id="æŸ¥çœ‹è¿è¡Œçš„èŠ‚ç‚¹"><a href="#æŸ¥çœ‹è¿è¡Œçš„èŠ‚ç‚¹" class="headerlink" title="æŸ¥çœ‹è¿è¡Œçš„èŠ‚ç‚¹"></a>æŸ¥çœ‹è¿è¡Œçš„èŠ‚ç‚¹</h1><p>åˆ›å»ºäº†3ä¸ªworkèŠ‚ç‚¹å’Œ3ä¸ªmaster</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs fortran">[root@host-server ~]# kubectl get nodes<br><span class="hljs-keyword">NAME</span>                  <span class="hljs-keyword">STATUS</span>   ROLES           AGE     VERSION<br><span class="hljs-keyword">kind</span>-control-plane    Ready    control-plane   <span class="hljs-number">4</span>h23m   v1<span class="hljs-number">.25</span><span class="hljs-number">.0</span><br><span class="hljs-keyword">kind</span>-control-plane2   Ready    control-plane   <span class="hljs-number">4</span>h22m   v1<span class="hljs-number">.25</span><span class="hljs-number">.0</span><br><span class="hljs-keyword">kind</span>-control-plane3   Ready    control-plane   <span class="hljs-number">4</span>h22m   v1<span class="hljs-number">.25</span><span class="hljs-number">.0</span><br><span class="hljs-keyword">kind</span>-worker           Ready    &lt;<span class="hljs-keyword">none</span>&gt;          <span class="hljs-number">4</span>h21m   v1<span class="hljs-number">.25</span><span class="hljs-number">.0</span><br><span class="hljs-keyword">kind</span>-worker2          Ready    &lt;<span class="hljs-keyword">none</span>&gt;          <span class="hljs-number">4</span>h21m   v1<span class="hljs-number">.25</span><span class="hljs-number">.0</span><br><span class="hljs-keyword">kind</span>-worker3          Ready    &lt;<span class="hljs-keyword">none</span>&gt;          <span class="hljs-number">4</span>h21m   v1<span class="hljs-number">.25</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure><h1 id="å¦‚ä½•è¿è¡Œ"><a href="#å¦‚ä½•è¿è¡Œ" class="headerlink" title="å¦‚ä½•è¿è¡Œ"></a>å¦‚ä½•è¿è¡Œ</h1><p>åœ¨å®¿ä¸»æœºä¸­ï¼Œä½¿ç”¨kubectlå°±å¯ä»¥å®Œæˆå‡ å¤§éƒ¨åˆ†çš„k8sæ“ä½œï¼Œæœ‰äº›äººå¯èƒ½å°±å¯¹äºå’Œå¹³å¸¸çœ‹è§çš„k8séƒ¨ç½²ä¸åŒï¼ŒåŒ…æ‹¬çœ‹ä¸è§æ„å»ºk8sçš„é•œåƒã€å®ƒåˆ°åº•æ˜¯å¦‚ä½•éƒ¨ç½²ä¸Šå»ã€æ€ä¹ˆå°±æˆåŠŸéƒ¨ç½²äº†3ä¸ªworkså’Œ3ä¸ªmasterç­‰æœ‰è¯¸å¤šçš„ç–‘æƒ‘ã€‚</p><p>å…ˆä¸Šå›¾ï¼š</p><p><img src="/2022/09/13/k8s/k8s%E5%9C%A8kind%E4%B8%8A%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/image-20220909161301440-1663039219073-7.png" alt="kind"></p><p>åœ¨æ­¤ä¹Ÿä»…æ˜¯ç®€å•ä»‹ç»è¯¥å·¥ä½œæµç¨‹ï¼Œå¦‚æœéœ€è¦è¿›ä¸€æ­¥äº†è§£ï¼Œå¯å‚è€ƒ<a href="https://kind.sigs.k8s.io/">kindæ–‡æ¡£</a></p><ol><li><p>é‡‡ç”¨é•œåƒçš„æ–¹å¼æ„å»ºk8s nodeèŠ‚ç‚¹</p><p>kind,åŸæ–‡å°±æ˜¯ Kubernetes in docker ã€‚è¿™æ ·äº‹æƒ…ä¹Ÿå°±å˜å¾—æ˜æœ—èµ·æ¥ã€‚å°†k8sç¯å¢ƒä»¥docker containerçš„æ–¹å¼æ­å»ºã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@host-server ~]# docker ps -a<br>CONTAINER ID        IMAGE                                COMMAND                  CREATED             STATUS              PORTS                       NAMES<br>a9459c6610fd        kindest/haproxy:v20220607-9a4d8d2a   &quot;haproxy -sf 7 -W -dâ€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:34805-&gt;6443/tcp   kind-external-load-balancer<br>1747e4be5b45        kindest/node:v1.25.0                 &quot;/usr/local/bin/entrâ€¦&quot;   4 hours ago         Up 4 hours                                      kind-worker2<br>1af5558bd923        kindest/node:v1.25.0                 &quot;/usr/local/bin/entrâ€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:46155-&gt;6443/tcp   kind-control-plane3<br>d8fd68d3fb29        kindest/node:v1.25.0                 &quot;/usr/local/bin/entrâ€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:38435-&gt;6443/tcp   kind-control-plane<br>543d3a6c7d22        kindest/node:v1.25.0                 &quot;/usr/local/bin/entrâ€¦&quot;   4 hours ago         Up 4 hours                                      kind-worker<br>78580624a92e        kindest/node:v1.25.0                 &quot;/usr/local/bin/entrâ€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:34349-&gt;6443/tcp   kind-control-plane2<br>35e8c2851baf        kindest/node:v1.25.0                 &quot;/usr/local/bin/entrâ€¦&quot;   4 hours ago         Up 4 hours                                      kind-worker3<br></code></pre></td></tr></table></figure></li><li><p>ç®€åŒ–äº†ç¯å¢ƒçš„æ­å»º</p><p>kindå‘½ä»¤çš„ä½¿ç”¨ï¼Œå¯ä»¥è®©æ“ä½œè€…ä¸åœ¨çº ç»“æ­å»ºç¯å¢ƒä¸­å‡ºç°çš„é”™è¯¯ï¼Œæ¯•ç«Ÿåœ¨æ­å»ºç¯å¢ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å¸¸å¸¸ä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼Œæœ€ç»ˆå¯¼è‡´ä»å…¥é—¨åˆ°æ”¾å¼ƒã€‚</p></li><li><p>è¿›å…¥èŠ‚ç‚¹å†…éƒ¨</p><p>ä»¥å®¹å™¨çš„æ–¹å¼è¿›å…¥èŠ‚ç‚¹ç¯å¢ƒï¼Œå®¹å™¨ä¸­æ¶µç›–äº†k8sæ‰€éœ€çš„ç¯å¢ƒï¼ŒåŒ…æ‹¬kubeadm ã€kubectl ã€kubeletç®¡ç†å¥—ä»¶ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@host-server ~]# docker exec -it kind-worker bash<br>root@kind-worker:/# kube<br>kubeadm  kubectl  kubelet<br></code></pre></td></tr></table></figure></li><li><p>é‡‡ç”¨crictlçš„æ–¹å¼ æ£€æŸ¥å’Œè°ƒè¯•kubernetesèŠ‚ç‚¹ä¸Šçš„å®¹å™¨è¿è¡Œæ—¶å’Œåº”ç”¨ç¨‹åºï¼Œå…¶ä½™çš„æ“ä½œå‘½ä»¤å¯å‚è§<a href="https://kubernetes.io/zh-cn/docs/tasks/debug/debug-cluster/crictl/">https://kubernetes.io/zh-cn/docs/tasks/debug/debug-cluster/crictl/</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@kind-worker:/# crictl pods<br>POD ID              CREATED             STATE               NAME                NAMESPACE           ATTEMPT             RUNTIME<br>70378a1203be0       5 hours ago         Ready               kube-proxy-9b29x    kube-system         0                   (default)<br>1155cba575f39       5 hours ago         Ready               kindnet-ftncm       kube-system         0                   (default)<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
      <tag>kind</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>crictl å¯¹ Kubernetes èŠ‚ç‚¹è¿›è¡Œè°ƒè¯•</title>
    <link href="/2022/09/13/k8s/crictl%20%E5%AF%B9%20Kubernetes%20%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/"/>
    <url>/2022/09/13/k8s/crictl%20%E5%AF%B9%20Kubernetes%20%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<p>CRI æ˜¯ä¸€ä¸ªæ’ä»¶æ¥å£ï¼Œå®ƒä½¿ kubelet èƒ½å¤Ÿä½¿ç”¨å„ç§å®¹å™¨è¿è¡Œæ—¶ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘é›†ç¾¤ç»„ä»¶ã€‚</p><p>ä½ éœ€è¦åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ªå¯ä»¥æ­£å¸¸å·¥ä½œçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œ è¿™æ ·kubelet èƒ½å¯åŠ¨podåŠå…¶å®¹å™¨ã€‚</p><p>è€Œcrictlæ˜¯CRIå…¼å®¹çš„å®¹å™¨è¿è¡Œæ—¶å‘½ä»¤è¡Œæ¥å£ã€‚ä½¿ç”¨å®ƒæ¥æ£€æŸ¥å’Œè°ƒè¯•kubernetesèŠ‚ç‚¹ä¸Šçš„å®¹å™¨è¿è¡Œæ—¶å’Œåº”ç”¨ç¨‹åºã€‚</p><h1 id="å‘½ä»¤ç”¨æ³•"><a href="#å‘½ä»¤ç”¨æ³•" class="headerlink" title="å‘½ä»¤ç”¨æ³•"></a>å‘½ä»¤ç”¨æ³•</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@kind-control-plane3:/# crictl help<br>NAME:<br>   crictl - client for CRI<br><br>USAGE:<br>   crictl [global options] command [command options] [arguments...]<br><br>VERSION:<br>   v1.24.0<br><br>COMMANDS:<br>   attach              Attach to a running container<br>   create              Create a new container<br>   exec                Run a command in a running container<br>   version             Display runtime version information<br>   images, image, img  List images<br>   inspect             Display the status of one or more containers<br>   inspecti            Return the status of one or more images<br>   imagefsinfo         Return image filesystem info<br>   inspectp            Display the status of one or more pods<br>   logs                Fetch the logs of a container<br>   port-forward        Forward local port to a pod<br>   ps                  List containers<br>   pull                Pull an image from a registry<br>   run                 Run a new container inside a sandbox<br>   runp                Run a new pod<br>   rm                  Remove one or more containers<br>   rmi                 Remove one or more images<br>   rmp                 Remove one or more pods<br>   pods                List pods<br>   start               Start one or more created containers<br>   info                Display information of the container runtime<br>   stop                Stop one or more running containers<br>   stopp               Stop one or more running pods<br>   update              Update one or more running containers<br>   config              Get and set crictl client configuration options<br>   stats               List container(s) resource usage statistics<br>   statsp              List pod resource usage statistics<br>   completion          Output shell completion code<br>   help, h             Shows a list of commands or help for one command<br><br>GLOBAL OPTIONS:<br>   --config value, -c value            Location of the client config file. If not specified and the default does not exist, the program&#x27;s directory is searched as well (default: &quot;/etc/crictl.yaml&quot;) [$CRI_CONFIG_FILE]<br>   --debug, -D                         Enable debug mode (default: false)<br>   --image-endpoint value, -i value    Endpoint of CRI image manager service (default: uses &#x27;runtime-endpoint&#x27; setting) [$IMAGE_SERVICE_ENDPOINT]<br>   --runtime-endpoint value, -r value  Endpoint of CRI container runtime service (default: uses in order the first successful one of [unix:///var/run/dockershim.sock unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]). Default is now deprecated and the endpoint should be set instead. [$CONTAINER_RUNTIME_ENDPOINT]<br>   --timeout value, -t value           Timeout of connecting to the server in seconds (e.g. 2s, 20s.). 0 or less is set to default (default: 2s)<br>   --help, -h                          show help (default: false)<br>   --version, -v                       print the version (default: false)<br><br></code></pre></td></tr></table></figure><h2 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@kind-control-plane3:/# crictl image -h<br>NAME:<br>   crictl images - List images<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è·å–å®¿ä¸»æœºä¸­çš„é•œåƒ</span><br>USAGE:<br>   crictl images [command options] [REPOSITORY[:TAG]]<br><br>OPTIONS:<br>   --digests                 Show digests (default: false)<br>   --no-trunc                Show output without truncating the ID (default: false)<br>   --output value, -o value  Output format, One of: json|yaml|table<br><span class="hljs-meta prompt_">   #</span><span class="language-bash">æ˜¾ç¤ºimageçš„sha256 ID</span><br>   --quiet, -q               Only show image IDs (default: false)<br>   --verbose, -v             Show verbose info for images (default: false)<br>   --help, -h                show help (default: false)<br><br></code></pre></td></tr></table></figure><h2 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@kind-control-plane3:/# crictl pods -h<br>NAME:<br>   crictl pods - List pods<br><br>USAGE:<br>   crictl pods [command options] [arguments...]<br><br>OPTIONS:<br>   --id value                filter by pod id<br><span class="hljs-meta prompt_">   #</span><span class="language-bash">æ ¹æ®æ ‡ç­¾æ‰“å°pod</span><br>   --label value             filter by key=value label  (accepts multiple inputs)<br>   --last value, -n value    Show last n recently created pods. Set 0 for unlimited (default: 0)<br>   --latest, -l              Show the most recently created pod (default: false)<br><span class="hljs-meta prompt_">   #</span><span class="language-bash">æ ¹æ®åç§°æ˜¾ç¤ºpod</span><br>   --name value              filter by pod name regular expression pattern<br>   --namespace value         filter by pod namespace regular expression pattern<br>   --no-trunc                Show output without truncating the ID (default: false)<br>   --output value, -o value  Output format, One of: json|yaml|table (default: &quot;table&quot;)<br>   --quiet, -q               list only pod IDs (default: false)<br>   --state value, -s value   filter by pod state<br>   --verbose, -v             show verbose info for pods (default: false)<br>   --help, -h                show help (default: false)<br><br></code></pre></td></tr></table></figure><h2 id="åœ¨æ­£åœ¨æ‰§è¡Œçš„å®¹å™¨ä¸Šé¢æ‰§è¡Œå‘½ä»¤"><a href="#åœ¨æ­£åœ¨æ‰§è¡Œçš„å®¹å™¨ä¸Šé¢æ‰§è¡Œå‘½ä»¤" class="headerlink" title="åœ¨æ­£åœ¨æ‰§è¡Œçš„å®¹å™¨ä¸Šé¢æ‰§è¡Œå‘½ä»¤"></a>åœ¨æ­£åœ¨æ‰§è¡Œçš„å®¹å™¨ä¸Šé¢æ‰§è¡Œå‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹è¿è¡Œçš„pod</span><br>root@kind-worker2:/# crictl pods<br>POD ID              CREATED             STATE               NAME                    NAMESPACE           ATTEMPT             RUNTIME<br>5fb86aa7066e8       44 minutes ago      Ready               nginx-76d6c9b8c-q9vbp   default             0                   (default)<br>a4add35241344       4 hours ago         Ready               kube-proxy-6447g        kube-system         0                   (default)<br>403d98dd85f0e       4 hours ago         Ready               kindnet-5mk2k           kube-system         0                   (default)<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</span><br>root@kind-worker2:/# crictl ps<br>CONTAINER           IMAGE               CREATED             STATE               NAME                ATTEMPT             POD ID              POD<br>18cad97f205ca       2b7d6430f78d4       44 minutes ago      Running             nginx               0                   5fb86aa7066e8       nginx-76d6c9b8c-q9vbp<br>eb989888bde0d       d921cee849482       4 hours ago         Running             kindnet-cni         0                   403d98dd85f0e       kindnet-5mk2k<br>476b9aa0e666e       c12a8a85ef17f       4 hours ago         Running             kube-proxy          0                   a4add35241344       kube-proxy-6447g<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨è¿è¡Œçš„å®¹å™¨ä¸Šæ‰§è¡Œå‘½ä»¤</span><br>root@kind-worker2:/# crictl exec -i -t 18cad97f205ca ls<br>bin  boot  dev  docker-entrypoint.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  proc  product_name  product_uuid  root  run  sbin  srv  sys  tmp  usr  var<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br>root@kind-worker2:/# crictl logs 18cad97f205ca<br>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration<br>/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh<br>10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf<br>......<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
      <tag>kind</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sync.Once æºç </title>
    <link href="/2022/09/09/golang/Golang%E5%8C%85/sync.Once/"/>
    <url>/2022/09/09/golang/Golang%E5%8C%85/sync.Once/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><p>Go æ ‡å‡†åº“æä¾›çš„ä½¿å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡çš„å®ç°ï¼Œå¸¸åº”ç”¨äºå•ä¾‹æ¨¡å¼ã€‚</p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>ä¿è¯å˜é‡ä»…è¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ”¯æŒå¹¶å‘ã€‚</p><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p>å› ä¸ºæºç å¾ˆå°‘ï¼Œæ‰€ä»¥å°±ç›´æ¥å…¨éƒ¨å¤åˆ¶ä¸Šæ¥äº†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-keyword">package</span> sync<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;sync/atomic&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Once <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">//æ ‡è®°æ˜¯å¦å®Œæˆåˆå§‹åŒ–</span><br>done <span class="hljs-type">uint32</span><br>    <span class="hljs-comment">//äº’æ–¥é”</span><br>m    Mutex<br>&#125;<br><span class="hljs-comment">// f æ˜¯å¯¹è±¡åˆå§‹åŒ–å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o *Once)</span></span> Do(f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>) &#123;<br><span class="hljs-keyword">if</span> atomic.LoadUint32(&amp;o.done) == <span class="hljs-number">0</span> &#123;<br><span class="hljs-comment">// Outlined slow-path to allow inlining of the fast-path.</span><br>o.doSlow(f)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o *Once)</span></span> doSlow(f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>) &#123;<br>o.m.Lock()<br><span class="hljs-keyword">defer</span> o.m.Unlock()<br><span class="hljs-keyword">if</span> o.done == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">defer</span> atomic.StoreUint32(&amp;o.done, <span class="hljs-number">1</span>)<br>f()<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>GolangåŒ…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sync</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kindæ¦‚å¿µ&amp;å®‰è£…éƒ¨ç½²k8sé›†ç¾¤</title>
    <link href="/2022/09/09/k8s/kind%E6%A6%82%E5%BF%B5&amp;%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2k8s%E9%9B%86%E7%BE%A4/"/>
    <url>/2022/09/09/k8s/kind%E6%A6%82%E5%BF%B5&amp;%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2k8s%E9%9B%86%E7%BE%A4/</url>
    
    <content type="html"><![CDATA[<p><strong>kindï¼š</strong>kubernetes in dockerã€‚å°†k8sæ‰€æœ‰éœ€è¦çš„ç»„ä»¶ï¼Œå…¨éƒ¨éƒ¨ç½²åœ¨ä¸€ä¸ªdockerå®¹å™¨ä¸­ï¼Œä¸€å¥—å¼€ç®±å³ç”¨çš„k8sç¯å¢ƒæ­å»ºæ–¹æ¡ˆ</p><h2 id="Kind-ç›¸æ¯”äº-Minikube-æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ"><a href="#Kind-ç›¸æ¯”äº-Minikube-æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ" class="headerlink" title="Kind ç›¸æ¯”äº Minikube æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ"></a>Kind ç›¸æ¯”äº Minikube æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ</h2><p><strong>åŸºäº</strong> <a href="https://cloud.tencent.com/product/tke?from=10680"><strong>Docker</strong></a> <strong>è€Œä¸æ˜¯è™šæ‹ŸåŒ–</strong></p><p>Kind ä¸æ˜¯æ‰“åŒ…ä¸€ä¸ªè™šæ‹ŸåŒ–é•œåƒï¼Œè€Œæ˜¯ç›´æ¥è®² K8S ç»„ä»¶è¿è¡Œåœ¨ Dockerã€‚å¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p><ol><li>ä¸éœ€è¦è¿è¡Œ GuestOS å ç”¨èµ„æºæ›´ä½ã€‚</li><li>ä¸åŸºäºè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå¯ä»¥åœ¨ VM ä¸­ä½¿ç”¨ã€‚</li><li>æ–‡ä»¶æ›´å°ï¼Œæ›´åˆ©äºç§»æ¤ã€‚</li></ol><p><strong>æ”¯æŒå¤šèŠ‚ç‚¹ K8S é›†ç¾¤å’Œ HA</strong></p><p>Kind æ”¯æŒå¤šè§’è‰²çš„èŠ‚ç‚¹éƒ¨ç½²ï¼Œä½ å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ä½ éœ€è¦å‡ ä¸ª Master èŠ‚ç‚¹ï¼Œå‡ ä¸ª Worker èŠ‚ç‚¹ï¼Œä»¥æ›´å¥½çš„æ¨¡æ‹Ÿç”Ÿäº§ä¸­çš„å®é™…ç¯å¢ƒã€‚</p><h2 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…kubectl-ç¨³å®šæœ€æ–°ç‰ˆæœ¬-1-25-0"><a href="#å®‰è£…kubectl-ç¨³å®šæœ€æ–°ç‰ˆæœ¬-1-25-0" class="headerlink" title="å®‰è£…kubectl(ç¨³å®šæœ€æ–°ç‰ˆæœ¬ 1.25.0)"></a>å®‰è£…kubectl(ç¨³å®šæœ€æ–°ç‰ˆæœ¬ 1.25.0)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -LO &quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;<br>install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl<br>chmod +x kubectl<br>mkdir -p ~/.local/bin<br>mv ./kubectl ~/.local/bin/kubectl<br>kubectl version --client<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…kindï¼ˆæ ¹æ®kubectlçš„ç‰ˆæœ¬å®‰è£…kindï¼Œä¸æ˜“å‡ºé”™å¯æˆåŠŸå®‰è£…ï¼‰"><a href="#å®‰è£…kindï¼ˆæ ¹æ®kubectlçš„ç‰ˆæœ¬å®‰è£…kindï¼Œä¸æ˜“å‡ºé”™å¯æˆåŠŸå®‰è£…ï¼‰" class="headerlink" title="å®‰è£…kindï¼ˆæ ¹æ®kubectlçš„ç‰ˆæœ¬å®‰è£…kindï¼Œä¸æ˜“å‡ºé”™å¯æˆåŠŸå®‰è£…ï¼‰"></a>å®‰è£…kindï¼ˆæ ¹æ®kubectlçš„ç‰ˆæœ¬å®‰è£…kindï¼Œä¸æ˜“å‡ºé”™å¯æˆåŠŸå®‰è£…ï¼‰</h2><p><a href="https://github.com/kubernetes-sigs/kind/releases">Releases Â· kubernetes-sigs/kind Â· GitHub</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.15.0/kind-linux-amd64<br>chmod +x kind<br>mv kind /usr/local/bin<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…ä¸€ä¸ªk8sé›†ç¾¤"><a href="#å®‰è£…ä¸€ä¸ªk8sé›†ç¾¤" class="headerlink" title="å®‰è£…ä¸€ä¸ªk8sé›†ç¾¤"></a>å®‰è£…ä¸€ä¸ªk8sé›†ç¾¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@host-server ~]# kind create cluster<br>Creating cluster &quot;kind&quot; ...<br> âœ“ Ensuring node image (kindest/node:v1.25.0) ğŸ–¼<br> âœ“ Preparing nodes ğŸ“¦<br> âœ“ Writing configuration ğŸ“œ<br> âœ“ Starting control-plane ğŸ•¹ï¸<br> âœ“ Installing CNI ğŸ”Œ<br> âœ“ Installing StorageClass ğŸ’¾<br>Set kubectl context to &quot;kind-kind&quot;<br>You can now use your cluster with:<br><br>kubectl cluster-info --context kind-kind<br><br>Have a nice day! ğŸ‘‹<br>[root@host-server ~]# kubectl cluster-info --context kind-kind<br>Kubernetes control plane is running at https://127.0.0.1:45151<br>CoreDNS is running at https://127.0.0.1:45151/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy<br><br>To further debug and diagnose cluster problems, use &#x27;kubectl cluster-info dump&#x27;.<br><br>[root@host-server home]# kind create cluster --name kind-2<br>Creating cluster &quot;kind-2&quot; ...<br> âœ“ Ensuring node image (kindest/node:v1.25.0) ğŸ–¼<br> âœ“ Preparing nodes ğŸ“¦<br> .....<br><br></code></pre></td></tr></table></figure><h2 id="åˆ é™¤é›†ç¾¤"><a href="#åˆ é™¤é›†ç¾¤" class="headerlink" title="åˆ é™¤é›†ç¾¤"></a>åˆ é™¤é›†ç¾¤</h2><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">kind <span class="hljs-keyword">delete</span> <span class="hljs-keyword">cluster</span><br></code></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶åˆ›å»ºk8sé›†ç¾¤"><a href="#é…ç½®æ–‡ä»¶åˆ›å»ºk8sé›†ç¾¤" class="headerlink" title="é…ç½®æ–‡ä»¶åˆ›å»ºk8sé›†ç¾¤"></a>é…ç½®æ–‡ä»¶åˆ›å»ºk8sé›†ç¾¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@host-server opt]# cat kind-config.yaml<br>kind: Cluster<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é«˜ç‰ˆæœ¬é»˜è®¤æ˜¯è¿™ä¸ªï¼Œç‰ˆæœ¬è¾ƒä½çš„éœ€è¦è¿›è¡Œä¿®æ”¹</span><br>apiVersion: kind.x-k8s.io/v1alpha4<br>nodes:<br>- role: control-plane<br>- role: control-plane<br>- role: control-plane<br>- role: worker<br>- role: worker<br>- role: worker<br>[root@host-server ~]# kind get clusters<br>kind<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ„å»ºæˆåŠŸä¹‹ånodeä¸€ç›´æ˜¯notreadyçš„çŠ¶æ€ï¼Œå¯èƒ½æ˜¯å› ä¸ºç‰ˆæœ¬ä¸å¯¹åº”</span><br>[root@host-server ~]# kubectl get node<br>NAME                  STATUS   ROLES           AGE     VERSION<br>kind-control-plane    Ready    control-plane   9m13s   v1.25.0<br>kind-control-plane2   Ready    control-plane   8m45s   v1.25.0<br>kind-control-plane3   Ready    control-plane   7m56s   v1.25.0<br>kind-worker           Ready    &lt;none&gt;          7m48s   v1.25.0<br>kind-worker2          Ready    &lt;none&gt;          7m48s   v1.25.0<br>kind-worker3          Ready    &lt;none&gt;          7m34s   v1.25.0<br></code></pre></td></tr></table></figure><p>é›†ç¾¤åˆ›å»ºæˆåŠŸ</p>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
      <tag>kind</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰droe æ’ä»¶</title>
    <link href="/2022/09/08/CICD/drone/%E8%87%AA%E5%AE%9A%E4%B9%89drone%20%E6%8F%92%E4%BB%B6/"/>
    <url>/2022/09/08/CICD/drone/%E8%87%AA%E5%AE%9A%E4%B9%89drone%20%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="droneæ’ä»¶"><a href="#droneæ’ä»¶" class="headerlink" title="droneæ’ä»¶"></a>droneæ’ä»¶</h1><p><strong>åˆ¶ä½œåŸç†ï¼š</strong>å‚ç…§å˜é‡çš„æ–¹å¼ï¼ˆPLUGIN_ï¼‰</p><p>åˆ¶ä½œè„šæœ¬æ–‡ä»¶â€”â€”ã€‹å°è£…é•œåƒâ€”â€”ã€‹æ’ä»¶å®Œæˆï¼Œç¼–å†™droneæ–‡ä»¶éªŒè¯æ­£ç¡®æ€§</p><p>æ’ä»¶ä¹Ÿä»…ä»…æ—¶dockers å®¹å™¨ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥é‡‡ç”¨ä»»ä½•è¯­è¨€æ¥å®ç°æ’ä»¶ã€‚å¦‚ä¸‹æ˜¯åŸºäºbashå’Œgoè¯­è¨€æ„æˆæ’ä»¶å†…å®¹.</p><h2 id="åŸºäºbashçš„æ’ä»¶åˆ¶ä½œ"><a href="#åŸºäºbashçš„æ’ä»¶åˆ¶ä½œ" class="headerlink" title="åŸºäºbashçš„æ’ä»¶åˆ¶ä½œ"></a>åŸºäºbashçš„æ’ä»¶åˆ¶ä½œ</h2><ol><li>åˆ¶ä½œè„šæœ¬æ–‡ä»¶</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#! /bin/sh</span><br><br>curl -X <span class="hljs-variable">$&#123;PLUGIN_METHOD&#125;</span> -d <span class="hljs-variable">$&#123;PLUGIN_BODY&#125;</span> <span class="hljs-variable">$&#123;PLUGIN_URL&#125;</span><br></code></pre></td></tr></table></figure><ol><li>åˆ¶ä½œDockerfileæ–‡ä»¶</li></ol><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> alpine:<span class="hljs-number">3.14</span>.<span class="hljs-number">6</span><br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> build.sh /bin/</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /bin/build.sh</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apk -Uuv add curl ca-certificates</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> /bin/build.sh</span><br></code></pre></td></tr></table></figure><p>æ„å»ºé•œåƒï¼šdocker build -t test:v1 .</p><ol><li>.drone.ymlæ–‡ä»¶</li></ol><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">kind: pipeline<br><span class="hljs-keyword">type</span>: docker<br>name: <span class="hljs-keyword">default</span><br><br>steps:<br>- name: greeting<br>  image: test:v1<br>  settings:<br>    url: http:<span class="hljs-comment">//hook.acme.com</span><br>    <span class="hljs-keyword">method</span>: post<br>    body: |<br>      hello world<br><br>node:<br>  foo: bar<br></code></pre></td></tr></table></figure><h2 id="åŸºäºgoè¯­è¨€çš„æ’ä»¶"><a href="#åŸºäºgoè¯­è¨€çš„æ’ä»¶" class="headerlink" title="åŸºäºgoè¯­è¨€çš„æ’ä»¶"></a>åŸºäºgoè¯­è¨€çš„æ’ä»¶</h2><ol><li>ç¼–å†™éœ€æ±‚å¯¹åº”çš„goæ–‡ä»¶</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs stylus">package <span class="hljs-selector-tag">main</span><br><br>import (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;strings&quot;</span><br>)<br><br>func <span class="hljs-selector-tag">main</span>() &#123;<br>    <span class="hljs-selector-tag">body</span> := strings<span class="hljs-selector-class">.NewReader</span>(<br>        os<span class="hljs-selector-class">.Getenv</span>(<span class="hljs-string">&quot;PLUGIN_BODY&quot;</span>),<br>    )<br><br>    _, err := http<span class="hljs-selector-class">.NewRequest</span>(<br>        os<span class="hljs-selector-class">.Getenv</span>(<span class="hljs-string">&quot;PLUGIN_METHOD&quot;</span>),<br>        os<span class="hljs-selector-class">.Getenv</span>(<span class="hljs-string">&quot;PLUGIN_URL&quot;</span>),<br>        <span class="hljs-selector-tag">body</span>,<br>    )<br>    <span class="hljs-keyword">if</span> err != nil &#123;<br>        os<span class="hljs-selector-class">.Exit</span>(<span class="hljs-number">1</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>go build -o wehook</p>]]></content>
    
    
    <categories>
      
      <category>CICD</category>
      
      <category>drone</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>drone</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>minioç¼–è¯‘å¤±è´¥é—®é¢˜åˆ†æ&amp;ç¼–è¯‘å®‰è£…</title>
    <link href="/2022/09/08/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/minio%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <url>/2022/09/08/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/minio%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h1><p>ä¸‹è½½ç¼–è¯‘minioï¼Œç¼–è¯‘å‡ºç°æŠ¥é”™</p><h1 id="é—®é¢˜åˆ†æ-amp-è§£å†³"><a href="#é—®é¢˜åˆ†æ-amp-è§£å†³" class="headerlink" title="é—®é¢˜åˆ†æ&amp;è§£å†³"></a>é—®é¢˜åˆ†æ&amp;è§£å†³</h1><ol><li><p>æŸ¥çœ‹æ˜¯å¦goç‰ˆæœ¬è¾ƒä½å¯¼è‡´</p><p>å¯å‡çº§goç‰ˆæœ¬ï¼Œ</p><p>æ³¨ï¼šå¯ä»¥<code>cat go.mod</code>æŸ¥çœ‹modçš„goç‰ˆæœ¬ï¼Œå¯åŒ¹é…ï¼Œå¦‚æœå®‰è£…çš„ä¸åŒ¹é…ï¼Œgitä¸‹è½½ä¹‹åï¼Œéœ€è¦æ‰§è¡Œ<code>go mod tidy</code>æ ¹æ®ç¯å¢ƒä¿®æ”¹modæ–‡ä»¶ã€‚</p><p>ä»¥ä¸‹ä¸ºgo 1.18å®‰è£…æ­¥éª¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://studygolang.com/dl/golang/go1.18.linux-arm64.tar.gz<br>tar -zxvf go1.18.linux-arm64.tar.gz  -C /usr/local/<br>vim /etc/profile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æœ€åä¸€è¡Œå†™å…¥</span><br>export PATH=$PATH:/usr/local/go/bin<br><br>source /etc/profile<br>go env<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯¼å…¥goä»£ç†</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-built_in">export</span> GOPROXY=https://goproxy.io,direct</span><br>export GOPROXY=https://proxy.golang.org,direct<br></code></pre></td></tr></table></figure></li><li><p>makeè¿‡ç¨‹ä¸­å‡ºç°æ ¡éªŒç ä¸åŒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">go: downloading github.com/google/pprof v0.0.0-20211214055906-6f57359322fd<br>verifying github.com/go-openapi/spec@v0.20.5: checksum mismatch<br>        downloaded: h1:7VP8zufGZEIV+zfSwHGTWgbMINz/WhW3oFsA47Rhjsk=<br>        go.sum:     h1:skHa8av4VnAtJU5zyAUXrrdK/NDiVX8lchbG+BfcdrE=<br><br>SECURITY ERROR<br>This download does NOT match an earlier download recorded in go.sum.<br>The bits may have been replaced on the origin server, or an attacker may<br>have intercepted the download attempt.<br><br>For more information, see &#x27;go help module-auth&#x27;.<br>make: *** [build] Error 1<br><br></code></pre></td></tr></table></figure><ul><li>åœ¨ <code>go.sum</code> æ–‡ä»¶å­˜åœ¨çš„æ—¶å€™ï¼Œåˆ™ä¼šä½¿ç”¨ <code>go.sum</code> é‡Œé¢è®°å½•çš„ä¾èµ– hash å’Œå®é™…ä¸‹è½½çš„ä¾èµ– hash è¿›è¡Œå¯¹æ¯”ï¼Œ å¦‚æœä¸åŒ¹é…ï¼Œä¼šå‡ºç°æŠ¥é”™ï¼›</li><li>å¦‚æœ <code>go.sum</code> ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ <code>GOSUMDB</code> ï¼ˆé»˜è®¤æ˜¯ <a href="https://link.juejin.cn/?target=https://sum.golang.org/">sum.golang.org</a>ï¼‰å¯¹å®é™…ä¸‹è½½çš„ä¾èµ– hash è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœä¸åŒ¹é…ï¼Œåˆ™å‡ºç°é”™è¯¯ï¼›</li></ul><p>è§£å†³æ–¹æ¡ˆ</p><ul><li><p>åˆ é™¤go.sumæˆ–è€…æ¸…é™¤ç¼“å­˜,ç¼–è¯‘ï¼Œå¦‚æœç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°è¶…æ—¶ï¼Œå¯é‡å¤æ‰§è¡Œè¯¥æ­¥éª¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">go clean -modcache<br>rm -f go.sum<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ä»£ç†è®¾ç½®go <span class="hljs-built_in">env</span> GOPROXYï¼Œé‡‡ç”¨é»˜è®¤çš„ï¼šhttps://proxy.golang.org,directï¼Œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ï¼š<span class="hljs-built_in">export</span> GOPROXY=https://proxy.golang.org,direct</span><br>go mod tidy<br> make<br></code></pre></td></tr></table></figure></li><li><p><strong>å¦‚æœå·²ç»åˆ é™¤go.sumä¹‹åï¼Œmodçš„æ—¶å€™æŠ¥é”™æ–‡ä»¶ä¾æ—§ä¸åŒ¹é…ï¼Œå¯é‡‡ç”¨è¯¥æ–¹æ³•</strong> <code>GOSUMDB</code>ï¼Œå³ <code>export GOSUMDB=off</code></p><p><em>å¦‚æœè®¾ç½®äº† GOSUMDB ä¸º â€œoffâ€ æˆ–è€…ä½¿ç”¨ go get çš„æ—¶å€™å¯ç”¨äº†<code>-insecure</code>å‚æ•°ï¼ŒGo ä¸ä¼šå»å¯¹ä¸‹è½½çš„ä¾èµ–åŒ…åšå®‰å…¨æ ¡éªŒï¼Œå­˜åœ¨ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼Œä¸å»ºè®®</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">go clean -modcache<br>rm -f go.sum<br> export GOSUMDB=off<br>go mod tidy<br>make<br></code></pre></td></tr></table></figure></li></ul><p>ç¼–è¯‘æˆåŠŸ</p></li></ol><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><h2 id="MinIO-Server-å®‰è£…"><a href="#MinIO-Server-å®‰è£…" class="headerlink" title="MinIO Server å®‰è£…"></a>MinIO Server å®‰è£…</h2><p><strong>ä»…æ˜¯ç¼–è¯‘minio,ä¸å­˜åœ¨é…ç½®åŠéªŒè¯ï¼Œå¦‚æœéªŒè¯ï¼Œå¯å‚è€ƒ<a href="https://ic-openlabs.huawei.com/client/#/knowledge/details?id=R1S1584D0021871822019121922381091416527">Huawei Kunpeng Innovation Center Flagship Store</a></strong></p><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@8154395e1759 /]# yum install vim wget git make -y<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…go</span><br>[root@8154395e1759 /]# wget https://studygolang.com/dl/golang/go1.18.linux-arm64.tar.gz<br>[root@8154395e1759 /]# tar -zxvf go1.18.linux-arm64.tar.gz  -C /usr/local/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®ç¯å¢ƒå˜é‡</span><br>[root@8154395e1759 /]# cat /etc/profile | tail -n 2<br>unset -f pathmunge<br>export PATH=$PATH:/usr/local/go/bin<br>[root@8154395e1759 /]# go version<br>go version go1.18 linux/arm64<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚çœ‹goä»£ç†çš„é…ç½®</span><br>[root@8154395e1759 /]#  go env GOPROXY<br>https://proxy.golang.org,direct<br></code></pre></td></tr></table></figure><h3 id="ä¸‹è½½minion"><a href="#ä¸‹è½½minion" class="headerlink" title="ä¸‹è½½minion"></a>ä¸‹è½½minion</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@8154395e1759 /]#  git clone https://github.com/minio/minio.git<br>[root@8154395e1759 /]# cd minio/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ›´æ–°ä¸ç¼–è¯‘ç¯å¢ƒå¯¹åº”çš„ä¾èµ–</span><br>[root@8154395e1759 minio]# go mod tidy<br></code></pre></td></tr></table></figure><h3 id="ç¼–è¯‘-1"><a href="#ç¼–è¯‘-1" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@8154395e1759 minio]# make<br>[root@8154395e1759 minio]# make<br>Error generating git commit-time:  parsing time &quot;%cI&quot; as &quot;2006-01-02T15:04:05Z07:00&quot;: cannot parse &quot;%cI&quot; as &quot;2006&quot;<br>exit status 1<br>Checking dependencies<br>Building minio binary to &#x27;./minio&#x27;<br>[root@8154395e1759 minio]# ls -al ./minio<br>-rwxr-xr-x 1 root root 119773941 Sep  6 08:02 ./minio<br></code></pre></td></tr></table></figure><h2 id="MinIO-Client-å®‰è£…"><a href="#MinIO-Client-å®‰è£…" class="headerlink" title="MinIO Client å®‰è£…"></a>MinIO Client å®‰è£…</h2><h3 id="ä¸‹è½½-amp-ç¼–è¯‘"><a href="#ä¸‹è½½-amp-ç¼–è¯‘" class="headerlink" title="ä¸‹è½½&amp;ç¼–è¯‘"></a>ä¸‹è½½&amp;ç¼–è¯‘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@8154395e1759 /]# git clone https://github.com/minio/mc.git<br>[root@8154395e1759 /]# cd mc/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ›´æ–°ä¸ç¼–è¯‘ç¯å¢ƒå¯¹åº”çš„ä¾èµ–</span><br>[root@8154395e1759 mc]# go mod tidy<br>[root@8154395e1759 mc]# make<br>Error generating git commit-time:  parsing time &quot;%cI&quot; as &quot;2006-01-02T15:04:05Z07:00&quot;: cannot parse &quot;%cI&quot; as &quot;2006&quot;<br>exit status 1<br>Checking dependencies<br>Building mc binary to &#x27;./mc&#x27;<br>[root@8154395e1759 mc]# ls -al ./mc<br>-rwxr-xr-x 1 root root 32852718 Sep  6 08:18 ./mc<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>minio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>harboré•œåƒå†…å®¹è‡ªåŠ¨åŒ–åŒæ­¥metabese</title>
    <link href="/2022/09/08/CICD/drone/harbor%E4%BF%A1%E6%81%AF%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <url>/2022/09/08/CICD/drone/harbor%E4%BF%A1%E6%81%AF%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><p>è·å–harborä¸­ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»“åº“ã€é•œåƒåç§°ã€ç‰ˆæœ¬ã€æ¶æ„ç­‰ï¼Œå­˜å‚¨åˆ°metabaseå¯¹åº”çš„æ•°æ®åº“ä¸­ã€‚</p><h2 id="Droneè‡ªåŠ¨åŒ–å·¥ç¨‹"><a href="#Droneè‡ªåŠ¨åŒ–å·¥ç¨‹" class="headerlink" title="Droneè‡ªåŠ¨åŒ–å·¥ç¨‹"></a>Droneè‡ªåŠ¨åŒ–å·¥ç¨‹</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">pipeline</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">docker</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">default</span><br><br><span class="hljs-attr">volumes:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor</span><br>  <span class="hljs-attr">host:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/data/harbor/Doc</span><br><br><span class="hljs-attr">steps:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">greeting</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">IP:8085/images/harbor_data:v1</span><br>  <span class="hljs-attr">settings:</span><br>    <span class="hljs-attr">admin:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">Harbor12345</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">IP:8085</span><br>  <span class="hljs-attr">volumes:</span> <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/</span><br>  <br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor_table</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">IP:8085/images/harbor_database:v1</span><br>  <span class="hljs-comment">#æ•°æ®åº“ç¯å¢ƒä¿¡æ¯</span><br>  <span class="hljs-attr">settings:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-string">testdb</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">postgres</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">IP</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">10590</span><br>  <span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/</span><br>  <span class="hljs-attr">commands:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">python</span> <span class="hljs-string">/harbor_flush.py</span><br><span class="hljs-comment">#ç§æœ‰é•œåƒè·å–å¯†é’¥</span><br><span class="hljs-attr">image_pull_secrets:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">dockerconfigjson</span><br><span class="hljs-comment">#é€‰æ‹©è¿è¡ŒæœåŠ¡å™¨</span><br><span class="hljs-attr">node:</span><br>  <span class="hljs-attr">foo:</span> <span class="hljs-string">bar</span><br></code></pre></td></tr></table></figure><h2 id="IP-8085-images-harbor-data-v1ã€IP-8085-images-harbor-database-v1çš„ä½¿ç”¨æ–¹å¼"><a href="#IP-8085-images-harbor-data-v1ã€IP-8085-images-harbor-database-v1çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="IP:8085/images/harbor_data:v1ã€IP:8085/images/harbor_database:v1çš„ä½¿ç”¨æ–¹å¼"></a>IP:8085/images/harbor_data:v1ã€IP:8085/images/harbor_database:v1çš„ä½¿ç”¨æ–¹å¼</h2><h3 id="IP-8085-images-harbor-data-v1"><a href="#IP-8085-images-harbor-data-v1" class="headerlink" title="IP:8085/images/harbor_data:v1"></a>IP:8085/images/harbor_data:v1</h3><p><strong>ä½œç”¨ï¼š</strong>è·å–ç§æœ‰ä»“åº“ï¼ˆharborï¼‰ä¸­æ‰€æœ‰çš„é•œåƒæ‰€å±ä»“åº“ã€é•œåƒåç§°ã€æ¶æ„ç­‰ä¿¡æ¯ï¼Œå¹¶ä¿å­˜æˆ.csvçš„æ ¼å¼ï¼ˆ<em>åç»­å¯ä¼˜åŒ–æˆä¿å­˜æ–‡ä»¶æ ¼å¼è‡ªé€‰</em>ï¼‰</p><p><strong>å‚æ•°ï¼š</strong></p><p>admin:harborç™»å½•è´¦å·</p><p>passwordï¼šå¯†ç </p><p>addressï¼šharborä»“åº“åœ°å€</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">admin: XXX<br>password: XXX<br><span class="hljs-selector-tag">address</span>: XX<span class="hljs-selector-class">.XX</span><span class="hljs-selector-class">.XX</span><span class="hljs-selector-class">.XX</span>:<span class="hljs-number">8085</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p>å¦‚æœéœ€è¦è·å–.csvçš„æ–‡ä»¶ï¼Œéœ€è¦æ˜ å°„å®¹å™¨å†…éƒ¨çš„optç›®å½•è·å–ã€‚</p><h3 id="IP-8085-images-harbor-database-v1"><a href="#IP-8085-images-harbor-database-v1" class="headerlink" title="IP:8085/images/harbor_database:v1"></a>IP:8085/images/harbor_database:v1</h3><p><strong>ä½œç”¨ï¼š</strong>å°†å‰è€…è·å–åˆ°çš„é•œåƒä¿¡æ¯æ›´æ–°è‡³æ•°æ®åº“ä¸­ï¼Œè¯¥æ•°æ®åº“ä»…ä¸ºpgæ•°æ®åº“ï¼ˆ<em>åç»­å¯ä¼˜åŒ–æˆæ•°æ®åº“çš„é€‰å–ï¼Œç±»ä¼¼MySQLã€pgç­‰ç­‰</em>ï¼‰</p><p><strong>å‚æ•°ï¼š</strong></p><p>database:æ•°æ®åº“åç§°</p><p>user:ç”¨æˆ·å</p><p>passwordï¼šæ•°æ®åº“å¯†ç </p><p>hostï¼šæœåŠ¡å™¨åœ°å€</p><p>portï¼šæ•°æ®åº“æœåŠ¡å™¨ç«¯å£</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">database:</span> xx<br><span class="hljs-symbol">user:</span> xx<br><span class="hljs-symbol">password:</span> xx<br><span class="hljs-symbol">host:</span> xx<br><span class="hljs-symbol">port:</span> xx<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p>.csvçš„æ–‡ä»¶ï¼Œéœ€è¦å°†æ–‡ä»¶æ˜ å°„å®¹å™¨å†…éƒ¨çš„optç›®å½•è¿›è¡Œè·å–ã€‚</p><h2 id="harboré•œåƒè·å–è®¾ç½®"><a href="#harboré•œåƒè·å–è®¾ç½®" class="headerlink" title="harboré•œåƒè·å–è®¾ç½®"></a>harboré•œåƒè·å–è®¾ç½®</h2><p>å¯†ç ç®¡ç†</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">echo -n &#x27;admin:Harbor<span class="hljs-number">1234</span>5&#x27; <span class="hljs-string">| base64</span><br></code></pre></td></tr></table></figure><p>é•œåƒç®¡ç†</p><p>name: dockerconfigjson</p><p>value: </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;auths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;XX.XX.XX.XX:8085&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;YWRtaW46SGFyYm9yMTIzNDU=&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><strong>ä½œç”¨ï¼š</strong>é€šè¿‡è¯¥è®¾ç½®è·å–ç§æœ‰ä»“åº“é•œåƒ</p>]]></content>
    
    
    <categories>
      
      <category>CICD</category>
      
      <category>drone</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>harbor</tag>
      
      <tag>drone</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSVæ•°æ®åŒæ­¥pg</title>
    <link href="/2022/09/08/CICD/drone/harbor-database/"/>
    <url>/2022/09/08/CICD/drone/harbor-database/</url>
    
    <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>æ›´æ–°harboræ•°æ®ï¼ˆharbor-<code>date &#39;+%Y-%m-%d&#39;</code>.csvï¼‰åˆ°æ•°æ®åº“ï¼ˆpgï¼‰ã€‚</p><p>å¯ä½œä¸ºdroneæ’ä»¶ï¼ˆå°†ä¼ å…¥çš„å€¼ä½œä¸ºç¯å¢ƒå˜é‡è·å–ï¼‰ä½¿ç”¨ã€‚</p><p><em>æ³¨ï¼šè¯¥æ–‡æ¡£éœ€è¦å›ºå®šæ•°æ®åº“ç±»å‹ï¼Œcsvæ ¼å¼ç­‰</em></p><h2 id="åˆ¶ä½œæ­¥éª¤"><a href="#åˆ¶ä½œæ­¥éª¤" class="headerlink" title="åˆ¶ä½œæ­¥éª¤"></a>åˆ¶ä½œæ­¥éª¤</h2><p>harbor_flush.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> StringIO<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> psycopg2<br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><span class="hljs-comment">#è¿æ¥æ•°æ®åº“ï¼Œos.getenvè·å–ç¯å¢ƒå˜é‡</span><br>   conn=psycopg2.connect(database=os.getenv(<span class="hljs-string">&#x27;PLUGIN_DATABASE&#x27;</span>),user=os.getenv(<span class="hljs-string">&#x27;PLUGIN_USER&#x27;</span>),password=os.getenv(<span class="hljs-string">&#x27;PLUGIN_PASSWORD&#x27;</span>),host=os.getenv(<span class="hljs-string">&#x27;PLUGIN_HOST&#x27;</span>),port=os.getenv(<span class="hljs-string">&#x27;PLUGIN_PORT&#x27;</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Opened database successfully&quot;</span>)<br>    cur=conn.cursor()<br>    <span class="hljs-comment">#å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨åˆ›å»ºæ•°æ®åº“</span><br>    cur.execute(<span class="hljs-string">&#x27;&#x27;&#x27;CREATE TABLE if not exists harbor_table (</span><br><span class="hljs-string">        repoaddress VARCHAR(255),</span><br><span class="hljs-string">        storehouse VARCHAR(255),</span><br><span class="hljs-string">        image  VARCHAR(255),</span><br><span class="hljs-string">        version  VARCHAR(255),</span><br><span class="hljs-string">        arch  VARCHAR(255),</span><br><span class="hljs-string">        command  VARCHAR(255)</span><br><span class="hljs-string">        );&#x27;&#x27;&#x27;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Table created successfully&quot;</span>)<br><br>    cur.execute(<span class="hljs-string">&quot;TRUNCATE TABLE harbor_table;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Table truncate successfully&quot;</span>)<br>    conn.commit()<br>    filename=<span class="hljs-string">&#x27;/opt/harbor-&#x27;</span>+<span class="hljs-built_in">str</span>(datetime.date.today())+<span class="hljs-string">&#x27;.csv&#x27;</span><br>    f=<span class="hljs-built_in">open</span>(filename,<span class="hljs-string">&#x27;r&#x27;</span>,encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>    <span class="hljs-comment">#åŒæ­¥csvæ–‡ä»¶</span><br>    <span class="hljs-keyword">try</span>:<br>        cur.copy_from(f, <span class="hljs-string">&#x27;harbor_table&#x27;</span>, sep=<span class="hljs-string">&#x27;,&#x27;</span>, null=<span class="hljs-string">&#x27;&#x27;</span>)<br>        conn.commit()<br>    <span class="hljs-keyword">except</span> (Exception, psycopg2.DatabaseError) <span class="hljs-keyword">as</span> error:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error: %s&quot;</span> % error)<br><br>    conn.close()<br></code></pre></td></tr></table></figure><p>Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.9</span>-alpine3.<span class="hljs-number">13</span><br><span class="hljs-comment">#ä¸‹è½½ä¾èµ–</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apk/repositories &amp;&amp; \</span><br><span class="language-bash">    apk add build-base postgresql-dev &amp;&amp; \</span><br><span class="language-bash">    pip install psycopg2 pandas openpyxl</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> harbor_flush.py ./</span><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>drone</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">pipeline</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">docker</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">default</span><br><br><span class="hljs-attr">platform:</span><br>    <span class="hljs-attr">os:</span> <span class="hljs-string">linux</span><br>    <span class="hljs-attr">arch:</span> <span class="hljs-string">amd64</span><br>    <br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor</span><br>    <span class="hljs-attr">host:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/data/harbor/Doc</span><br><span class="hljs-comment">#åŒæ­¥æ•°æ®åº“</span><br><span class="hljs-attr">steps:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor_database</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">IP:8085/image_amd64/harbor_database:v1</span><br>  <span class="hljs-attr">settings:</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-string">testdb</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">postgres</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">10.100</span><span class="hljs-number">.93</span><span class="hljs-string">.X</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">10590</span><br>  <span class="hljs-attr">volumes:</span> <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/</span><br>  <span class="hljs-attr">commands:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">python</span> <span class="hljs-string">harbor_flush.py</span><br></code></pre></td></tr></table></figure><p>docker å‘½ä»¤è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it --rm -e PLUGIN_DATBASE=testdb -e PLUGIN_USER=postgres -e PLUGIN_PASSWORD=123456 -e PLUGIN_HOST=10.100.93.X -e PLUGIN_PORT=10590 -v $PWD:/opt IP:8085/image_amd64/harbor_database:v1 sh<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>æˆåŠŸå†™å…¥æ•°æ®åº“ä¸­</p>]]></content>
    
    
    <categories>
      
      <category>CICD</category>
      
      <category>drone</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>harbor</tag>
      
      <tag>drone</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shellè„šæœ¬è·å–haborä»“åº“ä¿¡æ¯</title>
    <link href="/2022/09/08/CICD/drone/habor-data/"/>
    <url>/2022/09/08/CICD/drone/habor-data/</url>
    
    <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>é•œåƒè·å–harborå·¥ç¨‹ä¸­æ‰€æœ‰çš„ä»“åº“ã€é•œåƒåç§°ã€é•œåƒç‰ˆæœ¬ã€é•œåƒæ¶æ„</p><p>å¯ä½œä¸ºdroneæ’ä»¶ä½¿ç”¨</p><h2 id="åˆ¶ä½œæ­¥éª¤"><a href="#åˆ¶ä½œæ­¥éª¤" class="headerlink" title="åˆ¶ä½œæ­¥éª¤"></a>åˆ¶ä½œæ­¥éª¤</h2><p>build.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é•œåƒæ¸…å•æ–‡ä»¶ï¼Œå°†è·å–åˆ°çš„é•œåƒä¿¡æ¯å­˜åˆ°è¯¥æ–‡ä»¶ä¸­</span><br>File=harbor-`date &#x27;+%Y-%m-%d&#x27;`.csv<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®çš„ä¸ºdroneçš„å˜é‡</span><br>USER=$PLUGIN_ADMIN<br>PASS=$PLUGIN_PASSWORD<br>TOU=$PLUGIN_ADDRESS<br>HURL=&quot;https://$TOU/api/v2.0&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># è·å–Harborä¸­æœ‰å“ªäº›é¡¹ç›®ï¼ˆProjectï¼‰</span></span><br>Project_List=$(curl -k  -s -u &quot;$USER:$PASS&quot; $HURL/projects | sed &#x27;s/,/\n/g&#x27; | grep -w name | awk -F &quot;\&quot;&quot; &#x27;&#123;print $4&#125;&#x27;)<br><br>for Project in $Project_List;do<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">å¾ªç¯è·å–æ¯ä¸ªé¡¹ç›®ä¸‹æ‰€æœ‰çš„é•œåƒ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Image_Names=$(curl -k  -s -u <span class="hljs-string">&quot;<span class="hljs-variable">$USER</span>:<span class="hljs-variable">$PASS</span>&quot;</span>  -X GET <span class="hljs-variable">$HURL</span>/search?q=<span class="hljs-variable">$Project</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> | python -m json.tool | grep <span class="hljs-string">&quot;repository_name&quot;</span> | awk -F <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="hljs-string">&quot;\&quot;&quot;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br> Image_Names=$(curl -k  -s -u &quot;$USER:$PASS&quot;  -X GET $HURL/search?q=$Project -H &quot;Content-Type: application/json&quot; | sed &#x27;s/,/\n/g&#x27; | grep &quot;repository_name&quot; | awk -F &quot;\&quot;&quot; &#x27;&#123;print $4&#125;&#x27; | awk -F &quot;$Project&quot; &#x27;&#123;$1=&quot;&quot;;print&#125;&#x27; | awk -F &quot;/&quot; &#x27;&#123;$1=&quot;&quot;;print&#125;&#x27; | awk &#x27;$1=$1&#x27; | sed &#x27;s/ /%252F/g&#x27;)<br>   for Image in $Image_Names;do<br><span class="hljs-meta prompt_"># </span><span class="language-bash">   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;https://<span class="hljs-variable">$TOU</span>/<span class="hljs-variable">$Project</span>/<span class="hljs-variable">$Image</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$allImage</span></span><br>    # å¾ªç¯è·å–æ¯ä¸ªé•œåƒæ‰€æœ‰çš„æ ‡ç­¾ï¼ˆç‰ˆæœ¬ï¼‰<br>    Image_Tags=$(curl -k  -s -u &quot;$USER:$PASS&quot; $HURL/projects/$Project/repositories/$Image/artifacts | sed &#x27;s/,/\n/g&#x27; | grep name | sed -e &#x27;s/.\&#123;8\&#125;//&#x27; -e &#x27;s/&quot;$//&#x27; )<br>        for Tag in $Image_Tags;do<br>        arch=$(curl -k  -s -u &quot;$USER:$PASS&quot; $HURL/projects/$Project/repositories/$Image/artifacts/$Tag  | sed &#x27;s/,/\n/g&#x27; | grep architecture | awk -F &quot;\&quot;&quot; &#x27;&#123;print $6&#125;&#x27;)<br>        # å°†è·å–åˆ°çš„é•œåƒå®Œæ•´è·¯å¾„å­˜æ¡£åˆ°é•œåƒæ¸…å•æ–‡ä»¶<br>        #echo &quot;https://$TOU/$Project/$Image:$Tag&quot; | grep -v Base | grep -v Image | grep -v CentOS &gt;&gt;  $File<br>        image=$(echo &quot;$Image&quot; | sed &#x27;s/%252F/\//g&#x27;)<br>         echo &quot;$TOU,$Project,$image,$Tag,$arch,docker pull $TOU/$Project/$image:$Tag&quot; &gt;&gt;  /opt/$File<br>        done<br>    done<br>done<br>exec &quot;$@&quot;<br></code></pre></td></tr></table></figure><p>Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> alpine:<span class="hljs-number">3.14</span>.<span class="hljs-number">6</span><br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> build.sh /bin/</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /bin/build.sh</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apk/repositories &amp;&amp; \</span><br><span class="language-bash">    apk -Uuv add curl ca-certificates</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> /bin/build.sh</span><br><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>drone</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">pipeline</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">docker</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">default</span><br><br><span class="hljs-attr">platform:</span><br>    <span class="hljs-attr">os:</span> <span class="hljs-string">linux</span><br>    <span class="hljs-attr">arch:</span> <span class="hljs-string">amd64</span><br>    <br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor</span><br>    <span class="hljs-attr">host:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/data/harbor/Doc</span><br><span class="hljs-attr">steps:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">greeting</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">IP:8085/image_amd64/harbor_data:v1</span><br>  <span class="hljs-attr">settings:</span><br>    <span class="hljs-attr">admin:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">Harbor12345</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">IP:8085</span><br>  <span class="hljs-attr">volumes:</span> <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/</span><br></code></pre></td></tr></table></figure><p>docker å‘½ä»¤è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it --rm -e PLUGIN_ADMIN=admin -e PLUGIN_PASSWORD=Harbor12345 -e PLUGIN_ADDRESS=IP:8085 -v $PWD:/opt/ IP:8085/image_amd64/harbor_data:v1 sh<br></code></pre></td></tr></table></figure><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>ä¼šåœ¨æ˜ å°„ç›®å½•ä¿å­˜harbor-<code>date &#39;+%Y-%m-%d&#39;</code>æ ¼å¼çš„æ–‡ä»¶</p>]]></content>
    
    
    <categories>
      
      <category>CICD</category>
      
      <category>drone</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>harbor</tag>
      
      <tag>drone</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åç¨‹æ³„éœ²</title>
    <link href="/2022/09/08/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/%E5%8D%8F%E7%A8%8B%E6%B3%84%E9%9C%B2/"/>
    <url>/2022/09/08/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/%E5%8D%8F%E7%A8%8B%E6%B3%84%E9%9C%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><p>goroutineåˆ›å»ºåï¼Œé•¿æ—¶é—´å¾—ä¸åˆ°é‡Šæ”¾ï¼Œå¹¶ä¸”ä¸æ–­åœ°åˆ›å»ºæ–°çš„goroutineåç¨‹ï¼ˆå°½ç®¡åç¨‹è½»é‡ï¼Œä½†ä¹Ÿé€ ä¸ä½æŒ‡æ•°çº§é€’å¢ï¼‰ï¼Œå¯¼è‡´å†…å­˜è€—å°½ï¼Œç¨‹åºå´©æºƒã€‚</p><h1 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h1>]]></content>
    
    
    
    <tags>
      
      <tag>goroutine</tag>
      
      <tag>go</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>timeåŒ…æ–¹æ³•è¯¦è§£</title>
    <link href="/2022/09/08/golang/Golang%E5%8C%85/Time/"/>
    <url>/2022/09/08/golang/Golang%E5%8C%85/Time/</url>
    
    <content type="html"><![CDATA[<h1 id="time-Now"><a href="#time-Now" class="headerlink" title="time.Now"></a>time.Now</h1><p>è·å–å½“å‰æ—¶é—´.</p><h1 id="time-Until"><a href="#time-Until" class="headerlink" title="time.Until"></a>time.Until</h1><p>ä¿å­˜æ—¶é—´å€¼tï¼Œç”¨äºè¯„ä¼°ç›´åˆ°æ—¶é—´tçš„æŒç»­æ—¶é—´</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">//è·å–å½“å‰æ—¶é—´</span><br>t := time.Now()<br>fmt.Println(<span class="hljs-string">&quot;Duration until t:&quot;</span>, time.Until(t)) <span class="hljs-comment">//Duration until t: -112ns</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="time-AfterFunc"><a href="#time-AfterFunc" class="headerlink" title="time.AfterFunc"></a>time.AfterFunc</h1><p>ç”¨äºç­‰å¾…ç»è¿‡çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯åœ¨ç»å†æ—¶é—´ä¹‹åæ‰§è¡Œæ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>waitchan := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br>time.AfterFunc(time.Second*<span class="hljs-number">5</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;AfterFunc excuted&quot;</span>)<br>waitchan &lt;- <span class="hljs-number">1</span><br>&#125;)<br>&lt;-waitchan<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>GolangåŒ…</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>äº’æ–¥é”-sync.Mutex</title>
    <link href="/2022/09/06/golang/Golang%E5%8C%85/%E4%BA%92%E6%96%A5%E9%94%81-sync.Mutex/"/>
    <url>/2022/09/06/golang/Golang%E5%8C%85/%E4%BA%92%E6%96%A5%E9%94%81-sync.Mutex/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><p>goè¯­è¨€ä¸­çš„ä¸€ç§äº’æ–¥é”ï¼Œä¿è¯åŒæ­¥çš„ä¸€ç§å·¥å…·ã€‚</p><p>å®ç°åç¨‹å¯¹äº’æ–¥èµ„æºçš„è®¿é—®ï¼Œå…¶ä¸­ï¼Œ<code>Lock()</code>ç”¨äºäº‰å¤ºé”èµ„æºï¼Œ<code>Unlock()</code>ç”¨äºé‡Šæ”¾é”èµ„æºå¹¶å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„åç¨‹ã€‚åœ¨æ­£å¸¸çš„ä½¿ç”¨æƒ…å†µä¸‹ï¼ˆå¦‚ä»£ç æ‰€ç¤ºï¼‰ï¼Œåªæœ‰è¿›å…¥ä¸´ç•ŒåŒºçš„åç¨‹ä¼šæ‰§è¡Œ<code>Unlock()</code>ã€‚å› æ­¤ï¼Œ<strong>åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªåç¨‹å¯ä»¥æ‰§è¡Œ<code>Unlock()</code>æ–¹æ³•</strong>ã€‚</p><h1 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h1><ul><li>é¿å…å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶åˆ»æ“ä½œåŒä¸€æ•°æ®å—ã€‚</li><li>åè°ƒå¤šä¸ªçº¿ç¨‹ï¼Œé¿å…åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡ŒåŒä¸€ä¸ªä»£ç å—</li></ul><h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mu sync.Mutex<br>mu.Lock() <span class="hljs-comment">// åŠ é”</span><br><span class="hljs-comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span><br>mu.Unlock() <span class="hljs-comment">// é‡Šæ”¾é”</span><br></code></pre></td></tr></table></figure><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//ç»“æ„ä½“</span><br><span class="hljs-keyword">type</span> Mutex <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">//äº’æ–¥é”</span><br>state <span class="hljs-type">int32</span><br>sema  <span class="hljs-type">uint32</span><br>&#125;<br><span class="hljs-comment">//å¸¸é‡</span><br><span class="hljs-keyword">const</span> (<br>mutexLocked = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-literal">iota</span> <span class="hljs-comment">// mutex is locked</span><br>mutexWoken<br>mutexStarving<br>mutexWaiterShift = <span class="hljs-literal">iota</span><br><br>starvationThresholdNs = <span class="hljs-number">1e6</span><br>)<br></code></pre></td></tr></table></figure><p><strong>çŠ¶æ€äºŒè¿›åˆ¶è¡¨ç¤º</strong></p><table><thead><tr><th>å­—æ®µ</th><th>åè¿›åˆ¶</th><th>äºŒè¿›åˆ¶</th><th>åç§°</th></tr></thead><tbody><tr><td>mutexLocked</td><td>1</td><td>0001</td><td>åŠ é”</td></tr><tr><td>mutexUnLocked</td><td>0</td><td>0000</td><td>æœªåŠ é”</td></tr><tr><td>mutexWoken</td><td>2</td><td>0010</td><td>å”¤é†’</td></tr><tr><td>mutexStarving</td><td>4</td><td>0100</td><td>é¥¥é¥¿</td></tr><tr><td>mutexWaiterShift</td><td>3</td><td>0011</td><td>ä»£è¡¨ä½ç§»</td></tr></tbody></table><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">type</span> <span class="hljs-type">Locker</span> interface &#123;<br><span class="hljs-type">Lock</span>()<br><span class="hljs-type">Unlock</span>()<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><ol><li>å•åç¨‹è·å–é”ï¼Œé€šè¿‡CASæŠŠstateçŠ¶æ€ä»0è®¾ç½®æˆ1ï¼ŒåŠ é”æˆåŠŸåè¿”å›</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span></span> Lock() &#123;<br><span class="hljs-comment">// Fast path: grab unlocked mutex.</span><br>    <span class="hljs-comment">//CSAåˆ¤æ–­é”çš„çŠ¶æ€ï¼Œå¦‚æœæ‰§è¡ŒCASæŠŠäº’æ–¥é”çŠ¶æ€ä»0è®¾ç½®æˆ1ï¼Œåˆ™åŠ é”æˆåŠŸï¼Œè¿”å›</span><br><span class="hljs-keyword">if</span> atomic.CompareAndSwapInt32(&amp;m.state, <span class="hljs-number">0</span>, mutexLocked) &#123;<br>        <span class="hljs-comment">//raceæ£€æµ‹</span><br><span class="hljs-keyword">if</span> race.Enabled &#123;<br>race.Acquire(unsafe.Pointer(m))<br>&#125;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">// å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œè®¾ç½®å¤±è´¥ä¹‹åï¼Œè¡¨ç¤ºå­˜åœ¨å†²çªï¼Œæ‰§è¡Œè¯¥æ–¹å¼</span><br>m.lockSlow()<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="lockSlow"><a href="#lockSlow" class="headerlink" title="lockSlow"></a>lockSlow</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span></span> lockSlow() &#123;<br><span class="hljs-keyword">var</span> waitStartTime <span class="hljs-type">int64</span><br>    <span class="hljs-comment">//é¥¥é¥¿çŠ¶æ€</span><br>starving := <span class="hljs-literal">false</span><br>    <span class="hljs-comment">//å”¤é†’çŠ¶æ€</span><br>awoke := <span class="hljs-literal">false</span><br>    <span class="hljs-comment">//å¾ªç¯æ¬¡æ•°</span><br>iter := <span class="hljs-number">0</span><br>    <span class="hljs-comment">//å½“å‰é”çš„çŠ¶æ€</span><br>old := m.state<br>    <span class="hljs-comment">//å¾ªç¯</span><br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-comment">// Don&#x27;t spin in starvation mode, ownership is handed off to waiters</span><br><span class="hljs-comment">// so we won&#x27;t be able to acquire the mutex anyway.</span><br>        <span class="hljs-comment">//ä¸è¦åœ¨é¥¥é¥¿æ¨¡å¼ä¸‹æ—‹è½¬ï¼Œæ‰€æœ‰æƒå°†ç§»äº¤ç»™æœåŠ¡å‘˜ï¼Œæ‰€ä»¥æˆ‘é—¨ä¸å†è·å¾—é”</span><br>        <span class="hljs-comment">//åˆ¤æ–­old&amp;(0001|0100)==0001â€”â€”ã€‹old&amp;0101æ˜¯å¦ç­‰äº0001ï¼Œåˆ™oldåªèƒ½ä¸º0001ï¼ˆåŠ é”ï¼‰ç­‰ï¼Œä¸å¯èƒ½æ˜¯è¢«å”¤é†’æˆ–è€…é¥¥é¥¿çŠ¶æ€</span><br><span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexStarving) == mutexLocked &amp;&amp; runtime_canSpin(iter) &#123;<br><span class="hljs-comment">// Active spinning makes sense.</span><br><span class="hljs-comment">// Try to set mutexWoken flag to inform Unlock</span><br><span class="hljs-comment">// to not wake other blocked goroutines.</span><br>            <span class="hljs-comment">//å°†è‡ªå·±çš„çŠ¶æ€ä»¥åŠé”çš„çŠ¶æ€è®¾ç½®ä¸ºå”¤é†’ï¼Œè¿™æ ·å½“Unlockçš„æ—¶å€™å°±ä¸ä¼šå»å”¤é†’å…¶å®ƒè¢«é˜»å¡çš„goroutineäº†</span><br><span class="hljs-keyword">if</span> !awoke &amp;&amp; old&amp;mutexWoken == <span class="hljs-number">0</span> &amp;&amp; old&gt;&gt;mutexWaiterShift != <span class="hljs-number">0</span> &amp;&amp;<br>atomic.CompareAndSwapInt32(&amp;m.state, old, old|mutexWoken) &#123;<br>awoke = <span class="hljs-literal">true</span><br>&#125;<br>            <span class="hljs-comment">//è‡ªä¸»æ—‹è½¬</span><br>runtime_doSpin()<br>iter++<br>            <span class="hljs-comment">//æ›´æ–°é”çš„çŠ¶æ€</span><br>old = m.state<br><span class="hljs-keyword">continue</span><br>&#125;<br>        <br>          <span class="hljs-comment">// åˆ°äº†è¿™ä¸€æ­¥ï¼Œ stateçš„çŠ¶æ€å¯èƒ½æ˜¯ï¼š</span><br>          <span class="hljs-comment">// 1. é”è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œé”å¤„äºæ­£å¸¸çŠ¶æ€</span><br>          <span class="hljs-comment">// 2. é”è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œ é”å¤„äºé¥¥é¥¿çŠ¶æ€</span><br>          <span class="hljs-comment">// 3. é”å·²ç»è¢«é‡Šæ”¾ï¼Œ é”å¤„äºæ­£å¸¸çŠ¶æ€</span><br>          <span class="hljs-comment">// 4. é”å·²ç»è¢«é‡Šæ”¾ï¼Œ é”å¤„äºé¥¥é¥¿çŠ¶æ€</span><br>          <span class="hljs-comment">//</span><br><span class="hljs-built_in">new</span> := old<br><span class="hljs-comment">// Don&#x27;t try to acquire starving mutex, new arriving goroutines must queue.</span><br>        <span class="hljs-comment">//è·å–ä¸æ˜¯é¥¥é¥¿é”çŠ¶æ€ï¼Œæ–°åˆ°è¾¾çš„åç¨‹åœ¨é˜Ÿåˆ—ä¸­</span><br>        <span class="hljs-comment">//old&amp;0100==0000</span><br><span class="hljs-keyword">if</span> old&amp;mutexStarving == <span class="hljs-number">0</span> &#123;<br><span class="hljs-built_in">new</span> |= mutexLocked<br>&#125;<br><span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexStarving) != <span class="hljs-number">0</span> &#123;<br><span class="hljs-built_in">new</span> += <span class="hljs-number">1</span> &lt;&lt; mutexWaiterShift<br>&#125;<br><span class="hljs-comment">// The current goroutine switches mutex to starvation mode.</span><br><span class="hljs-comment">// But if the mutex is currently unlocked, don&#x27;t do the switch.</span><br><span class="hljs-comment">// Unlock expects that starving mutex has waiters, which will not</span><br><span class="hljs-comment">// be true in this case.</span><br><span class="hljs-keyword">if</span> starving &amp;&amp; old&amp;mutexLocked != <span class="hljs-number">0</span> &#123;<br><span class="hljs-built_in">new</span> |= mutexStarving<br>&#125;<br><span class="hljs-keyword">if</span> awoke &#123;<br><span class="hljs-comment">// The goroutine has been woken from sleep,</span><br><span class="hljs-comment">// so we need to reset the flag in either case.</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span>&amp;mutexWoken == <span class="hljs-number">0</span> &#123;<br>throw(<span class="hljs-string">&quot;sync: inconsistent mutex state&quot;</span>)<br>&#125;<br><span class="hljs-built_in">new</span> &amp;^= mutexWoken<br>&#125;<br><span class="hljs-keyword">if</span> atomic.CompareAndSwapInt32(&amp;m.state, old, <span class="hljs-built_in">new</span>) &#123;<br><span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexStarving) == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">break</span> <span class="hljs-comment">// locked the mutex with CAS</span><br>&#125;<br><span class="hljs-comment">// If we were already waiting before, queue at the front of the queue.</span><br>queueLifo := waitStartTime != <span class="hljs-number">0</span><br><span class="hljs-keyword">if</span> waitStartTime == <span class="hljs-number">0</span> &#123;<br>waitStartTime = runtime_nanotime()<br>&#125;<br>runtime_SemacquireMutex(&amp;m.sema, queueLifo, <span class="hljs-number">1</span>)<br>starving = starving || runtime_nanotime()-waitStartTime &gt; starvationThresholdNs<br>old = m.state<br><span class="hljs-keyword">if</span> old&amp;mutexStarving != <span class="hljs-number">0</span> &#123;<br><span class="hljs-comment">// If this goroutine was woken and mutex is in starvation mode,</span><br><span class="hljs-comment">// ownership was handed off to us but mutex is in somewhat</span><br><span class="hljs-comment">// inconsistent state: mutexLocked is not set and we are still</span><br><span class="hljs-comment">// accounted as waiter. Fix that.</span><br><span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexWoken) != <span class="hljs-number">0</span> || old&gt;&gt;mutexWaiterShift == <span class="hljs-number">0</span> &#123;<br>throw(<span class="hljs-string">&quot;sync: inconsistent mutex state&quot;</span>)<br>&#125;<br>delta := <span class="hljs-type">int32</span>(mutexLocked - <span class="hljs-number">1</span>&lt;&lt;mutexWaiterShift)<br><span class="hljs-keyword">if</span> !starving || old&gt;&gt;mutexWaiterShift == <span class="hljs-number">1</span> &#123;<br><span class="hljs-comment">// Exit starvation mode.</span><br><span class="hljs-comment">// Critical to do it here and consider wait time.</span><br><span class="hljs-comment">// Starvation mode is so inefficient, that two goroutines</span><br><span class="hljs-comment">// can go lock-step infinitely once they switch mutex</span><br><span class="hljs-comment">// to starvation mode.</span><br>delta -= mutexStarving<br>&#125;<br>atomic.AddInt32(&amp;m.state, delta)<br><span class="hljs-keyword">break</span><br>&#125;<br>awoke = <span class="hljs-literal">true</span><br>iter = <span class="hljs-number">0</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>old = m.state<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> race.Enabled &#123;<br>race.Acquire(unsafe.Pointer(m))<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// Unlock unlocks m.</span><br><span class="hljs-comment">// It is a run-time error if m is not locked on entry to Unlock.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// A locked Mutex is not associated with a particular goroutine.</span><br><span class="hljs-comment">// It is allowed for one goroutine to lock a Mutex and then</span><br><span class="hljs-comment">// arrange for another goroutine to unlock it.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span></span> Unlock() &#123;<br><span class="hljs-keyword">if</span> race.Enabled &#123;<br>_ = m.state<br>race.Release(unsafe.Pointer(m))<br>&#125;<br><br><span class="hljs-comment">// Fast path: drop lock bit.</span><br><span class="hljs-built_in">new</span> := atomic.AddInt32(&amp;m.state, -mutexLocked)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span> != <span class="hljs-number">0</span> &#123;<br><span class="hljs-comment">// Outlined slow path to allow inlining the fast path.</span><br><span class="hljs-comment">// To hide unlockSlow during tracing we skip one extra frame when tracing GoUnblock.</span><br>m.unlockSlow(<span class="hljs-built_in">new</span>)<br>&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h3 id="Unlock"><a href="#Unlock" class="headerlink" title="Unlock"></a>Unlock</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span></span> Unlock() &#123;<br><span class="hljs-keyword">if</span> race.Enabled &#123;<br>_ = m.state<br>race.Release(unsafe.Pointer(m))<br>&#125;<br><br><span class="hljs-comment">// Fast path: drop lock bit.</span><br><span class="hljs-built_in">new</span> := atomic.AddInt32(&amp;m.state, -mutexLocked)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span> != <span class="hljs-number">0</span> &#123;<br><span class="hljs-comment">// Outlined slow path to allow inlining the fast path.</span><br><span class="hljs-comment">// To hide unlockSlow during tracing we skip one extra frame when tracing GoUnblock.</span><br>m.unlockSlow(<span class="hljs-built_in">new</span>)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span></span> unlockSlow(<span class="hljs-built_in">new</span> <span class="hljs-type">int32</span>) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">new</span>+mutexLocked)&amp;mutexLocked == <span class="hljs-number">0</span> &#123;<br>throw(<span class="hljs-string">&quot;sync: unlock of unlocked mutex&quot;</span>)<br>&#125;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span>&amp;mutexStarving == <span class="hljs-number">0</span> &#123;<br>old := <span class="hljs-built_in">new</span><br><span class="hljs-keyword">for</span> &#123;<br><br><span class="hljs-keyword">if</span> old&gt;&gt;mutexWaiterShift == <span class="hljs-number">0</span> || old&amp;(mutexLocked|mutexWoken|mutexStarving) != <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">// Grab the right to wake someone.</span><br><span class="hljs-built_in">new</span> = (old - <span class="hljs-number">1</span>&lt;&lt;mutexWaiterShift) | mutexWoken<br><span class="hljs-keyword">if</span> atomic.CompareAndSwapInt32(&amp;m.state, old, <span class="hljs-built_in">new</span>) &#123;<br>runtime_Semrelease(&amp;m.sema, <span class="hljs-literal">false</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>old = m.state<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>runtime_Semrelease(&amp;m.sema, <span class="hljs-literal">true</span>, <span class="hljs-number">1</span>)<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="unlockSlow"><a href="#unlockSlow" class="headerlink" title="unlockSlow"></a>unlockSlow</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span></span> unlockSlow(<span class="hljs-built_in">new</span> <span class="hljs-type">int32</span>) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">new</span>+mutexLocked)&amp;mutexLocked == <span class="hljs-number">0</span> &#123;<br>throw(<span class="hljs-string">&quot;sync: unlock of unlocked mutex&quot;</span>)<br>&#125;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">new</span>&amp;mutexStarving == <span class="hljs-number">0</span> &#123;<br>old := <span class="hljs-built_in">new</span><br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-comment">// If there are no waiters or a goroutine has already</span><br><span class="hljs-comment">// been woken or grabbed the lock, no need to wake anyone.</span><br><span class="hljs-comment">// In starvation mode ownership is directly handed off from unlocking</span><br><span class="hljs-comment">// goroutine to the next waiter. We are not part of this chain,</span><br><span class="hljs-comment">// since we did not observe mutexStarving when we unlocked the mutex above.</span><br><span class="hljs-comment">// So get off the way.</span><br><span class="hljs-keyword">if</span> old&gt;&gt;mutexWaiterShift == <span class="hljs-number">0</span> || old&amp;(mutexLocked|mutexWoken|mutexStarving) != <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-comment">// Grab the right to wake someone.</span><br><span class="hljs-built_in">new</span> = (old - <span class="hljs-number">1</span>&lt;&lt;mutexWaiterShift) | mutexWoken<br><span class="hljs-keyword">if</span> atomic.CompareAndSwapInt32(&amp;m.state, old, <span class="hljs-built_in">new</span>) &#123;<br>runtime_Semrelease(&amp;m.sema, <span class="hljs-literal">false</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br>old = m.state<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// Starving mode: handoff mutex ownership to the next waiter, and yield</span><br><span class="hljs-comment">// our time slice so that the next waiter can start to run immediately.</span><br><span class="hljs-comment">// Note: mutexLocked is not set, the waiter will set it after wakeup.</span><br><span class="hljs-comment">// But mutex is still considered locked if mutexStarving is set,</span><br><span class="hljs-comment">// so new coming goroutines won&#x27;t acquire it.</span><br>runtime_Semrelease(&amp;m.sema, <span class="hljs-literal">true</span>, <span class="hljs-number">1</span>)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="TryLock"><a href="#TryLock" class="headerlink" title="TryLock"></a>TryLock</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Mutex)</span></span> TryLock() <span class="hljs-type">bool</span> &#123;<br>old := m.state<br><span class="hljs-keyword">if</span> old&amp;(mutexLocked|mutexStarving) != <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-comment">// There may be a goroutine waiting for the mutex, but we are</span><br><span class="hljs-comment">// running now and can try to grab the mutex before that</span><br><span class="hljs-comment">// goroutine wakes up.</span><br><span class="hljs-keyword">if</span> !atomic.CompareAndSwapInt32(&amp;m.state, old, old|mutexLocked) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-keyword">if</span> race.Enabled &#123;<br>race.Acquire(unsafe.Pointer(m))<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://juejin.cn/post/6958979192574705701">[Goå¹¶å‘] - Mutexæºç è§£æ  </a>          </p>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>GolangåŒ…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sync</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å•ä¾‹æ¨¡å¼</title>
    <link href="/2022/09/06/golang/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <url>/2022/09/06/golang/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>åªèƒ½å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿå®ç°è‡ªæˆ‘å®ä¾‹åŒ–;</p><p>ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå˜æˆå•ä¾‹ä¹‹åï¼Œç¡®ä¿ç¨‹åºè¿è¡Œä¹‹åæŸ¥æ‰¾çš„å¯¹è±¡å‡æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><h2 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h2><p>éçº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿå°±æ˜¯å¤šçº¿ç¨‹ä¸‹å¯èƒ½åˆ›å»ºå¤šæ¬¡å¯¹è±¡ã€‚</p><p>çº¿ç¨‹å®‰å…¨ï¼Œåˆ©ç”¨åŠ é”ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†ç”±äºæ¯æ¬¡è°ƒç”¨éƒ½æœ‰åŠ é”çš„æ“ä½œï¼Œæ€§èƒ½ç›¸è¾ƒäºä¸é«˜æ•ˆã€‚</p><h3 id="ä¸åŠ é”"><a href="#ä¸åŠ é”" class="headerlink" title="ä¸åŠ é”"></a>ä¸åŠ é”</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> singleton <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">var</span> instance *singleton<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span></span> *singleton &#123;<br><span class="hljs-keyword">if</span> instance == <span class="hljs-literal">nil</span> &#123;<br>instance = &amp;singleton&#123;&#125;<br>&#125;<br><span class="hljs-keyword">return</span> instance<br>&#125;<br></code></pre></td></tr></table></figure><p>çº¿ç¨‹ä¸å®‰å…¨ã€‚å¦‚æœæ‰§è¡Œå¤šä¸ªgoroutineï¼ˆé«˜å¹¶å‘ï¼‰ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡æ£€æŸ¥éƒ½ä¼šåˆ›å»ºsingletonç±»å‹çš„å®ä¾‹ï¼Œå¯¼è‡´åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”ä¼šç›¸äº’è¦†ç›–ï¼Œ</p><h3 id="æ•´ä½“åŠ é”"><a href="#æ•´ä½“åŠ é”" class="headerlink" title="æ•´ä½“åŠ é”"></a>æ•´ä½“åŠ é”</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mu sync.Mutex<br><br><span class="hljs-keyword">type</span> singleton <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">var</span> instance *singleton<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span></span> *singleton &#123;<br>mu.Lock()<br><span class="hljs-keyword">defer</span> mu.Unlock()<br><span class="hljs-keyword">if</span> instance == <span class="hljs-literal">nil</span> &#123;<br>instance = &amp;singleton&#123;&#125;<br>&#125;<br><span class="hljs-keyword">return</span> instance<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•´ä½“è¿›è¡ŒåŠ é”ä¹‹åï¼Œä¼šä½¿å¾—åœ¨æ‰§è¡Œå¤šä¸ªgoroutineçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„éƒ½éœ€è¦åŠ é”å’Œå¼€é”ï¼Œæ€§èƒ½é™ä½ã€‚</p><h3 id="åœ¨åˆ›å»ºæ–¹æ³•çš„æ—¶å€™åŠ é”"><a href="#åœ¨åˆ›å»ºæ–¹æ³•çš„æ—¶å€™åŠ é”" class="headerlink" title="åœ¨åˆ›å»ºæ–¹æ³•çš„æ—¶å€™åŠ é”"></a>åœ¨åˆ›å»ºæ–¹æ³•çš„æ—¶å€™åŠ é”</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mu sync.Mutex<br><br><span class="hljs-keyword">type</span> singleton <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">var</span> instance *singleton<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span></span> *singleton &#123;<br><br><span class="hljs-keyword">if</span> instance == <span class="hljs-literal">nil</span> &#123;<br>mu.Lock()<br>instance = &amp;singleton&#123;&#125;<br>mu.Unlock()<br>&#125;<br><span class="hljs-keyword">return</span> instance<br>&#125;<br></code></pre></td></tr></table></figure><p>çº¿ç¨‹ä¸å®‰å…¨ã€‚å¤šä¸ªçº¿ç¨‹ä¾æ—§ä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚</p><h3 id="åŒé‡æ£€é”"><a href="#åŒé‡æ£€é”" class="headerlink" title="åŒé‡æ£€é”"></a>åŒé‡æ£€é”</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mu sync.Mutex<br><br><span class="hljs-keyword">type</span> singleton <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">var</span> instance *singleton<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span></span> *singleton &#123;<br><br><span class="hljs-keyword">if</span> instance == <span class="hljs-literal">nil</span> &#123;<br>mu.Lock()<br><span class="hljs-keyword">if</span> instance == <span class="hljs-literal">nil</span> &#123;<br>instance = &amp;singleton&#123;&#125;<br>&#125;<br><br>mu.Unlock()<br>&#125;<br><span class="hljs-keyword">return</span> instance<br>&#125;<br></code></pre></td></tr></table></figure><p>åªæœ‰å½“å¯¹è±¡æœªåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šæœ‰åŠ å‡çš„æ“ä½œ</p><h3 id="sync-Onceå®ç°"><a href="#sync-Onceå®ç°" class="headerlink" title="sync.Onceå®ç°"></a>sync.Onceå®ç°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> once sync.Once<br><br><span class="hljs-keyword">type</span> singleton <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">var</span> instance *singleton<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetInstance</span><span class="hljs-params">()</span></span> *singleton &#123;<br><br>once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>instance = &amp;singleton&#123;&#125;<br>&#125;)<br><span class="hljs-keyword">return</span> instance<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://jane-lucky.github.io/2022/09/09/golang/Golang%E5%8C%85/sync.Once/"><code>Do</code>æ–¹æ³•æºç </a></p><h2 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h2><p>å•ä¾‹ä½¿ç”¨è¾ƒå°‘ï¼Œå¹¶ä¸”åˆ›å»ºçš„èµ„æºæ¯”è¾ƒå¤šã€‚</p><p>ç›´æ¥åˆ›å»ºå¥½å¯¹è±¡ï¼Œä¸éœ€è¦åˆ¤æ–­ä¸ºç©ºï¼Œçº¿ç¨‹å®‰å…¨ã€‚</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs smali">type singleton struct &#123;<br>&#125;<br><br>var<span class="hljs-built_in"> instance </span>*singleton<br><br>func init() &#123;<br><span class="hljs-built_in">instance </span>= &amp;singleton&#123;&#125;<br>&#125;<br>func GetInstance() *singleton &#123;<br><span class="hljs-built_in">return </span>instance<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>goè®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>contextæºç å­¦ä¹ </title>
    <link href="/2022/09/05/golang/Golang%E5%8C%85/context/"/>
    <url>/2022/09/05/golang/Golang%E5%8C%85/context/</url>
    
    <content type="html"><![CDATA[<p>go:1.18.5</p><h1 id="contextåŒ…æ¶æ„å¸ƒå±€"><a href="#contextåŒ…æ¶æ„å¸ƒå±€" class="headerlink" title="contextåŒ…æ¶æ„å¸ƒå±€"></a>contextåŒ…æ¶æ„å¸ƒå±€</h1><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>Context</td><td>æ¥å£</td><td>å®šä¹‰äº† Context æ¥å£çš„å››ä¸ªæ–¹æ³•</td></tr><tr><td>emptyCtx</td><td>ç»“æ„ä½“</td><td>å®ç°äº† Context æ¥å£ï¼Œå®ƒå…¶å®æ˜¯ä¸ªç©ºçš„ context</td></tr><tr><td>CancelFunc</td><td>å‡½æ•°</td><td>å–æ¶ˆå‡½æ•°</td></tr><tr><td>canceler</td><td>æ¥å£</td><td>context å–æ¶ˆæ¥å£ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•</td></tr><tr><td>cancelCtx</td><td>ç»“æ„ä½“</td><td>å¯ä»¥è¢«å–æ¶ˆ</td></tr><tr><td>timerCtx</td><td>ç»“æ„ä½“</td><td>è¶…æ—¶ä¼šè¢«å–æ¶ˆ</td></tr><tr><td>valueCtx</td><td>ç»“æ„ä½“</td><td>å¯ä»¥å­˜å‚¨ k-v å¯¹</td></tr><tr><td>Background</td><td>å‡½æ•°</td><td>è¿”å›ä¸€ä¸ªç©ºçš„ contextï¼Œå¸¸ä½œä¸ºæ ¹ context</td></tr><tr><td>TODO</td><td>å‡½æ•°</td><td>è¿”å›ä¸€ä¸ªç©ºçš„ contextï¼Œå¸¸ç”¨äºé‡æ„æ—¶æœŸï¼Œæ²¡æœ‰åˆé€‚çš„ context å¯ç”¨</td></tr><tr><td>WithCancel</td><td>å‡½æ•°</td><td>åŸºäºçˆ¶ contextï¼Œç”Ÿæˆä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„ context</td></tr><tr><td>newCancelCtx</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„ context</td></tr><tr><td>propagateCancel</td><td>å‡½æ•°</td><td>å‘ä¸‹ä¼ é€’ context èŠ‚ç‚¹é—´çš„å–æ¶ˆå…³ç³»</td></tr><tr><td>parentCancelCtx</td><td>å‡½æ•°</td><td>æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯å–æ¶ˆçš„çˆ¶èŠ‚ç‚¹</td></tr><tr><td>removeChild</td><td>å‡½æ•°</td><td>å»æ‰çˆ¶èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹</td></tr><tr><td>init</td><td>å‡½æ•°</td><td>åŒ…åˆå§‹åŒ–</td></tr><tr><td>WithDeadline</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªæœ‰ deadline çš„ context</td></tr><tr><td>WithTimeout</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªæœ‰ timeout çš„ context</td></tr><tr><td>WithValue</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªå­˜å‚¨ k-v å¯¹çš„ context</td></tr></tbody></table><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><h3 id="context"><a href="#context" class="headerlink" title="context"></a><strong>context</strong></h3><p>å®šä¹‰4ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯å¹‚ç­‰ï¼Œä¹Ÿå°±æ˜¯å¤šæ¬¡æ‰§è¡Œè¿”å›çš„ç»“æœä¸€è‡´ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">interface</span> &#123;<br><span class="hljs-comment">// è¿”å›contextæ˜¯å¦ä¼šè¢«å–æ¶ˆä»¥åŠè‡ªåŠ¨å–æ¶ˆçš„æ—¶é—´</span><br>Deadline() (deadline time.Time, ok <span class="hljs-type">bool</span>)<br><br><span class="hljs-comment">//contextè¢«å–æ¶ˆæˆ–deadlineçš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªå…³é—­çš„chan</span><br>Done() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-comment">//Doneä¹‹åï¼Œè¿”å›contextçš„åŸå› </span><br>Err() <span class="hljs-type">error</span><br><br><span class="hljs-comment">//è·å–keyå¯¹åº”çš„alue</span><br>Value(key any) any<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="canceler"><a href="#canceler" class="headerlink" title="canceler"></a><strong>canceler</strong></h3><p>è¯´æ˜contextæ˜¯å¯ä»¥å–æ¶ˆçš„ã€‚</p><ul><li>â€œå–æ¶ˆâ€æ“ä½œåº”è¯¥æ˜¯å»ºè®®æ€§ï¼Œè€Œéå¼ºåˆ¶æ€§</li></ul><p>caller ä¸åº”è¯¥å»å…³å¿ƒã€å¹²æ¶‰ callee çš„æƒ…å†µï¼Œå†³å®šå¦‚ä½•ä»¥åŠä½•æ—¶ return æ˜¯ callee çš„è´£ä»»ã€‚caller åªéœ€å‘é€â€œå–æ¶ˆâ€ä¿¡æ¯ï¼Œcallee æ ¹æ®æ”¶åˆ°çš„ä¿¡æ¯æ¥åšè¿›ä¸€æ­¥çš„å†³ç­–ï¼Œå› æ­¤æ¥å£å¹¶æ²¡æœ‰å®šä¹‰ cancel æ–¹æ³•ã€‚</p><ul><li>â€œå–æ¶ˆâ€æ“ä½œåº”è¯¥å¯ä¼ é€’</li></ul><p>â€œå–æ¶ˆâ€æŸä¸ªå‡½æ•°æ—¶ï¼Œå’Œå®ƒç›¸å…³è”çš„å…¶ä»–å‡½æ•°ä¹Ÿåº”è¯¥â€œå–æ¶ˆâ€ã€‚å› æ­¤ï¼Œ<code>Done()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªåªè¯»çš„ channelï¼Œæ‰€æœ‰ç›¸å…³å‡½æ•°ç›‘å¬æ­¤ channelã€‚ä¸€æ—¦ channel å…³é—­ï¼Œé€šè¿‡ channel çš„â€œå¹¿æ’­æœºåˆ¶â€ï¼Œæ‰€æœ‰ç›‘å¬è€…éƒ½èƒ½æ”¶åˆ°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> canceler <span class="hljs-keyword">interface</span> &#123;<br>cancel(removeFromParent <span class="hljs-type">bool</span>, err <span class="hljs-type">error</span>)<br>Done() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h2><h3 id="emptyCtx"><a href="#emptyCtx" class="headerlink" title="emptyCtx"></a>emptyCtx</h3><p>å®ƒè¢«åŒ…è£…æˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> (<br>    <span class="hljs-comment">//BackGroundè¿”å›ä¸€ä¸ªéç©ºçš„contextï¼Œä¸”ç»ä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼å’Œå–æ¶ˆæ—¶é—´ã€‚é€šå¸¸ç”¨åœ¨mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä¸­æˆ–è€…ä½œä¸ºè¾“å…¥è¯·æ±‚çš„é«˜context</span><br><span class="hljs-comment">// Background returns a non-nil, empty Context. It is never canceled, has no</span><br><span class="hljs-comment">// values, and has no deadline. It is typically used by the main function,</span><br><span class="hljs-comment">// initialization, and tests, and as the top-level Context for incoming</span><br><span class="hljs-comment">// requests.</span><br>background = <span class="hljs-built_in">new</span>(emptyCtx)<br>    <span class="hljs-comment">//TODOè¿”å›ä¸€ä¸ªéç©ºçš„contextï¼Œä»£ç å¯ä»¥ä½¿ç”¨contextã€‚å½“ä¸æ¸…æ¥šé‡‡ç”¨é‚£ç§contextæˆ–è€…ä¸ç¡®å®šæ˜¯éƒ½æœ‰ç”¨å¯ä»¥é‡‡ç”¨TODOï¼Œ</span><br><span class="hljs-comment">// TODO returns a non-nil, empty Context. Code should use context.TODO when</span><br><span class="hljs-comment">// it&#x27;s unclear which Context to use or it is not yet available (because the</span><br><span class="hljs-comment">// surrounding function has not yet been extended to accept a Context</span><br><span class="hljs-comment">// parameter).</span><br>todo       = <span class="hljs-built_in">new</span>(emptyCtx)<br>)<br></code></pre></td></tr></table></figure><p>backgroundé€šå¸¸ç”¨åœ¨mainå‡½æ•°ä¸­ï¼Œä½œä¸ºcontextçš„æ ¹èŠ‚ç‚¹ã€‚</p><h3 id="cancelCtx"><a href="#cancelCtx" class="headerlink" title="cancelCtx"></a>cancelCtx</h3><p>å¯å–æ¶ˆçš„contextï¼Œä»–å¯ä»¥ç¡®ä¿çˆ¶è¢«å–æ¶ˆçš„æ—¶å€™ï¼Œå…¶ä½™çš„å­contextä¹Ÿä¼šè¢«å–æ¶ˆã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//</span><br><span class="hljs-keyword">type</span> cancelCtx <span class="hljs-keyword">struct</span> &#123;<br>Context<br><br>mu       sync.Mutex            <span class="hljs-comment">// protects following fields</span><br>done     atomic.Value          <span class="hljs-comment">// of chan struct&#123;&#125;, created lazily, closed by first cancel call</span><br>children <span class="hljs-keyword">map</span>[canceler]<span class="hljs-keyword">struct</span>&#123;&#125; <span class="hljs-comment">// set to nil by the first cancel call</span><br>err      <span class="hljs-type">error</span>                 <span class="hljs-comment">// set to non-nil by the first cancel call</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œvalueã€Doneã€Stringã€Errç­‰å‡å®ç°äº†canceleræ–¹æ³•ã€‚</p><p><code>Done</code>æ–¹æ³•çš„å®ç°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *cancelCtx)</span></span> Done() &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125; &#123;<br>d := c.done.Load()<br><span class="hljs-keyword">if</span> d != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> d.(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<br>&#125;<br>c.mu.Lock()<br><span class="hljs-keyword">defer</span> c.mu.Unlock()<br>d = c.done.Load()<br><span class="hljs-keyword">if</span> d == <span class="hljs-literal">nil</span> &#123;<br>d = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<br>c.done.Store(d)<br>&#125;<br><span class="hljs-keyword">return</span> d.(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªåªè¯»çš„ channelï¼Œè€Œä¸”æ²¡æœ‰åœ°æ–¹å‘è¿™ä¸ª channel é‡Œé¢å†™æ•°æ®ã€‚æ‰€ä»¥ï¼Œç›´æ¥è°ƒç”¨è¯»è¿™ä¸ª channelï¼Œåç¨‹ä¼šè¢« block ä½ã€‚ä¸€èˆ¬é€šè¿‡æ­é… select æ¥ä½¿ç”¨ã€‚ä¸€æ—¦å…³é—­ï¼Œå°±ä¼šç«‹å³è¯»å‡ºé›¶å€¼ã€‚</p><p><code>value</code>æ–¹æ³•å®ç°:è¿”å›å–æ¶ˆçš„keyå€¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *cancelCtx)</span></span> Value(key any) any &#123;<br><span class="hljs-keyword">if</span> key == &amp;cancelCtxKey &#123;<br><span class="hljs-keyword">return</span> c<br>&#125;<br><span class="hljs-keyword">return</span> value(c.Context, key)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>cancel</code>æ–¹æ³•å®ç°</p><p>å…³é—­æ‰€æœ‰çš„channelã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *cancelCtx)</span></span> cancel(removeFromParent <span class="hljs-type">bool</span>, err <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-comment">//ä¼ å…¥err</span><br><span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;context: internal error: missing cancel error&quot;</span>)<br>&#125;<br>c.mu.Lock()<br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å·²ç»å–æ¶ˆï¼Œå› ä¸ºDoneä¹‹åä¼šè¿”å›å–æ¶ˆåŸå› ï¼Œå› æ­¤é‡‡ç”¨errçš„çš„æ–¹æ³•åˆ¤æ–­æ˜¯å¦å–æ¶ˆ</span><br><span class="hljs-keyword">if</span> c.err != <span class="hljs-literal">nil</span> &#123;<br>c.mu.Unlock()<br><span class="hljs-keyword">return</span> <span class="hljs-comment">// already canceled</span><br>&#125;<br>c.err = err<br>d, _ := c.done.Load().(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<br>    <span class="hljs-comment">//å…³é—­channelï¼Œé€šçŸ¥å…¶ä»–åç¨‹</span><br><span class="hljs-keyword">if</span> d == <span class="hljs-literal">nil</span> &#123;<br>c.done.Store(closedchan)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">close</span>(d)<br>&#125;<br>    <span class="hljs-comment">//éå†å¾ªç¯å­contextå…³é—­</span><br><span class="hljs-keyword">for</span> child := <span class="hljs-keyword">range</span> c.children &#123;<br><span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> acquiring the child&#x27;s lock while holding parent&#x27;s lock.</span><br>child.cancel(<span class="hljs-literal">false</span>, err)<br>&#125;<br>    <span class="hljs-comment">//å­ç»“ç‚¹ç½®ç©º</span><br>c.children = <span class="hljs-literal">nil</span><br>c.mu.Unlock()<br><br>    <span class="hljs-comment">//å¦‚æœä¸ºTrueï¼Œå°†è‡ªå·±ä»çˆ¶èŠ‚ç‚¹åˆ é™¤</span><br><span class="hljs-keyword">if</span> removeFromParent &#123;<br>removeChild(c.Context, c)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åˆ›å»ºå¯å–æ¶ˆçš„cancelæ–¹æ³•</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithCancel</span><span class="hljs-params">(parent Context)</span></span> (ctx Context, cancel CancelFunc) &#123;<br><span class="hljs-keyword">if</span> parent == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;cannot create context from nil parent&quot;</span>)<br>&#125;<br>c := newCancelCtx(parent)<br>    <span class="hljs-comment">//å‘ä¸Šéå†å¯åˆ é™¤çš„çˆ¶èŠ‚ç‚¹ä»¥åŠä»–çš„å­ç»“ç‚¹è¿›è¡Œåˆ é™¤</span><br>    <span class="hljs-comment">//</span><br>propagateCancel(parent, &amp;c)<br>    <span class="hljs-comment">//è¿”å›contextå’Œfuncï¼Œå…¶ä¸­c.cancel(true, Canceled)å·²ç»é»˜è®¤éœ€è¦å°†è‡ªå·±ä»çˆ¶èŠ‚ç‚¹ä¸­åˆ é™¤ã€‚</span><br><span class="hljs-keyword">return</span> &amp;c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c.cancel(<span class="hljs-literal">true</span>, Canceled) &#125;<br>&#125;<br><br><span class="hljs-comment">// newCancelCtx returns an initialized cancelCtx.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newCancelCtx</span><span class="hljs-params">(parent Context)</span></span> cancelCtx &#123;<br><span class="hljs-keyword">return</span> cancelCtx&#123;Context: parent&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œé»˜è®¤è°ƒç”¨çš„cancelæ–¹æ³•ä¸­ä¼ å…¥çš„trueï¼Œè€Œåœ¨åœ¨æ‰§è¡Œè¯¥æ–¹æ³•çš„å†…éƒ¨å¾ªç¯å–æ¶ˆå­ç»“ç‚¹çš„æ—¶å€™childè°ƒç”¨çš„cancelä¼ å…¥çš„æ˜¯false</strong></p><ol><li><p>å¯å–æ¶ˆçš„cancelçš„æ–¹æ³•ä¸­ä¼ å…¥çš„ä¸ºtrue,å°†childè¿›è¡Œåˆ é™¤</p><p><code>removeChild</code>æ–¹æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">removeChild</span><span class="hljs-params">(parent Context, child canceler)</span></span> &#123;<br><span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æœ‰å¯å–æ¶ˆçš„çˆ¶èŠ‚ç‚¹</span><br>p, ok := parentCancelCtx(parent)<br><span class="hljs-comment">//ä¸å­˜åœ¨ï¼Œè¯´æ˜çˆ¶èŠ‚ç‚¹å·²ç»å–æ¶ˆ</span><br><span class="hljs-keyword">if</span> !ok &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br>p.mu.Lock()<br><span class="hljs-comment">//åˆ¤æ–­childèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨delete</span><br><span class="hljs-keyword">if</span> p.children != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">delete</span>(p.children, child)<br>&#125;<br>p.mu.Unlock()<br>&#125;<br></code></pre></td></tr></table></figure><p><code>parentCancelCtx</code>æ–¹æ³•ï¼ŒæŸ¥çœ‹çˆ¶èŠ‚ç‚¹å¦‚ä½•é€’å½’éå†åˆ é™¤</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">parentCancelCtx</span><span class="hljs-params">(parent Context)</span></span> (*cancelCtx, <span class="hljs-type">bool</span>) &#123;<br>    <span class="hljs-comment">//doneä¸ºä¸€ä¸ªç»“æ„ä½“ç®¡é“</span><br>done := parent.Done()<br><span class="hljs-keyword">if</span> done == closedchan || done == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span><br>&#125;<br>    <span class="hljs-comment">//é€šè¿‡valueå€¼æŸ¥æ‰¾åˆ°åŒ¹é…çš„parent.Done()</span><br>p, ok := parent.Value(&amp;cancelCtxKey).(*cancelCtx)<br><span class="hljs-keyword">if</span> !ok &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span><br>&#125;<br>    <span class="hljs-comment">//å¦‚æœæ²¡æœ‰ï¼Œ*cancelCtxå·²è¢«åŒ…è£…åœ¨ä¸€ä¸ªè‡ªå®šä¹‰å®ç°ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªä¸åŒçš„å®Œæˆé€šé“ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ç»•è¿‡å®ƒ</span><br>pdone, _ := p.done.Load().(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;)<br><span class="hljs-keyword">if</span> pdone != done &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-keyword">return</span> p, <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>ä¾‹å­ï¼š</p><p>mcCtxï¼ŒchildCtx å’Œæ­£å¸¸çš„ parentContextä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»“æ„ä½“ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Mycontext <span class="hljs-keyword">struct</span> &#123;<br>context.Context<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>childCancel := <span class="hljs-literal">true</span><br>parentContext, parentFunc := context.WithCancel(context.Background())<br>mcCtx := Mycontext&#123;parentContext&#125;<br><br>childCtx, childFunc := context.WithCancel(mcCtx)<br><br><span class="hljs-keyword">if</span> childCancel &#123;<br>childFunc()<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>parentFunc()<br>&#125;<br><br>fmt.Println(parentContext) <span class="hljs-comment">//context.Background.WithCancel</span><br>fmt.Println(mcCtx) <span class="hljs-comment">//&#123;context.Background.WithCancel&#125;</span><br>fmt.Println(childCtx) <span class="hljs-comment">//main.Mycontext.WithCancel</span><br><br>time.Sleep(<span class="hljs-number">10</span> * time.Second)<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="timerCtx"><a href="#timerCtx" class="headerlink" title="timerCtx"></a>timerCtx</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> timerCtx <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">//åŸºäºcancelCtx</span><br>cancelCtx<br>timer *time.Timer <span class="hljs-comment">// Under cancelCtx.mu.</span><br>    <span class="hljs-comment">//è®¾ç½®Deadlineçš„æ—¶é—´</span><br>deadline time.Time<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *timerCtx)</span></span> Deadline() (deadline time.Time, ok <span class="hljs-type">bool</span>) &#123;<br><span class="hljs-keyword">return</span> c.deadline, <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *timerCtx)</span></span> String() <span class="hljs-type">string</span> &#123;<br><span class="hljs-keyword">return</span> contextName(c.cancelCtx.Context) + <span class="hljs-string">&quot;.WithDeadline(&quot;</span> +<br>c.deadline.String() + <span class="hljs-string">&quot; [&quot;</span> +<br>time.Until(c.deadline).String() + <span class="hljs-string">&quot;])&quot;</span><br>&#125;<br><span class="hljs-comment">//å¯å–æ¶ˆçš„timeOut</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *timerCtx)</span></span> cancel(removeFromParent <span class="hljs-type">bool</span>, err <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-comment">//è°ƒç”¨cancelCtxçš„cancelæ–¹æ³•</span><br>c.cancelCtx.cancel(<span class="hljs-literal">false</span>, err)<br><span class="hljs-keyword">if</span> removeFromParent &#123;<br><span class="hljs-comment">// Remove this timerCtx from its parent cancelCtx&#x27;s children.</span><br>        <span class="hljs-comment">//ç§»é™¤å­èŠ‚ç‚¹</span><br>removeChild(c.cancelCtx.Context, c)<br>&#125;<br>c.mu.Lock()<br>    <span class="hljs-comment">//åˆ¤æ–­cçš„æ—¶é—´ï¼Œå…³æ‰å®šæ—¶å™¨ï¼Œä¸ä¼šå†æ¬¡å–æ¶ˆ</span><br><span class="hljs-keyword">if</span> c.timer != <span class="hljs-literal">nil</span> &#123;<br>c.timer.Stop()<br>c.timer = <span class="hljs-literal">nil</span><br>&#125;<br>c.mu.Unlock()<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå¯å–æ¶ˆçš„time context</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">func <span class="hljs-constructor">WithTimeout(<span class="hljs-params">parent</span> Context, <span class="hljs-params">timeout</span> <span class="hljs-params">time</span>.Duration)</span> (Context, CancelFunc) &#123;<br>return <span class="hljs-constructor">WithDeadline(<span class="hljs-params">parent</span>, <span class="hljs-params">time</span>.Now()</span>.<span class="hljs-constructor">Add(<span class="hljs-params">timeout</span>)</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´æ¥è°ƒç”¨<code>WithDeadline</code>,æ·»åŠ è¶…æ—¶æ—¶é—´ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithDeadline</span><span class="hljs-params">(parent Context, d time.Time)</span></span> (Context, CancelFunc) &#123;<br>    <span class="hljs-comment">//åˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º</span><br><span class="hljs-keyword">if</span> parent == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;cannot create context from nil parent&quot;</span>)<br>&#125;<br>    <span class="hljs-comment">//è·å–å½“å‰parentçš„æ—¶é—´å’Œç»“æœã€‚å¦‚æœçˆ¶èŠ‚ç‚¹è¶…æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨cancelå‡½æ•°ã€‚</span><br><span class="hljs-keyword">if</span> cur, ok := parent.Deadline(); ok &amp;&amp; cur.Before(d) &#123;<br><span class="hljs-comment">// The current deadline is already sooner than the new one.</span><br><span class="hljs-keyword">return</span> WithCancel(parent)<br>&#125;<br>c := &amp;timerCtx&#123;<br>cancelCtx: newCancelCtx(parent),<br>deadline:  d,<br>&#125;<br>    <span class="hljs-comment">//æŒ‚é çˆ¶èŠ‚ç‚¹</span><br>propagateCancel(parent, c)<br>    <span class="hljs-comment">//è·å–è·ç¦»åˆ°è¾¾dealineçš„æ—¶é—´</span><br>dur := time.Until(d)<br>    <span class="hljs-comment">//è¶…æ—¶</span><br><span class="hljs-keyword">if</span> dur &lt;= <span class="hljs-number">0</span> &#123;<br>        <span class="hljs-comment">//å–æ¶ˆå¹¶è¿”å›</span><br>c.cancel(<span class="hljs-literal">true</span>, DeadlineExceeded) <span class="hljs-comment">// deadline has already passed</span><br>        <br><span class="hljs-keyword">return</span> c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c.cancel(<span class="hljs-literal">false</span>, Canceled) &#125;<br>&#125;<br>c.mu.Lock()<br><span class="hljs-keyword">defer</span> c.mu.Unlock()<br><span class="hljs-keyword">if</span> c.err == <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-comment">//åœ¨åˆ°è¾¾è¶…æ—¶çš„æ—¶é—´çš„æ—¶å€™ï¼Œæ‰§è¡Œå–æ¶ˆå‘½ä»¤</span><br>c.timer = time.AfterFunc(dur, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>c.cancel(<span class="hljs-literal">true</span>, DeadlineExceeded)<br>&#125;)<br>&#125;<br>    <span class="hljs-comment">//æ˜¯ trueï¼Œä¹Ÿå°±æ˜¯è¯´å–æ¶ˆçš„æ—¶å€™ï¼Œéœ€è¦å°†è‡ªå·±ä»çˆ¶èŠ‚ç‚¹é‡Œåˆ é™¤ã€‚ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ä¸€ä¸ªå›ºå®šçš„å–æ¶ˆé”™è¯¯ç±»å‹</span><br>    <span class="hljs-comment">//è¿”å›çš„ cancelFunc å‡½æ•°ä¼šä¼ å…¥ trueã€‚è¿™æ ·åšçš„ç»“æœæ˜¯ï¼šå½“è°ƒç”¨è¿”å›çš„ cancelFunc æ—¶ï¼Œä¼šå°†è¿™ä¸ª context ä»å®ƒçš„çˆ¶èŠ‚ç‚¹é‡Œâ€œé™¤åâ€ï¼Œå› ä¸ºçˆ¶èŠ‚ç‚¹å¯èƒ½æœ‰å¾ˆå¤šå­èŠ‚ç‚¹ï¼Œä½ è‡ªå·±å–æ¶ˆäº†ï¼Œæ‰€ä»¥æˆ‘è¦å’Œä½ æ–­ç»å…³ç³»ï¼Œå¯¹å…¶ä»–äººæ²¡å½±å“ã€‚</span><br><span class="hljs-keyword">return</span> c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; c.cancel(<span class="hljs-literal">true</span>, Canceled) &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="valueCtx"><a href="#valueCtx" class="headerlink" title="valueCtx"></a>valueCtx</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> valueCtx <span class="hljs-keyword">struct</span> &#123;<br>Context<br>key, val any<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="propagateCancel"><a href="#propagateCancel" class="headerlink" title="propagateCancel"></a>propagateCancel</h2><p>çˆ¶èŠ‚ç‚¹æ—¶å–æ¶ˆå­èŠ‚ç‚¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// propagateCancel arranges for child to be canceled when parent is.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">propagateCancel</span><span class="hljs-params">(parent Context, child canceler)</span></span> &#123;<br>    <span class="hljs-comment">//çˆ¶èŠ‚ç‚¹æ˜¯ç©ºèŠ‚ç‚¹</span><br>done := parent.Done()<br><span class="hljs-keyword">if</span> done == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-comment">// parent is never canceled</span><br>&#125;<br><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-done:<br><span class="hljs-comment">// parent is already canceled</span><br>child.cancel(<span class="hljs-literal">false</span>, parent.Err())<br><span class="hljs-keyword">return</span><br><span class="hljs-keyword">default</span>:<br>&#125;<br><br>    <span class="hljs-comment">//åˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦å¯å–æ¶ˆ</span><br><span class="hljs-keyword">if</span> p, ok := parentCancelCtx(parent); ok &#123;<br>p.mu.Lock()<br>        <span class="hljs-comment">// çˆ¶èŠ‚ç‚¹å·²ç»è¢«å–æ¶ˆäº†ï¼Œæœ¬èŠ‚ç‚¹ï¼ˆå­èŠ‚ç‚¹ï¼‰ä¹Ÿè¦å–æ¶ˆ</span><br><span class="hljs-keyword">if</span> p.err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// parent has already been canceled</span><br>child.cancel(<span class="hljs-literal">false</span>, p.err)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> p.children == <span class="hljs-literal">nil</span> &#123;<br>p.children = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[canceler]<span class="hljs-keyword">struct</span>&#123;&#125;)<br>&#125;<br>            <span class="hljs-comment">//æŒ‚åˆ°çˆ¶èŠ‚ç‚¹</span><br>p.children[child] = <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;<br>&#125;<br>p.mu.Unlock()<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//æ²¡æœ‰æ‰¾åˆ°å¯å–æ¶ˆçš„çˆ¶èŠ‚ç‚¹</span><br>atomic.AddInt32(&amp;goroutines, +<span class="hljs-number">1</span>)<br>        <span class="hljs-comment">//é‡æ–°å¯åŠ¨ä¸€ä¸ªæ–°åç¨‹ï¼Œç›‘æ§çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-parent.Done():<br>child.cancel(<span class="hljs-literal">false</span>, parent.Err())<br><span class="hljs-keyword">case</span> &lt;-child.Done():<br>&#125;<br>&#125;()<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><h2 id="ä¼ é€’å…±äº«æ•°æ®"><a href="#ä¼ é€’å…±äº«æ•°æ®" class="headerlink" title="ä¼ é€’å…±äº«æ•°æ®"></a>ä¼ é€’å…±äº«æ•°æ®</h2><p>é€šå¸¸ä½¿ç”¨WithValue()çš„æ–¹æ³•å…±äº«æ•°æ®</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ctx := context.Background()<br>process(ctx) <span class="hljs-comment">//process over. no trace_id</span><br><br>ctx = context.WithValue(ctx, <span class="hljs-string">&quot;traceId&quot;</span>, <span class="hljs-string">&quot;qwe-2011&quot;</span>)<br>process(ctx)<span class="hljs-comment">//process over,trace_id=qwe-2011</span><br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">process</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br>traceID, ok := ctx.Value(<span class="hljs-string">&quot;traceId&quot;</span>).(<span class="hljs-type">string</span>)<br><span class="hljs-keyword">if</span> ok &#123;<br>fmt.Printf(<span class="hljs-string">&quot;process over,trace_id=%s\n&quot;</span>, traceID)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;process over. no trace_id\n&quot;</span>)<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="å–æ¶ˆgoroutine-amp-é˜²æ­¢goroutineæ³„éœ²"><a href="#å–æ¶ˆgoroutine-amp-é˜²æ­¢goroutineæ³„éœ²" class="headerlink" title="å–æ¶ˆgoroutine&amp;é˜²æ­¢goroutineæ³„éœ²"></a>å–æ¶ˆgoroutine&amp;é˜²æ­¢goroutineæ³„éœ²</h2><ol><li><p>å–æ¶ˆgoroutine</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">work1</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br>LABEL:<br><span class="hljs-keyword">for</span> &#123;<br><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-keyword">break</span> LABEL<br><span class="hljs-keyword">default</span>:<br>fmt.Println(<span class="hljs-string">&quot;...work1...&quot;</span>)<br>time.Sleep(time.Second)<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">work2</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br>LABEL:<br><span class="hljs-keyword">for</span> &#123;<br><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-keyword">break</span> LABEL<br><span class="hljs-keyword">default</span>:<br>fmt.Println(<span class="hljs-string">&quot;...work2...&quot;</span>)<br>time.Sleep(time.Second)<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ctx, cancel := context.WithCancel(context.Background())<br><span class="hljs-keyword">go</span> work1(ctx)<br><span class="hljs-keyword">go</span> work2(ctx)<br><br>time.Sleep(time.Second * <span class="hljs-number">5</span>)<br>cancel()<br>fmt.Println(<span class="hljs-string">&quot;...cancel...&quot;</span>)<br><span class="hljs-keyword">go</span> work2(ctx)<br>fmt.Println(<span class="hljs-string">&quot;...over...&quot;</span>)<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/go/src/gotest$ go run main.go <br>...work2...<br>...work1...<br>...work1...<br>...work2...<br>...work2...<br>...work1...<br>...work1...<br>...work2...<br>...work2...<br>...work1...<br>...cancel...<br>...over...<br></code></pre></td></tr></table></figure></li><li><p>é˜²æ­¢goroutineæ³„éœ²</p></li></ol><h1 id="å‚è€ƒè¿æ¥"><a href="#å‚è€ƒè¿æ¥" class="headerlink" title="å‚è€ƒè¿æ¥"></a>å‚è€ƒè¿æ¥</h1><p><a href="https://www.cnblogs.com/qcrao-2018/p/11007503.html">æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹context</a></p>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>GolangåŒ…</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ—¥å¿—æ”¶é›†å®æˆ˜</title>
    <link href="/2022/09/03/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%AE%9E%E6%88%98/"/>
    <url>/2022/09/03/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚ä½•ç»“æŸå­goroutine"><a href="#å¦‚ä½•ç»“æŸå­goroutine" class="headerlink" title="å¦‚ä½•ç»“æŸå­goroutine"></a>å¦‚ä½•ç»“æŸå­goroutine</h2><ol><li>å…¨å±€å˜é‡</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br>_ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><br><span class="hljs-comment">//è®¾ç½®å…¨å±€å˜é‡</span><br><span class="hljs-keyword">var</span> exit <span class="hljs-type">bool</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br><span class="hljs-keyword">for</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;...worker...&quot;</span>)<br>time.Sleep(time.Second)<br><span class="hljs-keyword">if</span> exit &#123;<br><span class="hljs-keyword">break</span><br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> worker()<br><br>time.Sleep(time.Second * <span class="hljs-number">5</span>)<br>exit = <span class="hljs-literal">true</span><br>wg.Wait()<br>fmt.Println(<span class="hljs-string">&quot;...over...&quot;</span>)<br><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>channelçš„æ–¹å¼å®ç°</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br>_ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><br><span class="hljs-comment">//channel</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(ch &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>)</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>LABEL:<br><span class="hljs-keyword">for</span> &#123;<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ch:<br><span class="hljs-keyword">break</span> LABEL<br><span class="hljs-keyword">default</span>:<br>fmt.Println(<span class="hljs-string">&quot;...worker...&quot;</span>)<br>time.Sleep(time.Second)<br>&#125;<br><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> exitChan = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>, <span class="hljs-number">1</span>)<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> worker(exitChan)<br><br>time.Sleep(time.Second * <span class="hljs-number">5</span>)<br>exitChan &lt;- <span class="hljs-literal">true</span><br>wg.Wait()<br>fmt.Println(<span class="hljs-string">&quot;...over...&quot;</span>)<br><br>&#125;<br><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>context</strong><ul><li>æ§åˆ¶å¤šä¸ªgoroutineé€€å‡º</li></ul></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br>)<br><br><span class="hljs-keyword">var</span> wg sync.WaitGroup<br><br><span class="hljs-comment">//channel</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br>LABEL:<br><span class="hljs-keyword">for</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;...worker...&quot;</span>)<br>time.Sleep(time.Second)<br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-keyword">break</span> LABEL<br><span class="hljs-keyword">default</span>:<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ctx, cancel := context.WithCancel(context.Background())<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> worker(ctx)<br><br>time.Sleep(time.Second * <span class="hljs-number">5</span>)<br>cancel()<br>wg.Wait()<br>fmt.Println(<span class="hljs-string">&quot;...over...&quot;</span>)<br><br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br>LABEL:<br><span class="hljs-keyword">for</span> &#123;<br><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-keyword">break</span> LABEL<br><span class="hljs-keyword">default</span>:<br>fmt.Println(<span class="hljs-string">&quot;...worker1...&quot;</span>)<br>time.Sleep(time.Second)<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker2</span><span class="hljs-params">(ctx context.Context)</span></span> &#123;<br>LABEL:<br><span class="hljs-keyword">for</span> &#123;<br><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ctx.Done():<br><span class="hljs-keyword">break</span> LABEL<br><span class="hljs-keyword">default</span>:<br>fmt.Println(<span class="hljs-string">&quot;...worker2...&quot;</span>)<br>time.Sleep(time.Second)<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ctx, cancel := context.WithTimeout(context.Background(), time.Second*<span class="hljs-number">5</span>)<br><span class="hljs-keyword">go</span> worker(ctx)<br><span class="hljs-keyword">go</span> worker2(ctx)<br>time.Sleep(time.Second * <span class="hljs-number">5</span>)<br><span class="hljs-keyword">defer</span> cancel()<br><span class="hljs-keyword">go</span> worker2(ctx)<br>fmt.Println(<span class="hljs-string">&quot;...over...&quot;</span>)<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="newå’Œmake"><a href="#newå’Œmake" class="headerlink" title="newå’Œmake"></a><strong>newå’Œmake</strong></h3><p>éƒ½æ˜¯åˆå§‹åŒ–å†…å­˜</p><p>newï¼Œå¤šç”¨æ¥ä¸ºåŸºæœ¬æ•°æ®ç±»å‹åˆå§‹åŒ–å†…å­˜ï¼Œè¿”å›æŒ‡é’ˆ</p><p>makeï¼šç”¨æ¥åˆå§‹åŒ–ï¼ˆsliceã€mapã€chanï¼‰,è¿”å›å¯¹äºç±»å‹</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>é¢å‘å¯¹è±¡</title>
    <link href="/2022/09/02/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
    <url>/2022/09/02/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h2><p><strong>æ–‡å­—æè¿°ï¼š</strong></p><p>é€šè¿‡constå®šä¹‰äº†ä¸€äº›å¸¸é‡ï¼Œç„¶åå®šä¹‰äº†ä¸€äº›è‡ªå®šä¹‰ç±»å‹</p><ul><li>Colorä½œä¸ºbyteçš„åˆ«å</li><li>å®šä¹‰äº†ä¸€ä¸ªstruct:Boxï¼Œå«æœ‰ä¸‰ä¸ªé•¿å®½é«˜å­—æ®µå’Œä¸€ä¸ªé¢œè‰²å±æ€§</li><li>å®šä¹‰äº†ä¸€ä¸ªslice:BoxListï¼Œå«æœ‰Box</li></ul><p>ç„¶åä»¥ä¸Šé¢çš„è‡ªå®šä¹‰ç±»å‹ä¸ºæ¥æ”¶è€…å®šä¹‰äº†ä¸€äº›method</p><ul><li>Volume()å®šä¹‰äº†æ¥æ”¶è€…ä¸ºBoxï¼Œè¿”å›Boxçš„å®¹é‡</li><li>SetColor(c Color)ï¼ŒæŠŠBoxçš„é¢œè‰²æ”¹ä¸ºc</li><li>BiggestColor()å®šåœ¨åœ¨BoxListä¸Šé¢ï¼Œè¿”å›listé‡Œé¢å®¹é‡æœ€å¤§çš„é¢œè‰²</li><li>PaintItBlack()æŠŠBoxListé‡Œé¢æ‰€æœ‰Boxçš„é¢œè‰²å…¨éƒ¨å˜æˆé»‘è‰²</li><li>String()å®šä¹‰åœ¨Colorä¸Šé¢ï¼Œè¿”å›Colorçš„å…·ä½“é¢œè‰²(å­—ç¬¦ä¸²æ ¼å¼)</li></ul><p>å®šä¹‰SetColorçš„çœŸæ­£ç›®çš„æ˜¯æƒ³æ”¹å˜è¿™ä¸ªBoxçš„é¢œè‰²ï¼Œå¦‚æœä¸ä¼ Boxçš„æŒ‡é’ˆï¼Œé‚£ä¹ˆSetColoræ¥å—çš„å…¶å®æ˜¯Boxçš„ä¸€ä¸ªcopyï¼Œä¹Ÿå°±æ˜¯è¯´methodå†…å¯¹äºé¢œè‰²å€¼çš„ä¿®æ”¹ï¼Œå…¶å®åªä½œç”¨äºBoxçš„copyï¼Œè€Œä¸æ˜¯çœŸæ­£çš„Boxã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¼ å…¥æŒ‡é’ˆã€‚</p><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>å¦‚æœåŒ¿åå­—æ®µå®ç°äº†ä¸€ä¸ªmethodï¼Œé‚£ä¹ˆåŒ…å«è¿™ä¸ªåŒ¿åå­—æ®µçš„structä¹Ÿå¯ä»¥è°ƒç”¨method.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Human <span class="hljs-keyword">struct</span> &#123;<br>name <span class="hljs-type">string</span><br>age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Student <span class="hljs-keyword">struct</span> &#123;<br>Human<br>school <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Company <span class="hljs-keyword">struct</span> &#123;<br>Human<br>conpany <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h Human)</span></span> SayHi() &#123;<br>fmt.Println(<span class="hljs-string">&quot;Hi&quot;</span>, h.name)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>tony := Student&#123;Human&#123;name: <span class="hljs-string">&quot;tony&quot;</span>, age: <span class="hljs-number">12</span>&#125;, <span class="hljs-string">&quot;MTA&quot;</span>&#125;<br>Mark := Company&#123;Human&#123;name: <span class="hljs-string">&quot;Mark&quot;</span>, age: <span class="hljs-number">22</span>&#125;, <span class="hljs-string">&quot;TA&quot;</span>&#125;<br><br>tony.SayHi()<br>Mark.SayHi()<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é‡å†™"><a href="#é‡å†™" class="headerlink" title="é‡å†™"></a>é‡å†™</h2><p>é‡æ–°å®šä¹‰ä¸€ä¸ªç›¸åŒçš„mrthodï¼Œé‡æ–°å†™åŒ¿åå­—æ®µçš„æ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Human <span class="hljs-keyword">struct</span> &#123;<br>name <span class="hljs-type">string</span><br>age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Student <span class="hljs-keyword">struct</span> &#123;<br>Human<br>school <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Company <span class="hljs-keyword">struct</span> &#123;<br>Human<br>conpany <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h Human)</span></span> SayHi() &#123;<br>fmt.Println(<span class="hljs-string">&quot;Hi&quot;</span>, h.name)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *Company)</span></span> SayHi() &#123;<br>e.conpany = <span class="hljs-string">&quot;TB&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>tony := Student&#123;Human&#123;name: <span class="hljs-string">&quot;tony&quot;</span>, age: <span class="hljs-number">12</span>&#125;, <span class="hljs-string">&quot;MTA&quot;</span>&#125;<br>Mark := Company&#123;Human&#123;name: <span class="hljs-string">&quot;Mark&quot;</span>, age: <span class="hljs-number">22</span>&#125;, <span class="hljs-string">&quot;TA&quot;</span>&#125;<br><br>tony.SayHi()<br>Mark.SayHi()<br>fmt.Println(Mark.conpany)<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>structç±»å‹</title>
    <link href="/2022/09/02/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/struct%E7%B1%BB%E5%9E%8B/"/>
    <url>/2022/09/02/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/struct%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h2><p>å£°æ˜æ–°çš„ç±»å‹ï¼Œä½œä¸ºå…¶ä»–ç±»å‹çš„å±æ€§æˆ–è€…å­—æ®µçš„å®¹å™¨ã€‚</p><h2 id="åŒ¿åå­—æ®µ"><a href="#åŒ¿åå­—æ®µ" class="headerlink" title="åŒ¿åå­—æ®µ"></a>åŒ¿åå­—æ®µ</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Human <span class="hljs-keyword">struct</span> &#123;<br>    name <span class="hljs-type">string</span><br>    age <span class="hljs-type">int</span><br>    weight <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Student <span class="hljs-keyword">struct</span> &#123;<br>    Human  <span class="hljs-comment">// åŒ¿åå­—æ®µï¼Œé‚£ä¹ˆé»˜è®¤Studentå°±åŒ…å«äº†Humançš„æ‰€æœ‰å­—æ®µ</span><br>    speciality <span class="hljs-type">string</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åŒ¿åå­—æ®µå¯ä»¥å®ç°å­—æ®µçš„ç»§æ‰¿ã€‚</p><p>structä¸ä»…ä»…èƒ½å¤Ÿå°†structä½œä¸ºåŒ¿åå­—æ®µï¼Œè‡ªå®šä¹‰ç±»å‹ã€å†…ç½®ç±»å‹éƒ½å¯ä»¥ä½œä¸ºåŒ¿åå­—æ®µï¼Œè€Œä¸”å¯ä»¥åœ¨ç›¸åº”çš„å­—æ®µä¸Šé¢è¿›è¡Œå‡½æ•°æ“ä½œ</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>httpè¯¦è§£</title>
    <link href="/2022/09/01/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/http%E8%AF%A6%E8%A7%A3/"/>
    <url>/2022/09/01/go%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/http%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="webå·¥ä½œ"><a href="#webå·¥ä½œ" class="headerlink" title="webå·¥ä½œ"></a>webå·¥ä½œ</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;strings&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SayHello</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>r.ParseForm()       <span class="hljs-comment">//è§£æå‚æ•°</span><br>fmt.Println(r.Form) <span class="hljs-comment">//è¾“å‡ºåˆ°æœåŠ¡å™¨ç«¯çš„</span><br>fmt.Println(<span class="hljs-string">&quot;path&quot;</span>, r.URL.Path)<br>fmt.Println(<span class="hljs-string">&quot;scheme&quot;</span>, r.URL.Scheme)<br>fmt.Println(r.Form[<span class="hljs-string">&quot;url_long&quot;</span>])<br><br><span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> r.Form &#123;<br>fmt.Println(<span class="hljs-string">&quot;key:&quot;</span>, k)<br>fmt.Println(<span class="hljs-string">&quot;val:&quot;</span>, strings.Join(v, <span class="hljs-string">&quot; &quot;</span>))<br>&#125;<br><br>fmt.Fprintln(w, <span class="hljs-string">&quot;hello World&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, SayHello)<br>http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><ul><li>request:ç”¨æˆ·è¯·æ±‚ä¿¡æ¯ï¼Œç”¨æ¥è§£æç”¨æˆ·çš„è¯·æ±‚ä¿¡æ¯ã€‚</li><li>response:æœåŠ¡å™¨éœ€è¦åé¦ˆç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚</li><li>conn:è¯·æ±‚é“¾æ¥</li><li>handler:å¤„ç†è¯·æ±‚å’Œç”Ÿæˆè¿”å›ä¿¡æ¯çš„å¤„ç†é€»è¾‘</li></ul><h2 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h2><ol><li><p>å»ºç«‹ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p><p><code>http.ListenAndServe(&quot;:8080&quot;, nil)</code></p><p>ç›‘å¬è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºServerå¯¹è±¡ï¼Œä¹‹åè°ƒç”¨<code>server.ListenAndServe()</code>æ–¹æ³•ï¼Œåº•å±‚ç”¨tcpæ­å»ºäº†ä¸€ä¸ªæœåŠ¡ï¼Œæœ€åè°ƒç”¨<code>srv.Serve(ln)</code>ç›‘å¬ç«¯å£</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(srv *Server)</span></span> ListenAndServe() <span class="hljs-type">error</span> &#123;<br><span class="hljs-keyword">if</span> srv.shuttingDown() &#123;<br><span class="hljs-keyword">return</span> ErrServerClosed<br>&#125;<br>addr := srv.Addr<br><span class="hljs-keyword">if</span> addr == <span class="hljs-string">&quot;&quot;</span> &#123;<br>addr = <span class="hljs-string">&quot;:http&quot;</span><br>&#125;<br>ln, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, addr)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">return</span> srv.Serve(ln)<br><br></code></pre></td></tr></table></figure></li><li><p>Listen Socket æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿›è¡Œé€šä¿¡ã€‚</p><p>é¦–å…ˆé€šè¿‡Listeneræ¥æ”¶è¯·æ±‚ï¼š<code>l.Accept()</code>ï¼Œå…¶æ¬¡åˆ›å»ºä¸€ä¸ªConnï¼š<code>c := srv.newConn(rw)</code>ï¼Œæœ€åå•ç‹¬å¼€äº†ä¸€ä¸ªgoroutineï¼ŒæŠŠè¿™ä¸ªè¯·æ±‚çš„æ•°æ®å½“åšå‚æ•°æ‰”ç»™è¿™ä¸ªconnå»æœåŠ¡ï¼š<code>go c.serve(connCtx)</code>ã€‚è¿™ä¸ªå°±æ˜¯é«˜å¹¶å‘ä½“ç°äº†ï¼Œç”¨æˆ·çš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½æ˜¯åœ¨ä¸€ä¸ªæ–°çš„goroutineå»æœåŠ¡ï¼Œç›¸äº’ä¸å½±å“ã€‚</p></li><li><p>å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œhandlerå¤„ç†ã€‚</p><p>conné¦–å…ˆä¼šè§£ærequest:<code>w, err := c.readRequest(ctx)</code>, ç„¶åè·å–ç›¸åº”çš„handlerå»å¤„ç†è¯·æ±‚:<code>serverHandler&#123;c.server&#125;.ServeHTTP(w, w.req)</code>ï¼Œ<code>ServeHTTP</code>çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(sh serverHandler)</span></span> ServeHTTP(rw ResponseWriter, req *Request) &#123;<br>handler := sh.srv.Handler<br><span class="hljs-keyword">if</span> handler == <span class="hljs-literal">nil</span> &#123;<br>handler = DefaultServeMux<br>&#125;<br><span class="hljs-keyword">if</span> req.RequestURI == <span class="hljs-string">&quot;*&quot;</span> &amp;&amp; req.Method == <span class="hljs-string">&quot;OPTIONS&quot;</span> &#123;<br>handler = globalOptionsHandler&#123;&#125;<br>&#125;<br>handler.ServeHTTP(rw, req)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>sh.srv.Handler</code>å°±æ˜¯æˆ‘ä»¬åˆšæ‰åœ¨è°ƒç”¨å‡½æ•°<code>ListenAndServe</code>æ—¶å€™çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å‰é¢ä¾‹å­ä¼ é€’çš„æ˜¯nilï¼Œä¹Ÿå°±æ˜¯ä¸ºç©ºï¼Œé‚£ä¹ˆé»˜è®¤è·å–<code>handler = DefaultServeMux</code>,è¿™ä¸ªå˜é‡å°±æ˜¯ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå®ƒç”¨æ¥åŒ¹é…urlè·³è½¬åˆ°å…¶ç›¸åº”çš„handleå‡½æ•°ï¼Œæˆ‘ä»¬è°ƒç”¨çš„ä»£ç é‡Œé¢ç¬¬ä¸€å¥ä¸æ˜¯è°ƒç”¨äº†<code>http.HandleFunc(&quot;/&quot;, sayhelloName)</code>ã€‚è¿™ä¸ªä½œç”¨å°±æ˜¯æ³¨å†Œäº†è¯·æ±‚/çš„è·¯ç”±è§„åˆ™ï¼Œå½“è¯·æ±‚uriä¸ºâ€/â€œï¼Œè·¯ç”±å°±ä¼šè½¬åˆ°å‡½æ•°sayhelloNameï¼ŒDefaultServeMuxä¼šè°ƒç”¨ServeHTTPæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨å…¶å®å°±æ˜¯è°ƒç”¨sayhelloNameæœ¬èº«ï¼Œæœ€åé€šè¿‡å†™å…¥responseçš„ä¿¡æ¯åé¦ˆåˆ°å®¢æˆ·ç«¯ã€‚</p></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>middlewareâ€”â€”ä¸­é—´ä»¶</title>
    <link href="/2022/08/31/golang/gin%E6%A1%86%E6%9E%B6/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    <url>/2022/08/31/golang/gin%E6%A1%86%E6%9E%B6/%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="middleware"><a href="#middleware" class="headerlink" title="middleware"></a>middleware</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>ä¸­é—´ä»¶å¤„ç†å¤„ç†ç¨‹åºæ˜¯ç®€å•çš„http.Handler,å®ƒåŒ…è£…å¦ä¸€ä¸ªhttp.Handler</p><p>ä½œè¯·æ±‚çš„ä¸€äº›é¢„å¤„ç†å’Œæˆ–åå¤„ç†ï¼Œè¢«ç§°ä¸ºä¸­é—´ä»¶ã€‚</p><p>æ¯ä¸ªä¸­é—´ä»¶åªå¤„ç†ä¸€ä»¶äº‹æƒ…ï¼Œå®Œæˆåå°†å…¶ä¼ é€’ç»™å¦ä¸€ä¸ªä¸­é—´ä»¶æˆ–è€…æœ€ç»ˆå¤„ç†ç¨‹åºï¼Œå¯ä»¥åšåˆ°ç¨‹åºçš„è§£è€¦ï¼Œå‡å°‘ç¨‹åºçš„å†—ä½™å’Œé™ä½ä»£ç å¤ç”¨ç‡ã€‚</p><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><p>å¸¸è§çš„ç”¨ä¾‹ï¼šè¯·æ±‚å¦‚ä¹‹è®°å½•ã€headeræ“çºµã€httpè¯·æ±‚è®¤è¯å’ŒResponseriteråŠ«æŒç­‰ç­‰ã€‚</p><ul><li>è®°å½•å¯¹æœåŠ¡å™¨å‘é€çš„è¯·æ±‚</li><li>å¤„ç†æœåŠ¡å™¨å“åº”</li><li>è¯·æ±‚å’Œå¤„ç†ä¹‹é—´åšä¸€ä¸ªæƒé™è®¤è¯å·¥ä½œ</li><li>è¿œç¨‹è°ƒç”¨</li><li>å®‰å…¨</li></ul><h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><h3 id="å•ä¸­é—´ä»¶"><a href="#å•ä¸­é—´ä»¶" class="headerlink" title="å•ä¸­é—´ä»¶"></a>å•ä¸­é—´ä»¶</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br>)<br><br><span class="hljs-comment">//&quot;github.com/gin-gonic/gin&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">logging</span><span class="hljs-params">(f http.HandlerFunc)</span></span> http.HandlerFunc &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>log.Println(r.URL.Path)<br>f(w, r)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">foo</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>fmt.Fprintln(w, <span class="hljs-string">&quot;foo&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bar</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>fmt.Fprintln(w, <span class="hljs-string">&quot;bar&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loggingMiddleWare</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler &#123;<br><span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>log.Println(r.URL.Path)<br>next.ServeHTTP(w, r)<br>&#125;)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>http.Handle(<span class="hljs-string">&quot;/foo&quot;</span>, loggingMiddleWare(http.HandlerFunc(foo)))<br>http.Handle(<span class="hljs-string">&quot;/bar&quot;</span>, loggingMiddleWare(http.HandlerFunc(bar)))<br><span class="hljs-comment">//http.HandleFunc(&quot;/foo&quot;, logging(foo))</span><br><span class="hljs-comment">//http.HandleFunc(&quot;/bar&quot;, logging(bar))</span><br>http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¤šä¸­é—´ä»¶"><a href="#å¤šä¸­é—´ä»¶" class="headerlink" title="å¤šä¸­é—´ä»¶"></a>å¤šä¸­é—´ä»¶</h3><p>ä¸­é—´ä»¶å°†æ–¹æ³•ä½œä¸ºå‚æ•°ä¹‹ä¸€ï¼ŒåŒ…è£…å¹¶è¿”å›ä¸€ä¸ªæ–°çš„æ–¹æ³•æœåŠ¡å™¨ï¼Œå®šä¹‰ä¸€ç§æ–°çš„MiddlWareï¼Œå®¹æ˜“å°†å¤šä¸ªä¸­é—´ä»¶è¿æ¥èµ·æ¥</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-comment">//&quot;github.com/gin-gonic/gin&quot;</span><br><br><span class="hljs-keyword">type</span> MiddleWare <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(http.HandlerFunc)</span></span> http.HandlerFunc<br><br><span class="hljs-keyword">type</span> MiddleWare1 <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(http.Handler)</span></span> http.Handler<br><br><span class="hljs-comment">//æ—¥å¿—æ‰“å°</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">logging</span><span class="hljs-params">()</span></span> MiddleWare1 &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(h http.Handler)</span></span> http.Handler &#123;<br><span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>start := time.Now()<br><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>log.Println(r.URL.Path)<br>time.Since(start)<br>&#125;()<br>h.ServeHTTP(w, r)<br>&#125;)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">method</span><span class="hljs-params">(m <span class="hljs-type">string</span>)</span></span> MiddleWare1 &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(h http.Handler)</span></span> http.Handler &#123;<br><span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br><span class="hljs-keyword">if</span> r.Method != m &#123;<br>http.Error(w, http.StatusText(http.StatusBadRequest), http.StatusBadRequest)<br>&#125;<br>h.ServeHTTP(w, r)<br>&#125;)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">chain1</span><span class="hljs-params">(f http.Handler, middlewares ...MiddleWare1)</span></span> http.Handler &#123;<br><span class="hljs-keyword">for</span> _, m := <span class="hljs-keyword">range</span> middlewares &#123;<br>f = m(f)<br>&#125;<br><span class="hljs-keyword">return</span> f<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Logging</span><span class="hljs-params">()</span></span> MiddleWare &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(hf http.HandlerFunc)</span></span> http.HandlerFunc &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>start := time.Now()<br><br><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>log.Println(r.URL.Path)<br>time.Since(start)<br>&#125;()<br>hf(w, r)<br>&#125;<br><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Method</span><span class="hljs-params">(m <span class="hljs-type">string</span>)</span></span> MiddleWare &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(hf http.HandlerFunc)</span></span> http.HandlerFunc &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br><span class="hljs-keyword">if</span> r.Method != m &#123;<br>http.Error(w, http.StatusText(http.StatusBadRequest), http.StatusBadRequest)<br>&#125;<br>hf(w, r)<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">chain</span><span class="hljs-params">(f http.HandlerFunc, middlewares ...MiddleWare)</span></span> http.HandlerFunc &#123;<br><span class="hljs-keyword">for</span> _, m := <span class="hljs-keyword">range</span> middlewares &#123;<br>f = m(f)<br>&#125;<br><span class="hljs-keyword">return</span> f<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Hello</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>fmt.Fprintln(w, <span class="hljs-string">&quot;hello world&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>http.Handle(<span class="hljs-string">&quot;/test&quot;</span>, chain1(http.HandlerFunc(Hello), method(<span class="hljs-string">&quot;GET&quot;</span>), logging()))<br>http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, chain(Hello, Method(<span class="hljs-string">&quot;GET&quot;</span>), Logging()))<br>http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="ginä¸­é—´ä»¶"><a href="#ginä¸­é—´ä»¶" class="headerlink" title="ginä¸­é—´ä»¶"></a>ginä¸­é—´ä»¶</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">r:=gin.Default()<span class="hljs-comment">//åˆ›å»ºå¸¦æœ‰é»˜è®¤çš„ä¸­é—´ä»¶è·¯ç”±ï¼ˆåŒ…å«loggerå’Œrecoveryï¼‰</span><br>r:=gin.<span class="hljs-built_in">new</span>()<span class="hljs-comment">//åˆ›å»ºæ²¡æœ‰ä¸­é—´ä»¶çš„è·¯ç”±</span><br></code></pre></td></tr></table></figure><p>ä¸¤ç§ä¸­é—´ä»¶æ–¹å¼ï¼Œåç»­å±•ç¤ºç¬¬äºŒç§</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs stylus">package <span class="hljs-selector-tag">main</span><br><br>import (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-comment">//&quot;github.com/gin-gonic/gin&quot;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬ä¸€ç§æ–¹å¼-----è¯·æ±‚ä¹‹å‰</span><br><span class="hljs-comment">è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬ä¸€ç§æ–¹å¼-----è¯·æ±‚ä¹‹å</span><br><span class="hljs-comment">2022/08/31 15:40:57 12345</span><br><span class="hljs-comment">2022/08/31 15:40:57 64.542Âµs</span><br><span class="hljs-comment">2022/08/31 15:40:57 200</span><br><span class="hljs-comment">**/</span><br>func <span class="hljs-built_in">Logger</span>() gin<span class="hljs-selector-class">.HandlerFunc</span> &#123;<br>return <span class="hljs-built_in">func</span>(ctx *gin.Context) &#123;<br>t := <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.Now</span>()<br>fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-string">&quot;è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬ä¸€ç§æ–¹å¼-----è¯·æ±‚ä¹‹å‰&quot;</span>)<br><span class="hljs-comment">//åœ¨ginä¸Šä¸‹æ–‡å®šä¹‰ä¸€ä¸ªå˜é‡</span><br>ctx<span class="hljs-selector-class">.Set</span>(<span class="hljs-string">&quot;example&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>)<br><span class="hljs-comment">//è¯·æ±‚ä¹‹å‰</span><br>ctx<span class="hljs-selector-class">.Next</span>()<br>fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-string">&quot;è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬ä¸€ç§æ–¹å¼-----è¯·æ±‚ä¹‹å&quot;</span>)<br><span class="hljs-comment">//è®¡ç®—æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹</span><br>latency := <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.Since</span>(t)<br>log<span class="hljs-selector-class">.Print</span>(latency)<br><br><span class="hljs-comment">//è¯·æ±‚çŠ¶æ€æ‰“å°</span><br>status := ctx<span class="hljs-selector-class">.Writer</span><span class="hljs-selector-class">.Status</span>()<br>log<span class="hljs-selector-class">.Println</span>(status)<br>&#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬äºŒç§æ–¹å¼-----è¯·æ±‚ä¹‹å‰</span><br><span class="hljs-comment">è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬äºŒç§æ–¹å¼-----è¯·æ±‚ä¹‹å</span><br><span class="hljs-comment">2022/08/31 15:40:17 12345</span><br><span class="hljs-comment">2022/08/31 15:40:17 60.112Âµs</span><br><span class="hljs-comment">2022/08/31 15:40:17 200</span><br><span class="hljs-comment">**/</span><br>func <span class="hljs-built_in">Logger1</span>(c *gin.Context) &#123;<br>t := <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.Now</span>()<br>fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-string">&quot;è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬äºŒç§æ–¹å¼-----è¯·æ±‚ä¹‹å‰&quot;</span>)<br><span class="hljs-comment">//åœ¨ginä¸Šä¸‹æ–‡å®šä¹‰ä¸€ä¸ªå˜é‡</span><br>c<span class="hljs-selector-class">.Set</span>(<span class="hljs-string">&quot;example&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>)<br><span class="hljs-comment">//è¯·æ±‚ä¹‹å‰</span><br>c<span class="hljs-selector-class">.Next</span>()<br>fmt<span class="hljs-selector-class">.Println</span>(<span class="hljs-string">&quot;è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶ç¬¬äºŒç§æ–¹å¼-----è¯·æ±‚ä¹‹å&quot;</span>)<br><span class="hljs-comment">//è®¡ç®—æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹</span><br>latency := <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.Since</span>(t)<br>log<span class="hljs-selector-class">.Print</span>(latency)<br><br><span class="hljs-comment">//è¯·æ±‚çŠ¶æ€æ‰“å°</span><br>status := c<span class="hljs-selector-class">.Writer</span><span class="hljs-selector-class">.Status</span>()<br>log<span class="hljs-selector-class">.Println</span>(status)<br>&#125;<br>func <span class="hljs-selector-tag">main</span>() &#123;<br>r := gin<span class="hljs-selector-class">.New</span>()<br>r<span class="hljs-selector-class">.Use</span>(<span class="hljs-built_in">Logger</span>())<br><span class="hljs-comment">//r.Use(Logger1)</span><br>r<span class="hljs-selector-class">.GET</span>(<span class="hljs-string">&quot;/test&quot;</span>, <span class="hljs-built_in">func</span>(ctx *gin.Context) &#123;<br>exam := ctx<span class="hljs-selector-class">.MustGet</span>(<span class="hljs-string">&quot;example&quot;</span>).(string)<br>log<span class="hljs-selector-class">.Println</span>(exam)<br>&#125;)<br>r<span class="hljs-selector-class">.Run</span>()<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>è·¯ç”±å™¨ä¸­é—´ä»¶</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RouterMiddle1</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;è·¯ç”±ä¸­é—´1&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RouterMiddle2</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;è·¯ç”±ä¸­é—´2&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onRouterMiddleHandle</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;ä¸šåŠ¡å¤„ç†&quot;</span>)<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.New()<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">è·¯ç”±ä¸­é—´1</span><br><span class="hljs-comment">è·¯ç”±ä¸­é—´2</span><br><span class="hljs-comment">ä¸šåŠ¡å¤„ç†</span><br><span class="hljs-comment">*/</span><br>r.GET(<span class="hljs-string">&quot;/onRouterMiddle&quot;</span>, RouterMiddle1, RouterMiddle2, onRouterMiddleHandle())<br>r.Run()<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è·¯ç”±ç»„ä¸­é—´ä»¶</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-comment">//è·¯ç”±ç»„ä¸­é—´ä»¶</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GroupRouterGoodsMiddle1</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;goodsè·¯ç”±ç»„ä¸­é—´ä»¶1&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GroupRouterGoodsMiddle2</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;goodsè·¯ç”±ç»„ä¸­é—´ä»¶2&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GroupRouterOrdersMiddle1</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Ordersè·¯ç”±ç»„ä¸­é—´ä»¶1&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GroupRouterOrdersMiddle2</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Ordersè·¯ç”±ç»„ä¸­é—´ä»¶2&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.New()<br>r.Use(gin.Logger())<br><br>    <span class="hljs-comment">//curl 127.0.0.1:8080/goods/add</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    goodsè·¯ç”±ç»„ä¸­é—´ä»¶1</span><br><span class="hljs-comment">goodsè·¯ç”±ç»„ä¸­é—´ä»¶2</span><br><span class="hljs-comment">/goods/add</span><br><span class="hljs-comment">    */</span><br>goodsGroup := r.Group(<span class="hljs-string">&quot;/goods&quot;</span>, GroupRouterGoodsMiddle1, GroupRouterGoodsMiddle2)<br>&#123;<br>goodsGroup.GET(<span class="hljs-string">&quot;/add&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;/goods/add&quot;</span>)<br>&#125;)<br>&#125;<br>    r.Group(<span class="hljs-string">&quot;/goods&quot;</span>, GroupRouterGoodsMiddle1, GroupRouterGoodsMiddle2).GET(<span class="hljs-string">&quot;/add&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;/goods/add&quot;</span>)<br>&#125;)<br>    <br>    <span class="hljs-comment">//curl 127.0.0.1:8080/goods/add</span><br>    <span class="hljs-comment">//æ§åˆ¶å°ç»“æœï¼š/goods/add</span><br>r.Group(<span class="hljs-string">&quot;/goods&quot;</span>, GroupRouterGoodsMiddle1, GroupRouterGoodsMiddle2)<br>r.GET(<span class="hljs-string">&quot;/goods/add&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;/goods/add&quot;</span>)<br>&#125;)<br>    <br>    <br>orderGroup := r.Group(<span class="hljs-string">&quot;/order&quot;</span>)<br>orderGroup.Use(GroupRouterOrdersMiddle1, GroupRouterOrdersMiddle2)<br>&#123;<br>orderGroup.GET(<span class="hljs-string">&quot;/add&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;/order/add&quot;</span>)<br>&#125;)<br><br>orderGroup.GET(<span class="hljs-string">&quot;/del&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;/order/del&quot;</span>)<br>&#125;)<br><br><span class="hljs-comment">//åµŒå¥—</span><br>testGroup := orderGroup.Group(<span class="hljs-string">&quot;/test&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;/order/testä¸‹çš„ä¸­é—´ä»¶&quot;</span>)<br>&#125;)<br><br>testGroup.GET(<span class="hljs-string">&quot;/test1&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;/order/test/test1ä¸‹çš„å‡½æ•°&quot;</span>)<br>&#125;)<br><br>&#125;<br>r.Run()<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç»“è®ºï¼š</strong> å…¨å±€ä¸­é—´ä»¶ &gt; è·¯ç”±ç»„ä¸­é—´ä»¶ &gt; è·¯ç”±ä¸­é—´ä»¶<br> å…¨å±€ä¸­é—´ä»¶æœ€å…ˆæ‰§è¡Œ</p>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>ginæ¡†æ¶</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ä¸Šä¼ æ–‡ä»¶&amp;&amp;Template</title>
    <link href="/2022/08/31/golang/gin%E6%A1%86%E6%9E%B6/%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6&amp;Template/"/>
    <url>/2022/08/31/golang/gin%E6%A1%86%E6%9E%B6/%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6&amp;Template/</url>
    
    <content type="html"><![CDATA[<h2 id="HTMLæ¨¡æ¿"><a href="#HTMLæ¨¡æ¿" class="headerlink" title="HTMLæ¨¡æ¿"></a>HTMLæ¨¡æ¿</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go">r.LoadHTMLGlob(<span class="hljs-string">&quot;templates/*&quot;</span>)<br>stu1 := &amp;Student&#123;Name: <span class="hljs-string">&quot;Geektutu&quot;</span>, Age: <span class="hljs-number">20</span>&#125;<br>stu2 := &amp;Student&#123;Name: <span class="hljs-string">&quot;Jack&quot;</span>, Age: <span class="hljs-number">22</span>&#125;<br>r.GET(<span class="hljs-string">&quot;/arr&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.HTML(http.StatusOK, <span class="hljs-string">&quot;arr.tmpl&quot;</span>, gin.H&#123;<br><span class="hljs-string">&quot;title&quot;</span>:  <span class="hljs-string">&quot;World&quot;</span>,<br><span class="hljs-string">&quot;stuArr&quot;</span>: [<span class="hljs-number">2</span>]*Student&#123;stu1, stu2&#125;,<br>&#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml"><span class="hljs-comment">&lt;!-- templates/arr.tmpl --&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello, </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">.title</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">range</span> $index, $ele <span class="hljs-attr">:</span>= .stuArr &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$index</span> &#125;&#125;</span><span class="language-xml">: </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$ele.Name</span> &#125;&#125;</span><span class="language-xml"> is </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">$ele.Age</span> &#125;&#125;</span><span class="language-xml"> years old<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">end</span> &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/Pictures$ curl http://localhost:8080/arr<br><br>&lt;html&gt;<br>&lt;body&gt;<br>    &lt;p&gt;hello, World&lt;/p&gt;<br>    <br>    &lt;p&gt;0: Geektutu is 20 years old&lt;/p&gt;<br>    <br>    &lt;p&gt;1: Jack is 22 years old&lt;/p&gt;<br>    <br>&lt;/body&gt;<br><br></code></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><h3 id="å•æ–‡ä»¶ä¸Šä¼ "><a href="#å•æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å•æ–‡ä»¶ä¸Šä¼ "></a>å•æ–‡ä»¶ä¸Šä¼ </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/upload&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>file, err := c.FormFile(<span class="hljs-string">&quot;upload&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.String(http.StatusBadRequest, <span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>)<br>&#125;<br><br>filename := file.Filename<br>fmt.Println(<span class="hljs-string">&quot;æ–‡ä»¶å:&quot;</span>, filename)<br><br><span class="hljs-comment">//ä¿å­˜åˆ°æœ¬åœ°æœåŠ¡å™¨</span><br><span class="hljs-keyword">if</span> err := c.SaveUploadedFile(file, filename); err != <span class="hljs-literal">nil</span> &#123;<br>c.String(http.StatusBadRequest, <span class="hljs-string">&quot;ä¿å­˜å¤±è´¥ Error:%s&quot;</span>, err.Error())<br>&#125;<br>c.String(http.StatusOK, <span class="hljs-string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š </p><p>curl -X POST <a href="http://localhost:8080/upload">http://localhost:8080/upload</a> -F â€œupload=@æ–‡ä»¶ç›®å½•åœ°å€â€ -H â€œContent-Type: multipart/form-dataâ€<br>ä¸Šä¼ æˆåŠŸ</p><h3 id="å¤šæ–‡ä»¶ä¸Šä¼ "><a href="#å¤šæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å¤šæ–‡ä»¶ä¸Šä¼ "></a>å¤šæ–‡ä»¶ä¸Šä¼ </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/uploads&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>form, err := c.MultipartForm()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.String(http.StatusBadRequest, <span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>)<br>&#125;<br>files := form.File[<span class="hljs-string">&quot;uploads[]&quot;</span>]<br><br><span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> files &#123;<br>fmt.Println(<span class="hljs-string">&quot;æ–‡ä»¶åï¼š&quot;</span>, file)<br><span class="hljs-keyword">if</span> err := c.SaveUploadedFile(file, file.Filename); err != <span class="hljs-literal">nil</span> &#123;<br>c.String(http.StatusBadRequest, <span class="hljs-string">&quot;ä¿å­˜å¤±è´¥ Error:%s&quot;</span>, err.Error())<br>&#125;<br>&#125;<br>c.String(http.StatusOK, <span class="hljs-string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>)<br><br>&#125;)<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/Pictures$ curl -X POST http://localhost:8080/uploads -F &quot;upload[]=@/home/ubuntu/Pictures/Screenshot from 2022-08-25 10-26-07.png&quot;  -F &quot;upload[]=@/home/ubuntu/Pictures/Screenshot from 2022-08-25 10-26-38.png&quot; -H &quot;Content-Type: multipart/form-data&quot;<br>ä¸Šä¼ æˆåŠŸ<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>ginæ¡†æ¶</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬ä¸€ä¸ªginç¨‹åº</title>
    <link href="/2022/08/29/golang/gin%E6%A1%86%E6%9E%B6/%E7%AC%AC%E4%B8%80%E4%B8%AAgin%E7%A8%8B%E5%BA%8F/"/>
    <url>/2022/08/29/golang/gin%E6%A1%86%E6%9E%B6/%E7%AC%AC%E4%B8%80%E4%B8%AAgin%E7%A8%8B%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;net/http&quot;</span><br><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.Default()<br>r.GET(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;Hello&quot;</span>)<br>&#125;)<br>r.GET(<span class="hljs-string">&quot;/name&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.String(http.StatusOK, <span class="hljs-string">&quot;world&quot;</span>)<br>&#125;)<br><br>r.Run() <span class="hljs-comment">// listen and serve on 0.0.0.0:8080</span><br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>gin.Default()</code>ç”Ÿæˆäº†ä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å³ WSGI åº”ç”¨ç¨‹åºã€‚</li><li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>r.Get(&quot;/&quot;, ...)</code>å£°æ˜äº†ä¸€ä¸ªè·¯ç”±ï¼Œå‘Šè¯‰ Gin ä»€ä¹ˆæ ·çš„URL èƒ½è§¦å‘ä¼ å…¥çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ä¿¡æ¯ã€‚</li><li>æœ€åç”¨ <code>r.Run()</code>å‡½æ•°æ¥è®©åº”ç”¨è¿è¡Œåœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šï¼Œé»˜è®¤ç›‘å¬ç«¯å£æ˜¯ _8080_ï¼Œå¯ä»¥ä¼ å…¥å‚æ•°è®¾ç½®ç«¯å£ï¼Œä¾‹å¦‚<code>r.Run(&quot;:9999&quot;)</code>å³è¿è¡Œåœ¨ _9999_ç«¯å£ã€‚</li></ol><h3 id="è§£æè·¯ç»å‚æ•°"><a href="#è§£æè·¯ç»å‚æ•°" class="headerlink" title="è§£æè·¯ç»å‚æ•°"></a>è§£æè·¯ç»å‚æ•°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/:name&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>name := c.Param(<span class="hljs-string">&quot;name&quot;</span>)<br>c.String(http.StatusOK, <span class="hljs-string">&quot;Hello %s&quot;</span>, name)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="è§£æqureyå‚æ•°"><a href="#è§£æqureyå‚æ•°" class="headerlink" title="è§£æqureyå‚æ•°"></a>è§£æqureyå‚æ•°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/form&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>username := c.PostForm(<span class="hljs-string">&quot;username&quot;</span>)<br><span class="hljs-comment">//å¯è®¾ç½®é»˜è®¤çš„åˆå§‹å€¼</span><br>password := c.DefaultPostForm(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;000000&quot;</span>)<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;username&quot;</span>: username,<br><span class="hljs-string">&quot;password&quot;</span>: password,<br>&#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="è§£æqurey-amp-è·¯ç»å‚æ•°"><a href="#è§£æqurey-amp-è·¯ç»å‚æ•°" class="headerlink" title="è§£æqurey&amp;è·¯ç»å‚æ•°"></a>è§£æqurey&amp;è·¯ç»å‚æ•°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/posts&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>id := c.Query(<span class="hljs-string">&quot;id&quot;</span>)<br>page := c.DefaultQuery(<span class="hljs-string">&quot;page&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>)<br>username := c.PostForm(<span class="hljs-string">&quot;username&quot;</span>)<br><span class="hljs-comment">//å¯è®¾ç½®é»˜è®¤çš„åˆå§‹å€¼</span><br>password := c.DefaultPostForm(<span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;000000&quot;</span>)<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;id&quot;</span>:       id,<br><span class="hljs-string">&quot;page&quot;</span>:     page,<br><span class="hljs-string">&quot;username&quot;</span>: username,<br><span class="hljs-string">&quot;password&quot;</span>: password,<br>&#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>curl â€œ<a href="http://localhost:8080/posts?id=1&amp;page=13&quot;">http://localhost:8080/posts?id=1&amp;page=13&quot;</a>  -X POST -d â€˜username=geektutu&amp;password=1234â€™<br>{â€œidâ€:â€1â€,â€pageâ€:â€13â€,â€passwordâ€:â€1234â€,â€usernameâ€:â€geektutuâ€}</p><h3 id="mapå‚æ•°"><a href="#mapå‚æ•°" class="headerlink" title="mapå‚æ•°"></a>mapå‚æ•°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go">r.POST(<span class="hljs-string">&quot;/post&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>ids := c.QueryMap(<span class="hljs-string">&quot;ids&quot;</span>)<br>names := c.PostFormMap(<span class="hljs-string">&quot;names&quot;</span>)<br><br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;ids&quot;</span>:   ids,<br><span class="hljs-string">&quot;names&quot;</span>: names,<br>&#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>curl -g â€œ<a href="http://localhost:9999/post?ids%5BJack%5D=001&amp;ids%5BTom%5D=002&quot;">http://localhost:9999/post?ids[Jack]=001&amp;ids[Tom]=002&quot;</a> -X POST -d â€˜names[a]=Sam&amp;names[b]=Davidâ€™<br>{â€œidsâ€:{â€œJackâ€:â€001â€,â€Tomâ€:â€002â€},â€namesâ€:{â€œaâ€:â€Samâ€,â€bâ€:â€Davidâ€}}</p><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/redirect&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.Redirect(http.StatusMovedPermanently, <span class="hljs-string">&quot;/index&quot;</span>)<br>&#125;)<br>r.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.Request.URL.Path = <span class="hljs-string">&quot;/&quot;</span><br>r.HandleContext(c)<br>&#125;)<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">ubuntu@root:~/go$ curl http://localhost:8080/index</span><br><span class="hljs-comment">Helloubuntu@root:~/go$ -i http://localhost:8080/redirect</span><br><span class="hljs-comment">HTTP/1.1 301 Moved Permanently</span><br><span class="hljs-comment">Content-Type: text/html; charset=utf-8</span><br><span class="hljs-comment">Location: /index</span><br><span class="hljs-comment">Date: Mon, 29 Aug 2022 09:08:43 GMT</span><br><span class="hljs-comment">Content-Length: 41</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">&lt;a href=&quot;/index&quot;&gt;Moved Permanently&lt;/a&gt;.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h3 id="å¤šç»„è·¯ç”±"><a href="#å¤šç»„è·¯ç”±" class="headerlink" title="å¤šç»„è·¯ç”±"></a>å¤šç»„è·¯ç”±</h3><p>åˆ©ç”¨åˆ†ç»„è·¯ç”±å¯ä»¥æ›´å¥½åœ°å®ç°æƒé™æ§åˆ¶ï¼ˆå°†éœ€è¦ç™»é™†é‰´æƒçš„è·¯ç”±é˜²ç›—åŒä¸€ç»„ä¸­å»ï¼Œç®€åŒ–æƒé™æ§åˆ¶ï¼‰</p><p>åˆ’åˆ†ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªè·¯ç”±ï¼Œä¾¿äºç®¡ç†å’ŒæŸ¥æ‰¾ç›¸å…³çš„ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go">defaultHandler := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.JSON(http.StatusOK, gin.H&#123;<br><span class="hljs-string">&quot;path&quot;</span>: c.FullPath(),<br>&#125;)<br>&#125;<br><span class="hljs-comment">//https://geektutu.com/post/quick-go-gin.html</span><br><span class="hljs-comment">//group v1</span><br>v1 := r.Group(<span class="hljs-string">&quot;/v1&quot;</span>)<br>&#123;<br>v1.GET(<span class="hljs-string">&quot;/posts&quot;</span>, defaultHandler)<br>v1.GET(<span class="hljs-string">&quot;/series&quot;</span>, defaultHandler)<br>&#125;<br><br><span class="hljs-comment">//group v2</span><br>v2 := r.Group(<span class="hljs-string">&quot;/v2&quot;</span>)<br>&#123;<br>v2.GET(<span class="hljs-string">&quot;/posts&quot;</span>, defaultHandler)<br>v2.GET(<span class="hljs-string">&quot;/series&quot;</span>, defaultHandler)<br>&#125;<br><br><span class="hljs-comment">//ubuntu@root:~$ curl http://localhost:8080/v1/posts</span><br><span class="hljs-comment">//&#123;&quot;path&quot;:&quot;/v1/posts&quot;&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>golang</category>
      
      <category>ginæ¡†æ¶</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®‰è£…</title>
    <link href="/2022/08/29/docker/docker%E5%AE%89%E8%A3%85/"/>
    <url>/2022/08/29/docker/docker%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…ï¼ˆä¸€ï¼‰"><a href="#å®‰è£…ï¼ˆä¸€ï¼‰" class="headerlink" title="å®‰è£…ï¼ˆä¸€ï¼‰"></a>å®‰è£…ï¼ˆä¸€ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…ï¼ˆäºŒï¼‰"><a href="#å®‰è£…ï¼ˆäºŒï¼‰" class="headerlink" title="å®‰è£…ï¼ˆäºŒï¼‰"></a>å®‰è£…ï¼ˆäºŒï¼‰</h2><p>ç³»ç»Ÿï¼šcentos 7.6</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum remove docker docker-common docker-selinux docker-engine<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…ä¾èµ–</span><br>yum install -y yum-utils device-mapper-persistent-data lvm2<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®yumæº</span><br>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<br><br>yum list docker-ce --showduplicates | sort -r<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…docker</span><br><br>yum install -y docker-ce-20.10.8 docker-ce-cli-20.10.8 containerd.io <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨docker</span><br><br>systemctl daemon-reload<br><br>systemctl start docker<br><br>systemctl enable docker<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹dockerç‰ˆæœ¬</span><br><br>docker version<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexoå®‰è£…åŠä¸»é¢˜é…ç½®</title>
    <link href="/2022/08/25/hexo/%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/"/>
    <url>/2022/08/25/hexo/%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p><a href="https://hexo.io/zh-cn/docs/">Hexo</a> æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ <a href="http://daringfireball.net/projects/markdown/">Markdown</a>ï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®‰è£…nodejs(éœ€è¦æ³¨æ„nodejsçš„ç‰ˆæœ¬è¦æ±‚)ï¼š<a href="../deploy/ubuntu%E5%AE%89%E8%A3%85nodejs">ubuntuå®‰è£…nodejs</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g hexo-cli<br></code></pre></td></tr></table></figure><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/Desktop/Blog$ hexo -v<br>INFO  Validating config<br>hexo: 5.4.2<br>hexo-cli: 4.3.0<br>os: linux 5.15.0-46-generic Ubuntu 20.04.4 LTS (Focal Fossa)<br>node: 14.20.0<br>v8: 8.4.371.23-node.87<br>uv: 1.42.0<br>zlib: 1.2.11<br>brotli: 1.0.9<br>ares: 1.18.1<br>modules: 83<br>nghttp2: 1.42.0<br>napi: 8<br>llhttp: 2.1.5<br>openssl: 1.1.1q<br>cldr: 40.0<br>icu: 70.1<br>tz: 2021a3<br>unicode: 14.0<br></code></pre></td></tr></table></figure><h2 id="å»ºç«™"><a href="#å»ºç«™" class="headerlink" title="å»ºç«™"></a>å»ºç«™</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>åˆå§‹åŒ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir Blog<br>cd Blog<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¹Ÿå¯ä¸å†™æ–‡ä»¶å¤¹ï¼Œé»˜è®¤æ˜¯åœ¨æœ¬ç›®å½•å±‚çº§æ„å»º</span><br>hexo init &lt;folder&gt;<br></code></pre></td></tr></table></figure><p>åŸºæœ¬ç›®å½•å±‚çº§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/Desktop/Blog$ tree -L 1<br>.<br>â”œâ”€â”€ _config.landscape.yml<br>â”œâ”€â”€ _config.yml<br>â”œâ”€â”€ node_modules<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ package-lock.json<br>â”œâ”€â”€ scaffolds<br>â”œâ”€â”€ source<br>â””â”€â”€ themes<br><br>4 directories, 4 files<br></code></pre></td></tr></table></figure><h3 id="new"><a href="#new" class="headerlink" title="new"></a>new</h3><h3 id="hexo-clean"><a href="#hexo-clean" class="headerlink" title="hexo clean"></a>hexo clean</h3><h3 id="hexo-g"><a href="#hexo-g" class="headerlink" title="hexo g"></a>hexo g</h3><h3 id="hexo-s"><a href="#hexo-s" class="headerlink" title="hexo s"></a>hexo s</h3><h3 id="hexo-d"><a href="#hexo-d" class="headerlink" title="hexo d"></a>hexo d</h3><h2 id="fluid-ä¸»é¢˜é…ç½®"><a href="#fluid-ä¸»é¢˜é…ç½®" class="headerlink" title="fluid ä¸»é¢˜é…ç½®"></a>fluid ä¸»é¢˜é…ç½®</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install <span class="hljs-comment">--save hexo-theme-fluid</span><br></code></pre></td></tr></table></figure><p>åœ¨åšå®¢ç›®å½•ä¸‹åˆ›å»º <code>_config.fluid.yml</code> æ–‡ä»¶ï¼Œå°†ä¸»é¢˜çš„ <a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml">_config.yml</a><a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml"> </a><a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml"> (opens new window)</a> å…¨éƒ¨é…ç½®ï¼ˆæˆ–éƒ¨åˆ†é…ç½®ï¼‰å¤åˆ¶è¿‡å»ã€‚</p><p>æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œä¸»é¢˜é…ç½®ï¼Œ<a href="https://hexo.fluid-dev.com/docs/guide/#%E5%85%B3%E4%BA%8E%E6%8C%87%E5%8D%97">fluidä¸»é¢˜é…ç½®</a></p><h2 id="å›¾ç‰‡æ’ä»¶è®¾ç½®"><a href="#å›¾ç‰‡æ’ä»¶è®¾ç½®" class="headerlink" title="å›¾ç‰‡æ’ä»¶è®¾ç½®"></a>å›¾ç‰‡æ’ä»¶è®¾ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install https://github.com/CodeFalling/hexo-asset-image --save<br><br></code></pre></td></tr></table></figure><p>åœ¨åšå®¢ç›®å½•<code>_config.yml</code>æ–‡ä»¶ï¼Œ</p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>fluid</tag>
      
      <tag>å®‰è£…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexoåˆå§‹åŒ–åŸºç¡€é…ç½®æ–‡ä»¶è§£æ</title>
    <link href="/2022/08/25/hexo/%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/"/>
    <url>/2022/08/25/hexo/%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h2><p>ç½‘ç«™çš„é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥é…ç½®å¤§éƒ¨åˆ†å‚æ•°ã€‚</p><h3 id="ç«™ç‚¹è®¾ç½®"><a href="#ç«™ç‚¹è®¾ç½®" class="headerlink" title="ç«™ç‚¹è®¾ç½®"></a>ç«™ç‚¹è®¾ç½®</h3><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>title</td><td>ç½‘ç«™æ ‡é¢˜</td></tr><tr><td>subtitle</td><td>ç½‘ç«™å‰¯æ ‡é¢˜</td></tr><tr><td>description</td><td>ç½‘ç«™æè¿°</td></tr><tr><td>keywords</td><td>ç½‘ç«™å…³é”®è¯</td></tr><tr><td>author</td><td>ä½œè€…åç§°</td></tr><tr><td>language</td><td>ä½¿ç”¨è¯­è¨€</td></tr><tr><td>timezone</td><td>ç½‘ç«™æ—¶åŒº</td></tr></tbody></table><h3 id="ç½‘å€è®¾ç½®"><a href="#ç½‘å€è®¾ç½®" class="headerlink" title="ç½‘å€è®¾ç½®"></a>ç½‘å€è®¾ç½®</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs json"># Hexo Configuration<br>## Docs<span class="hljs-punctuation">:</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//hexo.io/docs/configuration.html</span><br>## Source<span class="hljs-punctuation">:</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//github.com/hexojs/hexo/</span><br><br><br><br># URL<br>## Set your site url here. For example<span class="hljs-punctuation">,</span> if you use GitHub Page<span class="hljs-punctuation">,</span> set url as &#x27;https<span class="hljs-punctuation">:</span><span class="hljs-comment">//username.github.io/project&#x27;</span><br>url<span class="hljs-punctuation">:</span> http<span class="hljs-punctuation">:</span><span class="hljs-comment">//example.com</span><br>permalink<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">:</span>year/<span class="hljs-punctuation">:</span>month/<span class="hljs-punctuation">:</span>day/<span class="hljs-punctuation">:</span>title/<br>permalink_defaults<span class="hljs-punctuation">:</span><br>pretty_urls<span class="hljs-punctuation">:</span><br>  trailing_index<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> # Set to <span class="hljs-literal"><span class="hljs-keyword">false</span></span> to remove trailing &#x27;index.html&#x27; from permalinks<br>  trailing_html<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> # Set to <span class="hljs-literal"><span class="hljs-keyword">false</span></span> to remove trailing &#x27;.html&#x27; from permalinks<br><br># Directory<br>source_dir<span class="hljs-punctuation">:</span> source<br>public_dir<span class="hljs-punctuation">:</span> public<br>tag_dir<span class="hljs-punctuation">:</span> tags<br>archive_dir<span class="hljs-punctuation">:</span> archives<br>category_dir<span class="hljs-punctuation">:</span> categories<br>code_dir<span class="hljs-punctuation">:</span> downloads/code<br>i18n_dir<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">:</span>lang<br>skip_render<span class="hljs-punctuation">:</span><br><br># Writing<br>new_post_name<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">:</span>title.md # File name of new posts<br>default_layout<span class="hljs-punctuation">:</span> post<br>titlecase<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> # Transform title into titlecase<br>external_link<span class="hljs-punctuation">:</span><br>  enable<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> # Open external links in new tab<br>  field<span class="hljs-punctuation">:</span> site # Apply to the whole site<br>  exclude<span class="hljs-punctuation">:</span> &#x27;&#x27;<br>filename_case<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>render_drafts<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>post_asset_folder<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>relative_link<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>future<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>highlight<span class="hljs-punctuation">:</span><br>  enable<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  line_number<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  auto_detect<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  tab_replace<span class="hljs-punctuation">:</span> &#x27;&#x27;<br>  wrap<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  hljs<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>prismjs<span class="hljs-punctuation">:</span><br>  enable<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  preprocess<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  line_number<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  tab_replace<span class="hljs-punctuation">:</span> &#x27;&#x27;<br><br># Home page setting<br># path<span class="hljs-punctuation">:</span> Root path for your blogs index page. (default = &#x27;&#x27;)<br># per_page<span class="hljs-punctuation">:</span> Posts displayed per page. (<span class="hljs-number">0</span> = disable pagination)<br># order_by<span class="hljs-punctuation">:</span> Posts order. (Order by date descending by default)<br>index_generator<span class="hljs-punctuation">:</span><br>  path<span class="hljs-punctuation">:</span> &#x27;&#x27;<br>  per_page<span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>  order_by<span class="hljs-punctuation">:</span> -date<br><br># Category &amp; Tag<br>default_category<span class="hljs-punctuation">:</span> uncategorized<br>category_map<span class="hljs-punctuation">:</span><br>tag_map<span class="hljs-punctuation">:</span><br><br># Metadata elements<br>## https<span class="hljs-punctuation">:</span><span class="hljs-comment">//developer.mozilla.org/en-US/docs/Web/HTML/Element/meta</span><br>meta_generator<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><br># Date / Time format<br>## Hexo uses Moment.js to parse and display date<br>## You can customize the date format as defined in<br>## http<span class="hljs-punctuation">:</span><span class="hljs-comment">//momentjs.com/docs/#/displaying/format/</span><br>date_format<span class="hljs-punctuation">:</span> YYYY-MM-DD<br>time_format<span class="hljs-punctuation">:</span> HH<span class="hljs-punctuation">:</span>mm<span class="hljs-punctuation">:</span>ss<br>## updated_option supports &#x27;mtime&#x27;<span class="hljs-punctuation">,</span> &#x27;date&#x27;<span class="hljs-punctuation">,</span> &#x27;empty&#x27;<br>updated_option<span class="hljs-punctuation">:</span> &#x27;mtime&#x27;<br><br># Pagination<br>## Set per_page to <span class="hljs-number">0</span> to disable pagination<br>per_page<span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>pagination_dir<span class="hljs-punctuation">:</span> page<br><br># Include / Exclude file(s)<br>## include<span class="hljs-punctuation">:</span>/exclude<span class="hljs-punctuation">:</span> options only apply to the &#x27;source/&#x27; folder<br>include<span class="hljs-punctuation">:</span><br>exclude<span class="hljs-punctuation">:</span><br>ignore<span class="hljs-punctuation">:</span><br><br># Extensions<br>## Plugins<span class="hljs-punctuation">:</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//hexo.io/plugins/</span><br>## Themes<span class="hljs-punctuation">:</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//hexo.io/themes/</span><br>theme<span class="hljs-punctuation">:</span> landscape<br><br># Deployment<br>## Docs<span class="hljs-punctuation">:</span> https<span class="hljs-punctuation">:</span><span class="hljs-comment">//hexo.io/docs/one-command-deployment</span><br>deploy<span class="hljs-punctuation">:</span><br>  type<span class="hljs-punctuation">:</span> &#x27;&#x27;<br><br></code></pre></td></tr></table></figure><h2 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h2><p>åº”ç”¨ç¨‹åºä¿¡æ¯</p><h2 id="scaffolds"><a href="#scaffolds" class="headerlink" title="scaffolds"></a>scaffolds</h2><p>æ¨¡æ¿æ–‡ä»¶å¤¹ï¼Œå½“æ–°å»ºæ–‡ç« çš„æ—¶å€™ä¼šæ ¹æ®è¯¥æ¨¡æ¿å»ºç«‹æ–‡ä»¶ã€‚é»˜è®¤æ˜¯postæ¨¡æ¿(å¯ä»¥è‡ªå·±æ·»åŠ æ¨¡æ¿å†…å®¹)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/Desktop/Blog$ ls scaffolds/<br>draft.md  page.md  post.md<br>ubuntu@root:~/Desktop/Blog$ cat scaffolds/post.md <br>---<br>title: &#123;&#123; title &#125;&#125;<br>date: &#123;&#123; date &#125;&#125;<br>tags:<br>---<br><br></code></pre></td></tr></table></figure><h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>èµ„æºæ–‡ä»¶å¤¹æ˜¯ç”¨æ¥å­˜æ”¾ç”¨æˆ·èµ„æºçš„åœ°æ–¹ã€‚</p><p>HTMLå’ŒMarkDownæ–‡ä»¶ä¼šè¢«è§£æå¹¶æ”¾åˆ°publicæ–‡ä»¶å¤¹ï¼Œè€Œå…¶ä»–æ–‡ä»¶ä¼šè¢«æ‹·è´è¿‡å»</p><h2 id="themes"><a href="#themes" class="headerlink" title="themes"></a>themes</h2><p>ä¸»é¢˜æ–‡ä»¶å¤¹ã€‚æ ¹æ®è¯¥ä¸»é¢˜æ¥ç”Ÿæˆé™æ€é¡µé¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ccacheå®‰è£…åŠä½¿ç”¨</title>
    <link href="/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/ccache%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <url>/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/ccache%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨å¤„ç†ä¸€äº›è¾ƒå¤§è§„æ¨¡å·¥ç¨‹æ—¶ï¼Œç¼–è¯‘ä¼šèŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ã€‚ccacheä¼šåœ¨ç¬¬ä¸€éç¼–è¯‘æ—¶æ—¶é—´è¾ƒé•¿ï¼Œä¹‹åçš„ç¼–è¯‘ä¼šæˆå€çš„æé€Ÿã€‚</p><p><strong>åŸºæœ¬åŸç†ï¼š</strong>é€šè¿‡å¤´æ–‡ä»¶å‘Šè¯‰ç¼“å­˜åˆ°æºæ–‡ä»¶ä¸­è€Œæ”¹è¿›æ„å»ºæ€§èƒ½ï¼Œå› è€Œé€šè¿‡å‡å°‘æ¯ä¸€æ­¥ç¼–è¯‘æ—¶æ·»åŠ å¤´æ–‡ä»¶æ‰€éœ€çš„æ—¶é—´è€Œæé«˜æ„å»ºé€Ÿåº¦ã€‚</p><p>ç¬¬ä¸€è¶Ÿç¼–è¯‘ccacheç¼“å­˜GCCçš„â€-Eâ€çš„è¾“å‡ºï¼Œç¼–è¯‘é€‰é¡¹ä»¥åŠ.oæ–‡ä»¶åˆ°$HOME/.ccacheã€‚ç¬¬äºŒæ¬¡ç¼–è¯‘å°½é‡åˆ©ç”¨ç¼“å­˜ï¼Œå¿…è¦æ—¶æ›´æ–°ç¼“å­˜ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@68ab9a9c9a49 ccache-3.2.4]# yum install gcc make cmake -y<br><br>[root@68ab9a9c9a49 home]# wget http://samba.org/ftp/ccache/ccache-3.2.4.tar.gz<br>[root@68ab9a9c9a49 home]# tar -zxf ccache-3.2.4.tar.gz<br>[root@68ab9a9c9a49 home]# ls<br>ccache-3.2.4  ccache-3.2.4.tar.gz<br>[root@68ab9a9c9a49 home]# cd ccache-3.2.4<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®å®‰è£…</span><br>[root@68ab9a9c9a49 ccache-3.2.4]# /home/ccache-3.2.4/configure -prefix=/usr/local/ccache-3.2.4<br>configure: Configuring ccache<br>checking build system type... aarch64-unknown-linux-gnu<br>checking host system type... aarch64-unknown-linux-gnu<br>checking for gcc... gcc<br>checking whether the C compiler works... yes<br>checking for C compiler default output file name... a.out<br>checking for suffix of executables...<br>checking whether we are cross compiling... no<br>checking for suffix of object files... o<br>checking whether we are using the GNU C compiler... yes<br>.......<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¯‘å®‰è£…</span><br>[root@034ebb878219 ccache-3.2.4]# make -j4<br>[root@68ab9a9c9a49 ccache-3.2.4]# make install<br>/usr/bin/install -c -d /usr/local/ccache-3.2.4/bin<br>/usr/bin/install -c -m 755 ccache /usr/local/ccache-3.2.4/bin<br>/usr/bin/install -c -d /usr/local/ccache-3.2.4/share/man/man1<br>/usr/bin/install -c -m 644 ./ccache.1 /usr/local/ccache-3.2.4/share/man/man1/<br><br>[root@68ab9a9c9a49 home]# cd /usr/bin/<br>[root@68ab9a9c9a49 bin]# ln -s /usr/local/ccache-3.2.4/bin/ccache ccache<br><br>[root@68ab9a9c9a49 usr]# ccache --v<br>ccache version 3.2.4<br><br>Copyright (C) 2002-2007 Andrew Tridgell<br>Copyright (C) 2009-2015 Joel Rosdahl<br><br>This program is free software; you can redistribute it and/or modify it under<br>the terms of the GNU General Public License as published by the Free Software<br>Foundation; either version 3 of the License, or (at your option) any later<br>version.<br><br></code></pre></td></tr></table></figure><h2 id="ç¼–è¯‘åŠ é€Ÿä½¿ç”¨ï¼ˆmysqlç¼–è¯‘ï¼‰"><a href="#ç¼–è¯‘åŠ é€Ÿä½¿ç”¨ï¼ˆmysqlç¼–è¯‘ï¼‰" class="headerlink" title="ç¼–è¯‘åŠ é€Ÿä½¿ç”¨ï¼ˆmysqlç¼–è¯‘ï¼‰"></a>ç¼–è¯‘åŠ é€Ÿä½¿ç”¨ï¼ˆmysqlç¼–è¯‘ï¼‰</h2><h3 id="ccacheåŠ å…¥ç¯å¢ƒå˜é‡ï¼Œå–ä»£Cç¼–è¯‘å™¨ï¼š"><a href="#ccacheåŠ å…¥ç¯å¢ƒå˜é‡ï¼Œå–ä»£Cç¼–è¯‘å™¨ï¼š" class="headerlink" title="ccacheåŠ å…¥ç¯å¢ƒå˜é‡ï¼Œå–ä»£Cç¼–è¯‘å™¨ï¼š"></a>ccacheåŠ å…¥ç¯å¢ƒå˜é‡ï¼Œå–ä»£Cç¼–è¯‘å™¨ï¼š</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">cp ccache <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span><br>ln -s ccache <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/g</span>cc<br>ln -s ccache <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/g</span>++<br>ln -s ccache <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>cc<br>ln -s ccache <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>c++<br></code></pre></td></tr></table></figure><p>yumå®‰è£…ä»¥ç¼“å­˜çš„å½¢å¼è¿›è¡Œå®‰è£…ï¼Œç›®å½•æŒ‚è½½ï¼Œæœ¬åœ°æº</p><p>å¯ä»¥å¤§é‡çš„å‡å°‘å®‰è£…ç­‰å¾…çš„æ—¶é—´</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">yum install <span class="hljs-comment">--downloadonly åŒ…å</span><br></code></pre></td></tr></table></figure><p>åœ¨ ccache ä¸­ä½¿ç”¨ -s å‘½ä»¤è¡Œé€‰é¡¹æ¥è·å¾—å…³äºé«˜é€Ÿç¼“å­˜æ€§èƒ½çš„ç»Ÿè®¡æ•°æ®ã€‚</p><h3 id="MYSQL-5-7-Xç¼–è¯‘"><a href="#MYSQL-5-7-Xç¼–è¯‘" class="headerlink" title="MYSQL 5.7.Xç¼–è¯‘"></a>MYSQL 5.7.Xç¼–è¯‘</h3><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>å°†shæ–‡ä»¶åå°æ‰§è¡Œï¼Œ<code>sh test.sh &amp;&gt; /tmp/test.log</code></p><p>mysqlç‰ˆæœ¬ï¼š5.7.36</p><p>æ—¶é—´æ¶ˆè€—ï¼š21 minutes</p><p>ç¬¬ä¸€æ¬¡ä½¿ç”¨ ccache ç¼–è¯‘é‚£ä¸ªæ–‡ä»¶æ—¶ï¼Œæ‚¨å°†ä¸ä¼šçœ‹åˆ°æœ‰ä»»ä½•çš„å¸®åŠ©ï¼Œå› ä¸ºç¼–è¯‘ä¿¡æ¯è¿˜æ²¡æœ‰è¢«é«˜é€Ÿç¼“å­˜ã€‚</p><p>ccacheè·å–çš„ç¼“å­˜çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shel">[root@74c8c1b5bfab home]# ccache -s<br>cache directory                     /root/.ccache<br>primary config                      /root/.ccache/ccache.conf<br>secondary config      (readonly)    /usr/local/ccache-3.2.4/etc/ccache.conf<br>cache hit (direct)                    36<br>cache hit (preprocessed)              23<br>cache miss                          2239<br>called for link                      508<br>called for preprocessing              20<br>compile failed                        19<br>preprocessor error                    20<br>no input file                          3<br>files in cache                      4715<br>cache size                           1.6 GB<br>max cache size                       5.0 GB<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p><strong>å‰æï¼š</strong>.cacaheæ–‡ä»¶ä¸­å·²ç»è·å–åˆ°ç¼–è¯‘çš„ç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --name ccachtest -v $PWD/yumcache/:/home/lamp -v $PWD/ccache/:/root/.ccache -v $PWD/ccache-3.2.4:/usr/local/ccache-3.2.4 centos:7<br></code></pre></td></tr></table></figure><p>æ—¶é—´æ¶ˆè€—ï¼šTotal:4 minutes</p><ol><li><p>yumä¸‹è½½é‡‡ç”¨ç¼“å­˜çš„æ–¹å¼è¿›è¡Œ</p><p><code>-v $PWD/yumcache/:/home/lamp</code></p></li><li><p>ccacheä¸å¿…æ¯æ¬¡éƒ½è¿›è¡Œç¼–è¯‘</p><p><code>-v $PWD/ccache-3.2.4:/usr/local/ccache-3.2.4</code>    </p></li><li><p>ç¼“å­˜/root/.ccacheæ–‡ä»¶ç›®å½•</p><p><code>-v $PWD/ccache/:/root/.ccache</code></p></li></ol><h4 id="åŒç¼“å­˜ç¼–è¯‘ä¸åŒç‰ˆæœ¬"><a href="#åŒç¼“å­˜ç¼–è¯‘ä¸åŒç‰ˆæœ¬" class="headerlink" title="åŒç¼“å­˜ç¼–è¯‘ä¸åŒç‰ˆæœ¬"></a>åŒç¼“å­˜ç¼–è¯‘ä¸åŒç‰ˆæœ¬</h4><p>å‚è€ƒæ–¹æ³•äºŒï¼Œä»…ä¿®æ”¹mysqlçš„ç‰ˆæœ¬ï¼š5.7.35</p><p>æ—¶é—´æ¶ˆè€—:19 minutes</p><p>ccacheè·å–çš„ç¼“å­˜çš„æ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@0a200c0bc3fd .ccache]# ccache -s<br>cache directory                     /root/.ccache<br>primary config                      /root/.ccache/ccache.conf<br>secondary config      (readonly)    /usr/local/ccache-3.2.4/etc/ccache.conf<br>cache hit (direct)                  2544<br>cache hit (preprocessed)              68<br>cache miss                          4386<br>called for link                     1630<br>called for preprocessing              60<br>compile failed                        57<br>preprocessor error                    62<br>no input file                         11<br>files in cache                      9245<br>cache size                           3.1 GB<br>max cache size                       5.0 GB<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ccache</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitlab-14.0.5é•œåƒç¼–è¯‘å®‰è£…</title>
    <link href="/2022/08/24/docker/gitlab-14.0.5%E9%95%9C%E5%83%8F%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <url>/2022/08/24/docker/gitlab-14.0.5%E9%95%9C%E5%83%8F%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<p><em>æ³¨:å…¶ä¸­CEå’ŒEEçš„å®‰è£…åŒ…æ‹¬é•œåƒæ„å»ºæ–¹å¼ç›¸åŒ</em></p><h2 id="ç›´æ¥å®‰è£…gitlab"><a href="#ç›´æ¥å®‰è£…gitlab" class="headerlink" title="ç›´æ¥å®‰è£…gitlab"></a>ç›´æ¥å®‰è£…gitlab</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -s https:<span class="hljs-regexp">//</span>packages.gitlab.com<span class="hljs-regexp">/install/</span>repositories<span class="hljs-regexp">/gitlab/gi</span>tlab-ee/script.deb.sh | bash<br>apt-get install gitlab-ee=<span class="hljs-number">14.0</span>.<span class="hljs-number">5</span>-ee.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‹è½½gitlab"><a href="#ä¸‹è½½gitlab" class="headerlink" title="ä¸‹è½½gitlab"></a>ä¸‹è½½gitlab</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget --content-disposition https:<span class="hljs-regexp">//</span>packages.gitlab.com<span class="hljs-regexp">/gitlab/gi</span>tlab-ee<span class="hljs-regexp">/packages/u</span>buntu<span class="hljs-regexp">/focal/gi</span>tlab-ee_14.<span class="hljs-number">0.5</span>-ee.<span class="hljs-number">0</span>_arm64.deb/download.deb<br></code></pre></td></tr></table></figure><p>è·å–gitlabæºç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@ecs-5e66 gitlab]$ git clone https://gitlab.com/gitlab-org/omnibus-gitlab.git<br>Cloning into &#x27;omnibus-gitlab&#x27;...<br>remote: Enumerating objects: 148163, done.<br>remote: Counting objects: 100% (16/16), done.<br>remote: Compressing objects: 100% (16/16), done.<br>remote: Total 148163 (delta 8), reused 0 (delta 0), pack-reused 148147<br>Receiving objects: 100% (148163/148163), 24.69 MiB | 6.92 MiB/s, done.<br>Resolving deltas: 100% (94777/94777), done.<br>[root@ecs-5e66 gitlab]$ cd omnibus-gitlab/<br>[root@ecs-5e66 omnibus-gitlab]$ git checkout 14.0.5+ee.0<br>Note: checking out &#x27;14.0.5+ee.0&#x27;.<br>....<br><br>HEAD is now at fe10a61... Update VERSION to 14.0.5-ee<br><br></code></pre></td></tr></table></figure><h2 id="æ„å»ºgitlab"><a href="#æ„å»ºgitlab" class="headerlink" title="æ„å»ºgitlab"></a>æ„å»ºgitlab</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ‡æ¢åˆ†æ”¯</span><br>[root@ecs-5e66 omnibus-gitlab]$ cd docker<br>[root@ecs-5e66 docker]$<br>[root@ecs-5e66 docker]$ cat &lt;&lt; EOF &gt; RELEASE<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">RELEASE_PACKAGE=gitlab-ee</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">RELEASE_VERSION=14.0.5-ee</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">DOWNLOAD_URL=https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/focal/gitlab-ee_14.0.5-ee.0_arm64.deb/download.deb</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">éœ€è¦æ·»åŠ ä¾èµ–libatomic1</span><br>[root@ecs-5e66 docker]$ git diff<br>diff --git a/docker/Dockerfile b/docker/Dockerfile<br>index d07c1f4..602d412 100644<br>--- a/docker/Dockerfile<br>+++ b/docker/Dockerfile<br>@@ -14,6 +14,7 @@ RUN apt-get update -q \<br>       openssh-server \<br>       tzdata \<br>       wget \<br>+      libatomic1 \<br>     &amp;&amp; rm -rf /var/lib/apt/lists/*<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"> # </span><span class="language-bash">Use BusyBox</span><br>[root@ecs-5e66 docker]$ docker build -t gitlab/gitlab-ee:14.0.5 .<br>Sending build context to Docker daemon  28.67kB<br>Step 1/18 : FROM ubuntu:20.04<br><span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">d5ca7a445605</span><br>Step 2/18 : MAINTAINER GitLab Inc. &lt;support@gitlab.com&gt;<br><span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Using cache</span><br><span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">fbceb05a9c47</span><br>Step 3/18 : SHELL [&quot;/bin/sh&quot;, &quot;-c&quot;]<br><span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Using cache</span><br><span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">acf3fce3b499</span><br>Step 4/18 : ENV LANG=C.UTF-8<br>......<br>Step 18/18 : HEALTHCHECK --interval=60s --timeout=30s --retries=5 CMD /opt/gitlab/bin/gitlab-healthcheck --fail --max-time 10<br><span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> 5b6cac9a902a</span><br>Removing intermediate container 5b6cac9a902a<br><span class="hljs-meta prompt_"> ---&gt; </span><span class="language-bash">9bb5a07d8303</span><br>Successfully built 9bb5a07d8303<br>Successfully tagged gitlab/gitlab-ee:14.0.5<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gitlab</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kkFileView-4.0.0ç¼–è¯‘å®‰è£…</title>
    <link href="/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/kkFileView-4.0.0%E5%AE%89%E8%A3%85/"/>
    <url>/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/kkFileView-4.0.0%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<p><strong>è·å–æºç </strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://gitee.com/kekingcn/file-online-preview.git<br>cd file-online-preview/<br>git checkout v4.0.0<br></code></pre></td></tr></table></figure><h2 id="centos-7-6-å®‰è£…"><a href="#centos-7-6-å®‰è£…" class="headerlink" title="centos 7.6 å®‰è£…"></a>centos 7.6 å®‰è£…</h2><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install git wget vim libreoffice java-11-openjdk maven -y<br>java -version<br>mvn -v<br><span class="hljs-meta prompt_">#</span><span class="language-bash">/usr/lib64/libreoffice</span><br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹åŸæ–‡æ¡£ä¸­çš„é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹åŸæ–‡æ¡£ä¸­çš„é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹åŸæ–‡æ¡£ä¸­çš„é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹åŸæ–‡æ¡£ä¸­çš„é…ç½®æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff<br>diff --git a/server/src/main/bin/startup.sh b/server/src/main/bin/startup.sh<br>index cae3d3b..413c957 100644<br>--- a/server/src/main/bin/startup.sh<br>+++ b/server/src/main/bin/startup.sh<br>@@ -1,5 +1,5 @@<br><span class="hljs-meta prompt_"> #</span><span class="language-bash">!/bin/bash</span><br>-DIR_HOME=(&quot;/opt/openoffice.org3&quot; &quot;/opt/libreoffice&quot; &quot;/opt/libreoffice6.1&quot; &quot;/opt/libreoffice7.0&quot; &quot;/opt/libreoffice7.1&quot; &quot;/opt/openoffice4&quot; &quot;/usr/lib/openoffice&quot; &quot;/usr/lib/libreoffice&quot;)<br>+DIR_HOME=(&quot;/opt/openoffice.org3&quot; &quot;/opt/libreoffice&quot; &quot;/opt/libreoffice6.1&quot; &quot;/opt/libreoffice7.0&quot; &quot;/opt/libreoffice7.1&quot; &quot;/opt/openoffice4&quot; &quot;/usr/lib/openoffice&quot; &quot;/usr/lib64/libreoffice&quot;)<br> FLAG=<br> OFFICE_HOME=<br> KKFILEVIEW_BIN_FOLDER=$(cd &quot;$(dirname &quot;$0&quot;)&quot;;pwd)<br>diff --git a/server/src/main/config/application.properties b/server/src/main/config/application.properties<br>index fd79f6d..b78e4c2 100644<br>--- a/server/src/main/config/application.properties<br>+++ b/server/src/main/config/application.properties<br>@@ -27,7 +27,7 @@ office.plugin.task.timeout = 5m<br> file.dir = $&#123;KK_FILE_DIR:default&#125;<br><span class="hljs-meta prompt_"> #</span><span class="language-bash">openoffice home&lt;E8&gt;&lt;B7&gt;&lt;AF&gt;&lt;E5&gt;&lt;BE&gt;&lt;84&gt;</span><br><span class="hljs-meta prompt_"> #</span><span class="language-bash">office.home = C:\\Program Files (x86)\\OpenOffice 4</span><br>-office.home = $&#123;KK_OFFICE_HOME:default&#125;<br>+office.home = /usr/lib64/libreoffice<br></code></pre></td></tr></table></figure><h3 id="mvnæ„å»º"><a href="#mvnæ„å»º" class="headerlink" title="mvnæ„å»º"></a>mvnæ„å»º</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mvn clean package -DskipTests -Prelease<br></code></pre></td></tr></table></figure><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç”Ÿæˆå¯¹åº”çš„</span><br>cd server/target/<br>tar -zxvf kkFileView-4.0.0.tar.gz<br>cd kkFileView-4.0.0/bin<br>./start.sh<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kkFileView</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>wgetçŸ¥è¯†ç‚¹è¯¦è§£</title>
    <link href="/2022/08/24/linux/wget%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/"/>
    <url>/2022/08/24/linux/wget%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p>â€œworld wide webâ€å’Œâ€getâ€çš„ç»“åˆï¼Œç›®å‰æ”¯æŒhttpã€httpsä»¥åŠftpè¿™ä¸‰ä¸ªTCP/IPåè®®ä¸‹è½½ã€‚</p><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>æ”¯æŒé€’å½’ä¸‹è½½</li><li>æ”¯æŒä»£ç†æœåŠ¡å™¨</li><li>æ°å½“åœ°è½¬æ¢é¡µé¢ä¸­çš„è¿æ¥</li><li>ç”Ÿæˆå¯åœ¨æœ¬åœ°æµè§ˆçš„é¡µé¢é•œåƒ</li></ul><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><ol><li><p><code>wget</code>ä¸‹è½½å•æ–‡ä»¶</p></li><li><p><code>wget -O</code>ï¼šä¸‹è½½å¹¶ä»¥ä¸åŒçš„æ–‡ä»¶åä¿å­˜</p><p>å°†ä¸‹è½½è¿æ¥çš„æ–‡ä»¶ä¿å­˜ä¸ºboost_1_80.tar.gz</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -O boost_1_80.tar.gz https://boostorg.jfrog.io/artifactory/main/release/1.80.0/source/boost_1_80_0.tar.gz<br></code></pre></td></tr></table></figure></li><li><p><code>wget -c</code>:æ–­ç‚¹ç»­ä¼ </p></li><li><p><code>wget -q </code>:quiet (no output)â€”â€”ä¸‹è½½å†…å®¹ä½†ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹</p></li><li><p><code>wget -P</code>ï¼šä¸‹è½½åˆ°æŒ‡å®šç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -P/tmp https://boostorg.jfrog.io/artifactory/main/release/1.80.0/source/boost_1_80_0.tar.gz<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>snapå’Œapt</title>
    <link href="/2022/08/24/linux/snap%E5%92%8Capt/"/>
    <url>/2022/08/24/linux/snap%E5%92%8Capt/</url>
    
    <content type="html"><![CDATA[<h2 id="snap"><a href="#snap" class="headerlink" title="snap"></a>snap</h2><p><strong>è½¯ä»¶åŒ…å’Œéƒ¨ç½²ç³»ç»Ÿ</strong>ã€‚é€šè¿‡è¯¥åº”ç”¨ç¨‹åºä¸ç³»ç»Ÿæ— å…³ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨ä»»ä½•æ”¯æŒsnapçš„linuxå‘è¡Œç‰ˆä¸Šæœ¬åœ°è¿è¡Œã€‚</p><p>ä¸€ç§å…¨æ–°çš„è½¯ä»¶åŒ…ç®¡ç†æ–¹å¼ï¼Œå®ƒç±»ä¼¼ä¸€ä¸ªå®¹å™¨æ‹¥æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€æœ‰çš„æ–‡ä»¶å’Œåº“ï¼Œå„ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å®Œå…¨ç‹¬ç«‹ã€‚æ‰€ä»¥ä½¿ç”¨snapåŒ…çš„å¥½å¤„å°±æ˜¯å®ƒè§£å†³äº†åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¾èµ–é—®é¢˜ï¼Œä½¿åº”ç”¨ç¨‹åºä¹‹é—´æ›´å®¹æ˜“ç®¡ç†ã€‚ä½†æ˜¯ç”±æ­¤å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å®ƒå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚</p><p>ç±»ä¼¼äºä¸€ä¸ªå®¹å™¨ï¼Œå®ƒåŒ…å«ä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦ç”¨åˆ°çš„æ‰€æœ‰æ–‡ä»¶å’Œåº“ï¼ˆsnapåŒ…åŒ…å«ä¸€ä¸ªç§æœ‰çš„rootæ–‡ä»¶ç³»ç»Ÿï¼Œé‡Œé¢åŒ…å«äº†ä¾èµ–çš„è½¯ä»¶åŒ…ï¼‰ã€‚å®ƒä»¬ä¼šè¢«å®‰è£…åˆ°å•ç‹¬çš„ç›®å½•ï¼›å„ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ç›¸äº’éš”ç¦»ã€‚ä½¿ç”¨snapæœ‰å¾ˆå¤šå¥½å¤„ï¼Œé¦–å…ˆå®ƒè§£å†³äº†è½¯ä»¶åŒ…çš„ä¾èµ–é—®é¢˜ï¼›å…¶æ¬¡ï¼Œä¹Ÿä½¿åº”ç”¨ç¨‹åºæ›´å®¹æ˜“ç®¡ç†ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol><li><code>sudo snap list</code>:æŸ¥çœ‹å·²ä¸‹è½½snapçš„è½¯ä»¶ã€‚</li></ol><h2 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h2><p>è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼Œç”¨äºåœ¨åŸºäº Debian çš„ç³»ç»Ÿä¸Šå®‰è£…å’Œåˆ é™¤è½¯ä»¶åŒ…ã€‚APT ä½¿æ£€ç´¢ã€é…ç½®ã€å‡çº§ã€å®‰è£…å’Œåˆ é™¤åŒ…çš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚</p><ul><li>ä½ å¸Œæœ›åº”ç”¨ç¨‹åºç”±ä½ ä½¿ç”¨çš„å‘è¡Œç‰ˆè¿›è¡Œå®¡æ ¸ã€‚</li><li>ä½ æ‹…å¿ƒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚APT å®‰è£…çš„åº”ç”¨ç¨‹åºå…±äº«å®ƒä»¬çš„ä¾èµ–é¡¹ã€‚</li><li>ä½ å¸Œæœ›åº”ç”¨ç¨‹åºæ­£ç¡®é›†æˆåˆ°GUI ç¯å¢ƒä¸­ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ubuntuå®‰è£…vscode</title>
    <link href="/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/ubuntu%E5%AE%89%E8%A3%85vscode/"/>
    <url>/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/ubuntu%E5%AE%89%E8%A3%85vscode/</url>
    
    <content type="html"><![CDATA[<h3 id="åœ¨ubuntuçš„è½¯ä»¶å•†åŸä¸­å®‰è£…codeæŠ¥é”™"><a href="#åœ¨ubuntuçš„è½¯ä»¶å•†åŸä¸­å®‰è£…codeæŠ¥é”™" class="headerlink" title="åœ¨ubuntuçš„è½¯ä»¶å•†åŸä¸­å®‰è£…codeæŠ¥é”™"></a>åœ¨ubuntuçš„è½¯ä»¶å•†åŸä¸­å®‰è£…codeæŠ¥é”™</h3><p>Unable to install â€œVisual Studio Codeâ€: snap â€œcodeâ€ has â€œinstall-snapâ€ change in progressï¼›</p><h4 id="é—®é¢˜åŸå› -amp-amp-è§£å†³"><a href="#é—®é¢˜åŸå› -amp-amp-è§£å†³" class="headerlink" title="é—®é¢˜åŸå› &amp;&amp;è§£å†³"></a>é—®é¢˜åŸå› &amp;&amp;è§£å†³</h4><p>è½¯ä»¶æ­£åœ¨å®‰è£…ï¼Œæ‰€ä»¥ä¸éœ€è¦å†æ¬¡ç‚¹å‡»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/Desktop/Doc$ snap changes<br>ID   Status  Spawn                   Ready                   Summary<br>1    Done    2022-02-23              yesterday at 11:37 CST  Initialize system state<br>2    Done    yesterday at 11:37 CST  yesterday at 11:37 CST  Initialize device<br>3    Done    yesterday at 11:42 CST  yesterday at 11:43 CST  Install &quot;typora&quot; snap from &quot;latest/stable&quot; channel<br>4    Done    yesterday at 14:03 CST  yesterday at 14:12 CST  Auto-refresh 4 snaps<br>5    Do      today at 11:06 CST      -                       Install &quot;code&quot; snap from &quot;latest/stable&quot; channel<br><br></code></pre></td></tr></table></figure><h3 id="ä»ubuntuè½¯ä»¶å•†åº—ä¸‹è½½çš„VScodeæ— æ³•è¾“å…¥ä¸­æ–‡ï¼Œé‡æ–°å®‰è£…VScode"><a href="#ä»ubuntuè½¯ä»¶å•†åº—ä¸‹è½½çš„VScodeæ— æ³•è¾“å…¥ä¸­æ–‡ï¼Œé‡æ–°å®‰è£…VScode" class="headerlink" title="ä»ubuntuè½¯ä»¶å•†åº—ä¸‹è½½çš„VScodeæ— æ³•è¾“å…¥ä¸­æ–‡ï¼Œé‡æ–°å®‰è£…VScode"></a>ä»ubuntuè½¯ä»¶å•†åº—ä¸‹è½½çš„VScodeæ— æ³•è¾“å…¥ä¸­æ–‡ï¼Œé‡æ–°å®‰è£…VScode</h3><p><strong>ubuntu æ·»åŠ ä¿¡ä»»æº</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu@root:~/Desktop$ wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; packages.microsoft.gpg<br>ubuntu@root:~/Desktop$ sudo install -o root -g root -m 644 packages.microsoft.gpg /etc/apt/trusted.gpg.d/<br>[sudo] password for ubuntu: <br>ubuntu@root:~/Desktop$ sudo sh -c &#x27;echo &quot;deb [arch=amd64,arm64,armhf signed-by=/etc/apt/trusted.gpg.d/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main&quot; &gt; /etc/apt/sources.list.d/vscode.list&#x27;<br>ubuntu@root:~/Desktop$ rm -f packages.microsoft.gpg<br>ubuntu@root:~/Desktop$ sudo apt install apt-transport-https<br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>The following packages were automatically installed and are no longer required:<br>  gyp javascript-common libc-ares2 libjs-inherits libjs-is-typedarray libjs-psl libjs-typedarray-to-buffer libpython2-stdlib libpython2.7-minimal libpython2.7-stdlib libssl-dev libuv1-dev<br>  python-pkg-resources python2 python2-minimal python2.7 python2.7-minimal<br>Use &#x27;sudo apt autoremove&#x27; to remove them.<br>The following NEW packages will be installed:<br>  apt-transport-https<br>0 upgraded, 1 newly installed, 0 to remove and 257 not upgraded.<br>Need to get 1,704 B of archives.<br>After this operation, 162 kB of additional disk space will be used.<br>Get:1 http://cn.archive.ubuntu.com/ubuntu focal-updates/universe amd64 apt-transport-https all 2.0.9 [1,704 B]<br>Fetched 1,704 B in 1s (2,988 B/s)        <br>Selecting previously unselected package apt-transport-https.<br>(Reading database ... 196975 files and directories currently installed.)<br>Preparing to unpack .../apt-transport-https_2.0.9_all.deb ...<br>Unpacking apt-transport-https (2.0.9) ...<br>Setting up apt-transport-https (2.0.9) ...<br>ubuntu@root:~/Desktop$ sudo apt update -y<br>ubuntu@root:~/Desktop$ sudo apt install code -y<br></code></pre></td></tr></table></figure><p>ä¸‹è½½ä¹‹åé‡æ–°æ‰“å¼€ï¼Œæ”¯æŒä¸­æ–‡è¾“å…¥ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vscode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ubuntu å®‰è£…nodejs</title>
    <link href="/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/ubuntu%E5%AE%89%E8%A3%85nodejs/"/>
    <url>/2022/08/24/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/ubuntu%E5%AE%89%E8%A3%85nodejs/</url>
    
    <content type="html"><![CDATA[<h3 id="å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„nodejs"><a href="#å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„nodejs" class="headerlink" title="å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„nodejs"></a>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„nodejs</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -<br>sudo apt install nodejs<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘å®‰è£…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nodejs</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
